"use strict";$(function(){var t=new OmnomIRC,e=function(){var t={interval:false,$elem:false,start:function(){if(t.interval===false){var e=[true,true,true,true,true,false,false,false];t.$elem=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body");t.interval=setInterval(function(){t.$elem.empty().append($.map(e,function(t){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:t?"black":""})}));var n=e[0],i;for(i=1;i<=7;i++){e[i-1]=e[i]}e[7]=n},50)}},stop:function(){if(t.interval!==false){clearInterval(t.interval);t.interval=false;t.$elem.remove()}}};return{start:t.start,stop:t.stop}}(),n=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(t){var n;if(e.support_webkit){n=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",t);n.show()}else if(e.support()){n=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:t});n.onshow=function(){setTimeout(n.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");t.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(n){if(Notification.permission!==n){Notification.permission=n}if(n==="granted"){e.show("Notifications Enabled!");t.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},make:function(n,i){if(t.instant.current()){if(t.options.get("browserNotifications")){e.show(n)}if(t.options.get("ding")){$("#ding")[0].play()}if(i!=t.channels.current().handler){t.channels.highlight(i)}}else{if(i!=t.channels.current().handler){t.channels.highlight(i)}}e.startFlash()},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var t=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(t?"[ @] ":"[@ ] ")+e.originalTitle;t=!t},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(n){if(n===undefined){n=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!n){t.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(t){if(t.originalEvent.key==settings.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)})}};return{request:e.request,make:e.make,stopFlash:e.stopFlash,init:e.init}}(),i=function(){var n={draw:function(){var e=0,n=0,o=false,a=0,s=false,r=0,c=function(t){r=$(t).width();s=false;$(t).css({position:"absolute","z-index":100,left:e-a}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:r})).addClass("dragging").find("div").css("display","block").focus();o=false},l=function(t,e){t.preventDefault();n=t.clientX;a=n-$(e).position().left;o=true},u=function(t,i){e=t.clientX;if(o&&Math.abs(e-n)>=4){o=false;c(i);t.preventDefault()}else if($(i).hasClass("dragging")){var s=e-a,l=$("#topicDragPlaceHolder").next(".chanList"),u=$("#topicDragPlaceHolder").prev(".chanList");$(i).css("left",s);if(l.length>0&&l.position().left<s+r/2){l.after($("#topicDragPlaceHolder").remove())}else if(u.length>0){if(u.attr("id")==$(i).attr("id")){u=u.prev()}if(u.length>0&&u.position().left>s){u.before($("#topicDragPlaceHolder").remove())}}}},f=function(e,n){if(o){o=false}else{$(n).find("div").css("display","none");$("#topicDragPlaceHolder").replaceWith(n);t.channels.setChans($.map($(".chanList"),function(e,n){if($(e).find("span").hasClass("curchan")){t.options.set("curChan",n);t.channels.current().setI(n)}return $(e).data("json")}))}};$("#ChanList").empty().append($.map(t.channels.getList(),function(e,n){if(e.ex&&t.options.get("extraChans")||!e.ex){return $("<div>").data("json",e).attr("id","chan"+n.toString()).addClass("chanList"+(e.high?" highlightChan":"")).append($("<span>").addClass("chan "+(t.channels.current().is(n)?" curchan":"")).append(e.chan.substr(0,1)!="#"?$("<span>").addClass("closeButton").css({width:9,"float":"left"}).mouseup(function(e){if(s){t.channels.part(n)}}).text("x"):"",$("<span>").text(e.chan)).mouseup(function(){if(s){i.join(n)}}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(t){u(t,$(this).parent())}).mouseup(function(t){f(t,$(this).parent())}).mouseout(function(t){f(t,$(this).parent())})).mousedown(function(t){s=true;l(t,this)}).mousemove(function(t){u(t,this)}).mouseout(function(t){if(o){c(this)}}).mouseup(function(t){f(t,this)})}}))},init:function(){n.draw()},join:function(n,i){e.start();$("#message").attr("disabled","true");$("#MessageBox").empty();$(".chan").removeClass("curchan");t.channels.load(n,function(o,a){if(o){if(a.admin){$("#adminLink").css("display","")}else{$("#adminLink").css("display","none")}if(t.settings.loggedIn()){$("#message").removeAttr("disabled")}}$("#chan"+n.toString()).removeClass("highlightChan").find(".chan").addClass("curchan");if(i!==undefined){i(o)}s.down();e.stop()})}};return{init:n.init,draw:n.draw,join:n.join}}(),o=function(){var e={draw:function(e){$("#UserList").empty().append($.map(e,function(e){var n,i=encodeURIComponent(e.nick),o=$("<span>").text(e.nick).html();return $("<span>").attr("title",t.settings.getNetwork(e.network).name).append(t.settings.getNetwork(e.network).userlist.split("NICKENCODE").join(i).split("NICK").join(o),"<br>").mouseover(function(){n=t.network.getJSON("misc.php?userinfo&name="+base64.encode(e.nick)+"&chan="+t.channels.current().handlerB64+"&online="+e.network.toString(),function(t){if(t.last){$("#lastSeenCont").text("Last Seen: "+new Date(t.last*1e3).toLocaleString())}else{$("#lastSeenCont").text("Last Seen: never")}$("#lastSeenCont").css("display","block")})}).mouseout(function(){try{n.abort()}catch(t){}$("#lastSeenCont").css("display","none")})}),"<br><br>")}};return{draw:e.draw}}(),a=function(){var t={set:function(t){$("#topic").empty().append(t)}};return{set:t.set}}(),s=function(){var e={isDown:false,is_touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,headerOffset:0,$mBox:false,$mBoxCont:false,touchScroll:function(t,n){var i=-1;t.bind("touchstart",function(t){if($(t.target).is("a")){return}e.$mBox.css("transition","none");t.preventDefault();i=t.originalEvent.touches[0].clientY}).bind("touchmove",function(t){if($(t.target).is("a")){return}t.preventDefault();if(i==-1){return}var e=t.originalEvent.changedTouches[0].clientY;n(e-i);i=e}).bind("touchend touchcancel touchleave",function(t){if($(t.target).is("a")){return}e.$mBox.css("transition","");t.preventDefault();i=-1})},enableButtons:function(){var t=function(t,n,i){var o;$(t).mousedown(function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).mouseup(function(){try{clearInterval(o)}catch(t){}}).mouseout(function(){try{clearInterval(o)}catch(t){}});if(e.is_touch){$(t).bind("touchstart",function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(o)}catch(t){}})}};t("#arrowLeftChan","ChanListCont",-9);t("#arrowRightChan","ChanListCont",9);t("#arrowLeftTopic","topicCont",-9);t("#arrowRightTopic","topicCont",9)},moveWindow:function(n){var i=-parseInt(e.$mBox[0].style.top,10),o=e.$mBox.height()-e.$mBoxCont.height(),a=Math.min(o,Math.max(0,i-n));e.isDown=false;e.$mBox.css("top",-a);if(a==o){e.isDown=true}if(t.options.get("scrollBar")){e.reCalcBar()}},enableWheel:function(){e.$mBoxCont.bind("DOMMouseScroll mousewheel",function(t){var n=e.$mBox[0].style.top;e.moveWindow(/Firefox/i.test(navigator.userAgent)?t.originalEvent.detail*-20:t.originalEvent.wheelDelta/2);t.preventDefault();t.stopPropagation();t.cancelBubble=true});if(e.is_touch){e.touchScroll(e.$mBoxCont,function(t){e.moveWindow(t)})}},reCalcBar:function(){if($("#scrollBar").length!==0){if(e.$mBox.height()<=e.$mBoxCont.height()){$("#scrollBar").css("top",e.headerOffset)}else{$("#scrollBar").css("top",parseInt(e.$mBox[0].style.top,10)/(e.$mBoxCont.height()-e.$mBox.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-e.headerOffset)+e.headerOffset)}}},enableUserlist:function(){var t=function(t,e){$(e).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-e.scrollHeight,t+parseInt($("#UserList").css("top"),10))))};$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(e){if(e.preventDefault){e.preventDefault()}e=e.originalEvent;t(/Firefox/i.test(navigator.userAgent)?e.detail*-20:e.wheelDelta/2,this)});if(e.is_touch){e.touchScroll($("#UserList"),function(t){e.moveUserList(t,this)})}},showBar:function(){var t=false,n=false,i=function(i){var o=0;if(s.data("isClicked")){if(!(t!==false&&i<=t)&&!(n!==false&&i>=n)){o=parseInt(s.css("top"),10)+(i-s.data("prevY"));e.$mBox.css("top",-((o-e.headerOffset)/($("body")[0].offsetHeight-s[0].offsetHeight-e.headerOffset))*(e.$mBox.height()-e.$mBoxCont.height()));e.isDown=false;if(o<e.headerOffset){if(t===false){t=i}o=e.headerOffset;e.$mBox.css("top",0)}else{t=false}if(o>$("body")[0].offsetHeight-s[0].offsetHeight){if(n===false){n=i}o=$("body")[0].offsetHeight-s[0].offsetHeight;e.$mBox.css("top",e.$mBoxCont.height()-e.$mBox.height());e.isDown=true}else{n=false}s.css("top",o)}}s.data("prevY",i)},o=function(){s.data("isClicked",true);$("#scrollArea").css("display","block");e.$mBox.css("transition","none");c=false;t=false;n=false},a=function(){s.data("isClicked",false);$("#scrollArea").css("display","none");e.$mBox.css("transition","")},s=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:false}).appendTo("body").mousemove(function(t){i(t.clientY)}).mousedown(function(t){o()}).mouseup(function(){a()}),r,c=false;s.css("top",$("body")[0].offsetHeight-s[0].offsetHeight);r=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(t){i(t.clientY)}).mouseup(function(){a()}).mouseenter(function(t){if(t.originalEvent.buttons==0&&c){a()}c=true});if(e.is_touch){r.bind("touchend touchcancel touchleave",function(t){a()}).bind("touchmove",function(t){t.preventDefault();i(t.originalEvent.changedTouches[0].clientY)});s.bind("touchstart",function(t){t.preventDefault();o()}).bind("touchmove",function(t){t.preventDefault();i(t.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(t){t.preventDefault();a(t)})}r.appendTo("body");$("<div>").attr("id","scrollBarLine").appendTo("body");$(window).trigger("resize")},showButtons:function(){var t,n,i=function(){t=setInterval(function(){e.moveWindow(9)},50)},o=function(){n=setInterval(function(){e.moveWindow(-9)},50)},a;a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){e.$mBox.css("transition","none");i()}).mouseout(function(){e.$mBox.css("transition","");try{clearInterval(t)}catch(n){}}).mouseup(function(){e.$mBox.css("transition","");try{clearInterval(t)}catch(n){}}));if(e.is_touch){a.bind("touchstart",function(){i()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(t)}catch(e){}})}a.appendTo("body");a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){e.$mBox.css("transition","none");o()}).mouseout(function(){e.$mBox.css("transition","");try{clearInterval(n)}catch(t){}}).mouseup(function(){e.$mBox.css("transition","");try{clearInterval(n)}catch(t){}}));if(e.is_touch){a.bind("touchstart",function(){o()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(n)}catch(t){}})}a.appendTo("body")},down:function(){e.$mBox.css("top",e.$mBoxCont.height()-e.$mBox.height());e.reCalcBar();e.isDown=true},up:function(){e.$mBox.css("top",0);e.reCalcBar();e.isDown=false},slide:function(){if(e.isDown){e.down()}},init:function(){e.$mBox=$("#MessageBox");e.$mBoxCont=$("#mBoxCont");e.enableButtons();e.headerOffset=$("#header").height()-2;if(t.options.get("scrollBar")){e.showBar()}else{e.showButtons()}if(t.options.get("scrollWheel")){e.enableWheel()}e.enableUserlist();$(document).add(window).add("body").add("html").scroll(function(t){t.preventDefault()})}};return{down:e.down,up:e.up,slide:e.slide,init:e.init,reCalcBar:e.reCalcBar}}(),r=function(){var e={menuOpen:false,msgVal:"",hideMenu:function(){$("#textDecoForm").css("display","none");e.menuOpen=false},reverseParse:function(t){if(t.indexOf("<")===-1){return $("<span>").html(t).text()}var e=false,n=false,i=false,o="-1",a="-1";t=t.replace(/<img([^>]*?)>/gi,function(t,e){var n=e.match(/data-code="([^"]*)"/);if(n){return n[1]}return""});t=t.replace(/<span([^>]*?)>([^<]*?)<\/span>/gi,function(s,r,c){if(!r){return c}t="";if(r.indexOf("bold")==-1==e){e=!e;t+=""}if(r.indexOf("italic")==-1==n){n=!n;t+=""}if(r.indexOf("underline")==-1==i){i=!i;t+=""}var l=r.match(/fg-(\d+)/);dbg=r.match(/bg-(\d+)/);if(!l){l="-1"}if(!dbg){dbg="-1"}if(dbg!=a||l!=o){if(o!="-1"&&l=="-1"||a!="-1"&&dbg=="-1"){t="";if(e){t+=""}if(n){t+=""}if(i){t+=""}}t+="";o=l;if(o!="-1"){t+=o}a=dbg;if(a!="-1"){t+=","+a}}return t+c});return $("<span>").html(t).text()},getCaretCharacterOffsetWithin:function(t){var e=window.getSelection();if(e.rangeCount>0){var n=e.getRangeAt(0),i=n.cloneRange(),o=0,a=document.createRange();i.selectNodeContents(t);i.setEnd(n.endContainer,n.endOffset);for(var s in i.commonAncestorContainer.getElementsByTagName("img")){if(s.dataset.code){a.selectNode(s);if(i.compareBoundaryPoints(Range.START_TO_START,a)!=1&&i.compareBoundaryPoints(Range.END_TO_END,a)!=-1){o+=s.dataset.code.length}}}return i.toString().length+o}return 0},getWholeSelection:function(t){var n=window.getSelection(),i,o=n.getRangeAt(0),a=o.cloneRange(),s=e.getCaretCharacterOffsetWithin(t);o.collapse(true);n.removeAllRanges();n.addRange(o);i=e.getCaretCharacterOffsetWithin(t);n.removeAllRanges();n.addRange(a);return[i,s]},setCaretCharacterOffsetWithin:function(t,n,i,o,a){if(i===undefined){i=0}if(o===undefined){o=document.createRange()}if(a===undefined){a=false}for(var s in t.childNodes){if(s.nodeType==3){if(s.length>=n){var r=window.getSelection();if(!a){o.setStart(s,n);a=true;n+=i}if(a&&s.length>=n){o.setEnd(s,n);r.removeAllRanges();r.addRange(o);return-1}}n-=s.length}else if(s.nodeType==1){if(s.tagName=="IMG"&&s.dataset.code){if(s.dataset.code.length>=n){var r=window.getSelection();if(!a){o.setStartAfter(s);a=true;n+=i}if(a&&s.dataset.code.length>=n){o.setEndAfter(s);r.removeAllRanges();r.addRange(o);return-1}}n-=s.dataset.code.length}else{n=e.setCaretCharacterOffsetWithin(s,n,i,o,a);if(n<0){return-1}}}else{n=e.setCaretCharacterOffsetWithin(s,n,i,o,a);if(n<0){return-1}}}return n},surroundSelection:function(t,e){var n=window.getSelection();if(n.rangeCount>0){var i=n.getRangeAt(0),o=i.startContainer,a=i.startOffset,s=document.createTextNode(t),r=document.createTextNode(e),c=i.cloneRange();c.collapse(false);c.insertNode(r);c.setStart(o,a);c.collapse(true);c.insertNode(s);i.setStartAfter(s);i.setEndBefore(r);n.removeAllRanges();n.addRange(i)}},updateContent:function(n,i){var o=$("#message");if(n===undefined){n=i=e.getCaretCharacterOffsetWithin(o[0])}e.msgVal=e.reverseParse(o.html());o.html(t.parser.parse(e.msgVal));var a=document.createRange();e.setCaretCharacterOffsetWithin(o[0],n,i-n)},init:function(){t.onsetval=function(n){e.msgVal=n;$("#message").html(t.parser.parse(n))};t.ongetval=function(){return e.msgVal};$("#message").on("input",function(t){e.updateContent()});$("#message").mouseup(function(t){var n=window.getSelection();if(n.isCollapsed){return}t.preventDefault();$("#textDecoForm").css({display:"block",left:Math.max(t.pageX-52,0)});e.menuOpen=true});$(document).mousedown(function(t){if(!$(t.target).closest("#textDecoForm").length&&e.menuOpen){e.hideMenu()}});$("#textDecoForm .colorbutton").click(function(t){t.preventDefault();var n=this.dataset.num,i=e.getWholeSelection($("#message")[0]);e.surroundSelection(""+n,"");e.updateContent(i[0],i[1])});$("#textDecoFormBold").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])});$("#textDecoFormItalic").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])});$("#textDecoFormUnderline").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])})},support:function(){return"contentEditable"in document.documentElement&&t.options.get("wysiwyg")}};return{init:e.init,getMsg:e.getMsg,support:e.support,updateContent:e.updateContent}}(),c=function(){var e={init:function(){if(t.options.get("smileys")){$("#smileyMenuButton").css("cursor","pointer").click(function(){if($("#smileyselect").css("display")=="block"){$("#smileyselect").css("display","none");$(this).attr("src","smileys/smiley.gif")}else{$("#smileyselect").css("display","block");$(this).attr("src","smileys/tongue.gif")}})}else{$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")}},set:function(t){$("#smileyselect").empty().append($.map(t,function(t){return[t.inMenu?$("<img>").attr({src:t.pic,alt:t.alt,title:t.title}).click(function(){if(!r.support()){replaceText(" "+t.code,$("#message")[0])}else{var e=window.getSelection().getRangeAt(0);e.deleteContents();e.insertNode(document.createTextNode(" "+t.code));r.updateContent()}}):""," "]}))}};return{init:e.init,set:e.set}}(),l=function(){var e={mBoxContWidthOffset:90,hide_userlist:false,show_scrollbar:true,registerToggle:function(){$("#toggleButton").click(function(e){e.preventDefault();t.options.set("enable",!t.options.get("enable"));document.location.reload()})},calcResize:function(t){var n=window.innerHeight,i=window.innerWidth,o=$("#header").outerHeight(),a=$("#footer").outerHeight(),r=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(t){$("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10));$("#mBoxCont").css("height",n-a-o-.2*r);$("html,body").height(n);$("#message").css("width",i*(e.hide_userlist?1:.91)-12*r-$("#loginForm").width())}if(e.show_scrollbar){var c=i/100*e.mBoxContWidthOffset;if(t){$("#mBoxCont").css("width",c-1.9*r)}$("#scrollBarLine").css("left",c-1.4*r);if(t){$("#scrollBarLine").css("height",n-o-.1*r)}$("#scrollBar").css("left",c-1.5*r);s.reCalcBar()}s.down()},initGuestLogin:function(){var e=function(e,i){t.settings.identGuest(e,i,function(i){if(!i.success){alert("ERROR"+(i.message?": "+i.message:""));n();return}$("#pickUsernamePopup").hide();$("#message").removeAttr("disabled");t.send.val("");$("#loginForm > button").hide();$("#guestName").text(e+" (guest) (").append($("<a>").text("logout").click(function(e){e.preventDefault();if(confirm("Are you sure? You won't be able to take this nick for half an hour!")){t.settings.logout();n()}}),")").show();$(window).trigger("resize")})},n=function(){t.send.val("You need to pick a username if you want to chat!");$("#message").attr("disabled",true);$("#loginForm > button").show();$("#guestName").hide();$(window).trigger("resize")};if(t.ls.get("guestName")){t.settings.login(t.ls.get("guestName"),t.ls.get("guestSig"));e(t.ls.get("guestName"),true)}else{n()}$("#loginForm").show();$("#loginForm > button").click(function(t){t.preventDefault();$("#pickUsernamePopup").toggle()});$("#pickUsernamePopup > button").click(function(t){e($('#pickUsernamePopup > input[type="text"]').val(),$('#pickUsernamePopup > input[type="checkbox"]')[0].checked)})},init:function(){var i=navigator.userAgent,o=i.indexOf("Mozilla/5.0")>-1&&i.indexOf("Android ")>-1&&i.indexOf("AppleWebKit")>-1&&!(i.indexOf("Chrome")>-1),a=i.match(/(iPod|iPhone|iPad)/i)&&i.match(/AppleWebKit/i),l=i.match(/AppleWebKit/i)&&i.match(/Android/i);$("body").css("font-size",t.options.get("fontSize").toString(10)+"pt");e.hide_userlist=t.options.get("hideUserlist");e.show_scrollbar=t.options.get("scrollBar");t.page.changeLinks();if(!r.support()){$("#message").replaceWith($("<input>").attr({type:"text",id:"message",accesskey:"i",maxlen:"256",autocomplete:"off"}))}else{$("#message").keydown(function(t){if(t.keyCode==13){t.preventDefault();$("#sendMessage").trigger("submit")}});r.init()}t.initinput();if(!t.settings.loggedIn()){t.send.val("You need to login if you want to chat!");if(t.settings.guestLevel()>=2){e.initGuestLogin()}}if(e.hide_userlist){e.mBoxContWidthOffset=99;$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head")}s.init();n.init();e.registerToggle();if(a){e.calcResize(true)}$(window).resize(function(){e.calcResize(!a)}).trigger("resize").focus(function(){n.stopFlash()});$("#aboutButton").click(function(t){t.preventDefault();$("#about").toggle()});c.init();f.init();$("#sendMessage").submit(function(e){e.preventDefault();if(t.settings.loggedIn()){if(!$("#message").attr("disabled")){t.send.send(function(){t.send.val("");$("#message").focus()})}}})},maxLines:200,lastMessage:0,lineHigh:false,addLine:function(n,i,o){var a=$("#MessageBox"),r="",c=new Date(o.time*1e3);if(a.find("tr").length>e.maxLines&&loadMode!==true){a.find("tr:first").remove()}if(n=="*"){r="* "}else{r="<"+o.name+"> "}if(t.options.get("times")){r="["+c.toLocaleTimeString()+"] "+r}r+=$("<span>").append(i).text();u.set(r);if(new Date(e.lastMessage).getDay()!=c.getDay()){a.append($("<tr>").addClass("dateSeperator").append($("<td>").addClass(t.options.get("altLines")&&(e.lineHigh=!e.lineHigh)?"lineHigh":"").attr("colspan",t.options.get("times")?3:2).text(c.toLocaleDateString())))}var l=$("<tr>").addClass(t.options.get("altLines")&&(e.lineHigh=!e.lineHigh)?"lineHigh":"").append(t.options.get("times")?$("<td>").addClass("irc-date").append("["+c.toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(n),$("<td>").addClass(o.type).append(i));l.find("img").load(function(t){s.slide()});a.append(l);s.slide();e.lastMessage=o.time*1e3;return},setSmileys:function(t){$("#smileyselect").empty().append($.map(t,function(t){return[t.inMenu?$("<img>").attr({src:t.pic,alt:t.alt,title:t.title}).click(function(){if(!r.support()){replaceText(" "+t.code,$("#message")[0])}else{var e=window.getSelection().getRangeAt(0);e.deleteContents();e.insertNode(document.createTextNode(" "+t.code));r.updateContent()}}):""," "]}))}};return{init:e.init,registerToggle:e.registerToggle,addLine:e.addLine,setSmileys:e.setSmileys}}(),u=function(){var e={text:"",started:false,start:function(){if(!t.options.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(t){}}},500);e.started=true}},set:function(t){e.text=t;if(!e.started){e.start()}}};return{set:e.set}}(),f=function(){var n={isOpen:false,year:0,month:0,day:0,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],getLogUrlParam:function(){return base64.encode(n.year.toString(10)+"-"+n.month.toString(10)+"-"+n.day.toString(10))},updateInputVal:function(){$("#logDate").val(n.months[n.month-1]+" "+n.day.toString(10)+" "+n.year.toString(10))},displayDatePicker:function(){var t=new Date(n.year,n.month,n.day),e=["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],i=new Date(n.year,n.month,0).getDate(),o=new Date(n.year,n.month-1,1).getDay(),a=0;if(n.day>i){n.day=i}n.updateInputVal();$("#logDatePicker").empty().append($("<a>").text("<").click(function(t){t.preventDefault();t.stopPropagation();n.year--;n.displayDatePicker()})," ",n.year.toString(10)," ",$("<a>").text(">").click(function(t){t.preventDefault();t.stopPropagation();n.year++;n.displayDatePicker()}),"<br>",$("<a>").text("<").click(function(t){t.preventDefault();t.stopPropagation();n.month--;if(n.month<1){n.month=12;n.year--}n.displayDatePicker()})," ",n.months[n.month-1]," ",$("<a>").text(">").click(function(t){t.preventDefault();t.stopPropagation();n.month++;if(n.month>12){n.month=1;n.year++}n.displayDatePicker()}),"<br>",$("<table>").append($("<tr>").append($.map(e,function(t){return $("<th>").text(t)})),$.map([0,1,2,3,4,5],function(){if(a>=i){return}return $("<tr>").append($.map([0,1,2,3,4,5,6],function(t){if(a==0&&t!=o||a>=i){return $("<td>").text(" ")}a++;return $("<td>").text(a).addClass("logDatePickerDay").addClass(a==n.day?"current":"").data("day",a).click(function(){$(".logDatePickerDay.current").removeClass("current");n.day=$(this).addClass("current").data("day");n.updateInputVal()})}))})));$("#logDatePicker").css("display","block")},open:function(){var i=new Date;e.start();t.logs.open(function(){$("#MessageBox").empty();$("#message").attr("disabled","true");t.users.setUsers([]);$("#chattingHeader").css("display","none");$("#logDatePicker").css("display","none");$("#logsHeader").css("display","block");$("#logChanIndicator").text(t.channels.current().name);n.year=parseInt(i.getFullYear(),10);n.month=parseInt(i.getMonth()+1,10);n.day=parseInt(i.getDate(),10);n.updateInputVal();n.isOpen=true;n.fetch()})},close:function(){t.logs.close();$("#chattingHeader").css("display","block");$("#logsHeader").css("display","none");n.isOpen=false},fetch:function(){e.start();$("#MessageBox").empty();t.logs.fetch(n.getLogUrlParam(),function(){s.up();e.stop()})},toggle:function(){if(n.isOpen){n.close()}else{n.open()}},init:function(){$("#logCloseButton").click(function(t){t.preventDefault();n.close()});$("#logGoButton").click(function(t){t.preventDefault();n.fetch()});$("#logsButton").click(function(t){t.preventDefault();n.toggle()});$("#logDate").click(function(t){t.preventDefault();$(this).focusout();if($("#logDatePicker").css("display")!="block"){n.displayDatePicker();t.stopPropagation()}});$(document).click(function(t){if(n.isOpen){var e=$("#logDatePicker");if(!e.is(t.target)&&e.has(t.target).length===0){e.css("display","none")}}})}};return{init:n.init}}();e.start();t.error.init();t.onmessage=l.addLine;t.onerror=t.error.addError;t.onwarning=t.error.addWarning;t.onuserchange=o.draw;t.onchannelchange=i.draw;t.onchanneljoin=function(e){if(!e){return}if(e[0]=="*"){t.channels.joinPm(e.substring(1),"",function(t){if(t!=-1){i.join(t)}});return}var n=t.channels.join(e);if(n!=-1){i.join(n)}};t.onchannelpart=t.channels.part;t.ontopicchange=a.set;t.onnotification=n.make;t.onsmileychange=l.setSmileys;t.connect(function(){if(t.options.get("enable")){l.init();i.join(t.options.get("curChan"),function(t){if(!t){i.join(0)}})}else{t.disconnect();l.registerToggle();$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(e){e.preventDefault();t.options.set("enable",true);window.location.reload()}));$("#footer,#header").css("display","none");e.stop()}})});