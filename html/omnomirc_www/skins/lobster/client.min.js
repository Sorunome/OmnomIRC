"use strict";var oirc;$(function(){oirc=new OmnomIRC;var e=function(){var e={interval:false,$elem:false,start:function(){if(e.interval===false){var t=[true,true,true,true,true,false,false,false];e.$elem=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body");e.interval=setInterval(function(){e.$elem.empty().append($.map(t,function(e){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:e?"black":""})}));var n=t[0],i;for(i=1;i<=7;i++){t[i-1]=t[i]}t[7]=n},50)}},stop:function(){if(e.interval!==false){clearInterval(e.interval);e.interval=false;e.$elem.remove()}}};return{start:e.start,stop:e.stop}}(),t=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(t){var n;if(e.support_webkit){n=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",t);n.show()}else if(e.support()){n=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:t});n.onshow=function(){setTimeout(n.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");oirc.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(t){if(Notification.permission!==t){Notification.permission=t}if(t==="granted"){e.show("Notifications Enabled!");oirc.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},make:function(t,n){if(oirc.instant.current()){if(oirc.options.get("browserNotifications")){e.show(t)}if(oirc.options.get("ding")){$("#ding")[0].play()}if(n!=oirc.channels.current().handler){oirc.channels.highlight(n)}}else{if(n!=oirc.channels.current().handler){oirc.channels.highlight(n)}}e.startFlash()},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var t=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(t?"[ @] ":"[@ ] ")+e.originalTitle;t=!t},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(t){if(t===undefined){t=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!t){oirc.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(t){if(t.originalEvent.key==settings.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)})}};return{request:e.request,make:e.make,stopFlash:e.stopFlash,init:e.init}}(),n=function(){var t={draw:function(){var e=0,t=0,i=false,o=0,s=false,a=0,r=function(t){a=$(t).width();s=false;$(t).css({position:"absolute","z-index":100,left:e-o}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:a})).addClass("dragging").find("div").css("display","block").focus();i=false},c=function(e,n){e.preventDefault();t=e.clientX;o=t-$(n).position().left;i=true},l=function(n,s){e=n.clientX;if(i&&Math.abs(e-t)>=4){i=false;r(s);n.preventDefault()}else if($(s).hasClass("dragging")){var c=e-o,l=$("#topicDragPlaceHolder").next(".chanList"),u=$("#topicDragPlaceHolder").prev(".chanList");$(s).css("left",c);if(l.length>0&&l.position().left<c+a/2){l.after($("#topicDragPlaceHolder").remove())}else if(u.length>0){if(u.attr("id")==$(s).attr("id")){u=u.prev()}if(u.length>0&&u.position().left>c){u.before($("#topicDragPlaceHolder").remove())}}}},u=function(e,t){if(i){i=false}else{$(t).find("div").css("display","none");$("#topicDragPlaceHolder").replaceWith(t);oirc.channels.setChans($.map($(".chanList"),function(e,t){if($(e).find("span").hasClass("curchan")){oirc.options.set("curChan",t);oirc.channels.current().setI(t)}return $(e).data("json")}))}};$("#ChanList").empty().append($.map(oirc.channels.getList(),function(e,t){if(e.ex&&oirc.options.get("extraChans")||!e.ex){return $("<div>").data("json",e).attr("id","chan"+t.toString()).addClass("chanList"+(e.high?" highlightChan":"")).append($("<span>").addClass("chan "+(oirc.channels.current().is(t)?" curchan":"")).append(e.chan.substr(0,1)!="#"?$("<span>").addClass("closeButton").css({width:9,"float":"left"}).mouseup(function(e){if(s){oirc.channels.part(t)}}).text("x"):"",$("<span>").text(e.chan)).mouseup(function(){if(s){n.join(t)}}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(e){l(e,$(this).parent())}).mouseup(function(e){u(e,$(this).parent())}).mouseout(function(e){u(e,$(this).parent())})).mousedown(function(e){s=true;c(e,this)}).mousemove(function(e){l(e,this)}).mouseout(function(e){if(i){r(this)}}).mouseup(function(e){u(e,this)})}}))},init:function(){t.draw()},join:function(t,n){e.start();$("#message").attr("disabled","true");$("#MessageBox").empty();$(".chan").removeClass("curchan");oirc.channels.load(t,function(i,o){if(i){if(o.admin){$("#adminLink").css("display","")}else{$("#adminLink").css("display","none")}if(oirc.settings.loggedIn()){$("#message").removeAttr("disabled")}}$("#chan"+t.toString()).removeClass("highlightChan").find(".chan").addClass("curchan");if(n!==undefined){n(i)}e.stop()})}};return{init:t.init,draw:t.draw,join:t.join}}(),i=function(){var e={draw:function(e){$("#UserList").empty().append($.map(e,function(e){var t,n=encodeURIComponent(e.nick),i=$("<span>").text(e.nick).html();return $("<span>").attr("title",oirc.settings.getNetwork(e.network).name).append(oirc.settings.getNetwork(e.network).userlist.split("NICKENCODE").join(n).split("NICK").join(i),"<br>").mouseover(function(){t=oirc.network.getJSON("misc.php?userinfo&name="+base64.encode(e.nick)+"&chan="+oirc.channels.current().handlerB64+"&online="+e.network.toString(),function(e){if(e.last){$("#lastSeenCont").text("Last Seen: "+new Date(e.last*1e3).toLocaleString())}else{$("#lastSeenCont").text("Last Seen: never")}$("#lastSeenCont").css("display","block")})}).mouseout(function(){try{t.abort()}catch(e){}$("#lastSeenCont").css("display","none")})}),"<br><br>")}};return{draw:e.draw}}(),o=function(){var e={set:function(e){$("#topic").empty().append(e)}};return{set:e.set}}(),s=function(){var e={isDown:false,is_touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,headerOffset:0,$mBox:false,$mBoxCont:false,touchScroll:function(t,n){var i=-1;t.bind("touchstart",function(t){if($(t.target).is("a")){return}e.$mBox.css("transition","none");t.preventDefault();i=t.originalEvent.touches[0].clientY}).bind("touchmove",function(e){if($(e.target).is("a")){return}e.preventDefault();if(i==-1){return}var t=e.originalEvent.changedTouches[0].clientY;n(t-i);i=t}).bind("touchend touchcancel touchleave",function(t){if($(t.target).is("a")){return}e.$mBox.css("transition","");t.preventDefault();i=-1})},enableButtons:function(){var t=function(t,n,i){var o;$(t).mousedown(function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).mouseup(function(){try{clearInterval(o)}catch(e){}}).mouseout(function(){try{clearInterval(o)}catch(e){}});if(e.is_touch){$(t).bind("touchstart",function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(o)}catch(e){}})}};t("#arrowLeftChan","ChanListCont",-9);t("#arrowRightChan","ChanListCont",9);t("#arrowLeftTopic","topicCont",-9);t("#arrowRightTopic","topicCont",9)},moveWindow:function(t){var n=-parseInt(e.$mBox[0].style.top,10),i=e.$mBox.height()-e.$mBoxCont.height(),o=Math.min(i,Math.max(0,n-t));e.isDown=false;e.$mBox.css("top",-o);if(o==i){e.isDown=true}if(oirc.options.get("scrollBar")){e.reCalcBar()}},enableWheel:function(){e.$mBoxCont.bind("DOMMouseScroll mousewheel",function(t){var n=e.$mBox[0].style.top;e.moveWindow(/Firefox/i.test(navigator.userAgent)?t.originalEvent.detail*-20:t.originalEvent.wheelDelta/2);t.preventDefault();t.stopPropagation();t.cancelBubble=true});if(e.is_touch){e.touchScroll(e.$mBoxCont,function(t){e.moveWindow(t)})}},reCalcBar:function(){if($("#scrollBar").length!==0){if(e.$mBox.height()<=e.$mBoxCont.height()){$("#scrollBar").css("top",e.headerOffset)}else{$("#scrollBar").css("top",parseInt(e.$mBox[0].style.top,10)/(e.$mBoxCont.height()-e.$mBox.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-e.headerOffset)+e.headerOffset)}}},enableUserlist:function(){var t=function(e,t){$(t).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-t.scrollHeight,e+parseInt($("#UserList").css("top"),10))))};$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(e){if(e.preventDefault){e.preventDefault()}e=e.originalEvent;t(/Firefox/i.test(navigator.userAgent)?e.detail*-20:e.wheelDelta/2,this)});if(e.is_touch){e.touchScroll($("#UserList"),function(t){e.moveUserList(t,this)})}},showBar:function(){var t=false,n=false,i=function(i){var o=0;if(a.data("isClicked")){if(!(t!==false&&i<=t)&&!(n!==false&&i>=n)){o=parseInt(a.css("top"),10)+(i-a.data("prevY"));e.$mBox.css("top",-((o-e.headerOffset)/($("body")[0].offsetHeight-a[0].offsetHeight-e.headerOffset))*(e.$mBox.height()-e.$mBoxCont.height()));e.isDown=false;if(o<e.headerOffset){if(t===false){t=i}o=e.headerOffset;e.$mBox.css("top",0)}else{t=false}if(o>$("body")[0].offsetHeight-a[0].offsetHeight){if(n===false){n=i}o=$("body")[0].offsetHeight-a[0].offsetHeight;e.$mBox.css("top",e.$mBoxCont.height()-e.$mBox.height());e.isDown=true}else{n=false}a.css("top",o)}}a.data("prevY",i)},o=function(){a.data("isClicked",true);$("#scrollArea").css("display","block");e.$mBox.css("transition","none");c=false;t=false;n=false},s=function(){a.data("isClicked",false);$("#scrollArea").css("display","none");e.$mBox.css("transition","")},a=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:false}).appendTo("body").mousemove(function(e){i(e.clientY)}).mousedown(function(e){o()}).mouseup(function(){s()}),r,c=false;a.css("top",$("body")[0].offsetHeight-a[0].offsetHeight);r=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(e){i(e.clientY)}).mouseup(function(){s()}).mouseenter(function(e){if(e.originalEvent.buttons==0&&c){s()}c=true});if(e.is_touch){r.bind("touchend touchcancel touchleave",function(e){s()}).bind("touchmove",function(e){e.preventDefault();i(e.originalEvent.changedTouches[0].clientY)});a.bind("touchstart",function(e){e.preventDefault();o()}).bind("touchmove",function(e){e.preventDefault();i(e.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(e){e.preventDefault();s(e)})}r.appendTo("body");$("<div>").attr("id","scrollBarLine").appendTo("body");$(window).trigger("resize")},showButtons:function(){var t,n,i=function(){t=setInterval(function(){e.moveWindow(9)},50)},o=function(){n=setInterval(function(){e.moveWindow(-9)},50)},s;s=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){e.$mBox.css("transition","none");i()}).mouseout(function(){e.$mBox.css("transition","");try{clearInterval(t)}catch(n){}}).mouseup(function(){e.$mBox.css("transition","");try{clearInterval(t)}catch(n){}}));if(e.is_touch){s.bind("touchstart",function(){i()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(t)}catch(e){}})}s.appendTo("body");s=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){e.$mBox.css("transition","none");o()}).mouseout(function(){e.$mBox.css("transition","");try{clearInterval(n)}catch(t){}}).mouseup(function(){e.$mBox.css("transition","");try{clearInterval(n)}catch(t){}}));if(e.is_touch){s.bind("touchstart",function(){o()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(n)}catch(e){}})}s.appendTo("body")},down:function(){e.$mBox.css("top",e.$mBoxCont.height()-e.$mBox.height());e.reCalcBar();e.isDown=true},up:function(){e.$mBox.css("top",0);e.reCalcBar();e.isDown=false},slide:function(){if(e.isDown){e.down()}},init:function(){e.$mBox=$("#MessageBox");e.$mBoxCont=$("#mBoxCont");e.enableButtons();e.headerOffset=$("#header").height()-2;if(oirc.options.get("scrollBar")){e.showBar()}else{e.showButtons()}if(oirc.options.get("scrollWheel")){e.enableWheel()}e.enableUserlist();$(document).add(window).add("body").add("html").scroll(function(e){e.preventDefault()})}};return{down:e.down,up:e.up,slide:e.slide,init:e.init,reCalcBar:e.reCalcBar}}(),a=function(){var e={menuOpen:false,msgVal:"",hideMenu:function(){$("#textDecoForm").css("display","none");e.menuOpen=false},reverseParse:function(e){if(e.indexOf("<")===-1){return $("<span>").html(e).text()}var t=false,n=false,i=false,o="-1",s="-1";e=e.replace(/<img([^>]*?)>/gi,function(e,t){var n=t.match(/data-code="([^"]*)"/);if(n){return n[1]}return""});e=e.replace(/<span([^>]*?)>([^<]*?)<\/span>/gi,function(a,r,c){if(!r){return c}e="";if(r.indexOf("bold")==-1==t){t=!t;e+=""}if(r.indexOf("italic")==-1==n){n=!n;e+=""}if(r.indexOf("underline")==-1==i){i=!i;e+=""}var l=r.match(/fg-(\d+)/);dbg=r.match(/bg-(\d+)/);if(!l){l="-1"}if(!dbg){dbg="-1"}if(dbg!=s||l!=o){if(o!="-1"&&l=="-1"||s!="-1"&&dbg=="-1"){e="";if(t){e+=""}if(n){e+=""}if(i){e+=""}}e+="";o=l;if(o!="-1"){e+=o}s=dbg;if(s!="-1"){e+=","+s}}return e+c});return $("<span>").html(e).text()},getCaretCharacterOffsetWithin:function(e){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0),i=n.cloneRange(),o=0,s=document.createRange();i.selectNodeContents(e);i.setEnd(n.endContainer,n.endOffset);for(var a in i.commonAncestorContainer.getElementsByTagName("img")){if(a.dataset.code){s.selectNode(a);if(i.compareBoundaryPoints(Range.START_TO_START,s)!=1&&i.compareBoundaryPoints(Range.END_TO_END,s)!=-1){o+=a.dataset.code.length}}}return i.toString().length+o}return 0},getWholeSelection:function(t){var n=window.getSelection(),i,o=n.getRangeAt(0),s=o.cloneRange(),a=e.getCaretCharacterOffsetWithin(t);o.collapse(true);n.removeAllRanges();n.addRange(o);i=e.getCaretCharacterOffsetWithin(t);n.removeAllRanges();n.addRange(s);return[i,a]},setCaretCharacterOffsetWithin:function(t,n,i,o,s){if(i===undefined){i=0}if(o===undefined){o=document.createRange()}if(s===undefined){s=false}for(var a in t.childNodes){if(a.nodeType==3){if(a.length>=n){var r=window.getSelection();if(!s){o.setStart(a,n);s=true;n+=i}if(s&&a.length>=n){o.setEnd(a,n);r.removeAllRanges();r.addRange(o);return-1}}n-=a.length}else if(a.nodeType==1){if(a.tagName=="IMG"&&a.dataset.code){if(a.dataset.code.length>=n){var r=window.getSelection();if(!s){o.setStartAfter(a);s=true;n+=i}if(s&&a.dataset.code.length>=n){o.setEndAfter(a);r.removeAllRanges();r.addRange(o);return-1}}n-=a.dataset.code.length}else{n=e.setCaretCharacterOffsetWithin(a,n,i,o,s);if(n<0){return-1}}}else{n=e.setCaretCharacterOffsetWithin(a,n,i,o,s);if(n<0){return-1}}}return n},surroundSelection:function(e,t){var n=window.getSelection();if(n.rangeCount>0){var i=n.getRangeAt(0),o=i.startContainer,s=i.startOffset,a=document.createTextNode(e),r=document.createTextNode(t),c=i.cloneRange();c.collapse(false);c.insertNode(r);c.setStart(o,s);c.collapse(true);c.insertNode(a);i.setStartAfter(a);i.setEndBefore(r);n.removeAllRanges();n.addRange(i)}},updateContent:function(t,n){var i=$("#message");if(t===undefined){t=n=e.getCaretCharacterOffsetWithin(i[0])}e.msgVal=e.reverseParse(i.html());i.html(oirc.parser.parse(e.msgVal));var o=document.createRange();e.setCaretCharacterOffsetWithin(i[0],t,n-t)},init:function(){oirc.onsetval=function(t){e.msgVal=t;$("#message").html(oirc.parser.parse(t))};oirc.ongetval=function(){return e.msgVal};$("#message").on("input",function(t){e.updateContent()});$("#message").mouseup(function(t){var n=window.getSelection();if(n.isCollapsed){return}t.preventDefault();$("#textDecoForm").css({display:"block",left:Math.max(t.pageX-52,0)});e.menuOpen=true});$(document).mousedown(function(t){if(!$(t.target).closest("#textDecoForm").length&&e.menuOpen){e.hideMenu()}});$("#textDecoForm .colorbutton").click(function(t){t.preventDefault();var n=this.dataset.num,i=e.getWholeSelection($("#message")[0]);e.surroundSelection(""+n,"");e.updateContent(i[0],i[1])});$("#textDecoFormBold").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])});$("#textDecoFormItalic").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])});$("#textDecoFormUnderline").click(function(t){t.preventDefault();var n=e.getWholeSelection($("#message")[0]);e.surroundSelection("","");e.updateContent(n[0],n[1])})},support:function(){return"contentEditable"in document.documentElement&&oirc.options.get("wysiwyg")}};return{init:e.init,getMsg:e.getMsg,support:e.support,updateContent:e.updateContent}}(),r=function(){var e={init:function(){if(oirc.options.get("smileys")){$("#smileyMenuButton").css("cursor","pointer").click(function(){if($("#smileyselect").css("display")=="block"){$("#smileyselect").css("display","none");$(this).attr("src","smileys/smiley.gif")}else{$("#smileyselect").css("display","block");$(this).attr("src","smileys/tongue.gif")}})}else{$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")}},set:function(e){$("#smileyselect").empty().append($.map(e,function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!a.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code));a.updateContent()}}):""," "]}))}};return{init:e.init,set:e.set}}(),c=function(){var e={mBoxContWidthOffset:90,hide_userlist:false,show_scrollbar:true,registerToggle:function(){$("#toggleButton").click(function(e){e.preventDefault();oirc.options.set("enable",!oirc.options.get("enable"));document.location.reload()})},calcResize:function(t){var n=window.innerHeight,i=window.innerWidth,o=$("#header").outerHeight(),a=$("#footer").outerHeight(),r=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(t){$("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10));$("#mBoxCont").css("height",n-a-o-.2*r);$("html,body").height(n);$("#message").css("width",i*(e.hide_userlist?1:.91)-12*r-$("#loginForm").width())}if(e.show_scrollbar){var c=i/100*e.mBoxContWidthOffset;if(t){$("#mBoxCont").css("width",c-1.9*r)}$("#scrollBarLine").css("left",c-1.4*r);if(t){$("#scrollBarLine").css("height",n-o-.1*r)}$("#scrollBar").css("left",c-1.5*r);s.reCalcBar()}s.down()},initGuestLogin:function(){var e=function(e,n){oirc.settings.identGuest(e,n,function(n){if(!n.success){alert("ERROR"+(n.message?": "+n.message:""));t();return}$("#pickUsernamePopup").hide();$("#message").removeAttr("disabled");oirc.send.val("");$("#loginForm > button").hide();$("#guestName").text(e+" (guest) (").append($("<a>").text("logout").click(function(e){e.preventDefault();if(confirm("Are you sure? You won't be able to take this nick for half an hour!")){oirc.settings.logout();t()}}),")").show();$(window).trigger("resize")})},t=function(){oirc.send.val("You need to pick a username if you want to chat!");$("#message").attr("disabled",true);$("#loginForm > button").show();$("#guestName").hide();$(window).trigger("resize")};if(oirc.ls.get("guestName")){oirc.settings.login(oirc.ls.get("guestName"),oirc.ls.get("guestSig"));e(oirc.ls.get("guestName"),true)}else{t()}$("#loginForm").show();$("#loginForm > button").click(function(e){e.preventDefault();$("#pickUsernamePopup").toggle()});$("#pickUsernamePopup > button").click(function(t){e($('#pickUsernamePopup > input[type="text"]').val(),$('#pickUsernamePopup > input[type="checkbox"]')[0].checked)})},init:function(){var n=navigator.userAgent,i=n.indexOf("Mozilla/5.0")>-1&&n.indexOf("Android ")>-1&&n.indexOf("AppleWebKit")>-1&&!(n.indexOf("Chrome")>-1),o=n.match(/(iPod|iPhone|iPad)/i)&&n.match(/AppleWebKit/i),c=n.match(/AppleWebKit/i)&&n.match(/Android/i);$("body").css("font-size",oirc.options.get("fontSize").toString(10)+"pt");e.hide_userlist=oirc.options.get("hideUserlist");e.show_scrollbar=oirc.options.get("scrollBar");oirc.page.changeLinks();if(!a.support()){$("#message").replaceWith($("<input>").attr({type:"text",id:"message",accesskey:"i",maxlen:"256",autocomplete:"off"}))}else{$("#message").keydown(function(e){if(e.keyCode==13){e.preventDefault();$("#sendMessage").trigger("submit")}});a.init()}oirc.initinput();if(!oirc.settings.loggedIn()){oirc.send.val("You need to login if you want to chat!");if(oirc.settings.guestLevel()>=2){e.initGuestLogin()}}if(e.hide_userlist){e.mBoxContWidthOffset=99;$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head")}s.init();t.init();e.registerToggle();if(o){e.calcResize(true)}$(window).resize(function(){e.calcResize(!o)}).trigger("resize").focus(function(){t.stopFlash()});$("#aboutButton").click(function(e){e.preventDefault();$("#about").toggle()});r.init();$("#sendMessage").submit(function(e){e.preventDefault();if(oirc.settings.loggedIn()){if(!$("#message").attr("disabled")){oirc.send.send(function(){oirc.send.val("");$("#message").focus()})}}})},maxLines:200,lastMessage:0,lineHigh:false,addLine:function(t,n,i){var o=$("#MessageBox"),a="",r=new Date(i.time*1e3);if(o.find("tr").length>e.maxLines&&loadMode!==true){o.find("tr:first").remove()}if(t=="*"){a="* "}else{a="<"+i.name+"> "}if(oirc.options.get("times")){a="["+r.toLocaleTimeString()+"] "+a}a+=$("<span>").append(n).text();l.set(a);if(new Date(e.lastMessage).getDay()!=r.getDay()){o.append($("<tr>").addClass("dateSeperator").append($("<td>").addClass(oirc.options.get("altLines")&&(e.lineHigh=!e.lineHigh)?"lineHigh":"").attr("colspan",oirc.options.get("times")?3:2).text(r.toLocaleDateString())))}var c=$("<tr>").addClass(oirc.options.get("altLines")&&(e.lineHigh=!e.lineHigh)?"lineHigh":"").append(oirc.options.get("times")?$("<td>").addClass("irc-date").append("["+r.toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(t),$("<td>").addClass(i.type).append(n));c.find("img").load(function(e){s.slide()});o.append(c);s.slide();e.lastMessage=i.time*1e3;return},setSmileys:function(e){$("#smileyselect").empty().append($.map(e,function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!a.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code));a.updateContent()}}):""," "]}))}};return{init:e.init,registerToggle:e.registerToggle,addLine:e.addLine,setSmileys:e.setSmileys}}(),l=function(){var e={text:"",started:false,start:function(){if(!oirc.options.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(t){}}},500);e.started=true}},set:function(t){e.text=t;if(!e.started){e.start()}}};return{set:e.set}}();e.start();oirc.error.init();oirc.onmessage=c.addLine;oirc.onerror=oirc.error.addError;oirc.onwarning=oirc.error.addWarning;oirc.onuserchange=i.draw;oirc.onchannelchange=n.draw;oirc.onchanneljoin=function(e){if(!e){return}if(e[0]=="*"){oirc.channels.joinPm(e.substring(1),"",function(e){if(e!=-1){n.join(e)}});return}var t=oirc.channels.join(e);if(t!=-1){n.join(t)}};oirc.onchannelpart=oirc.channels.part;oirc.ontopicchange=o.set;oirc.onnotification=t.make;oirc.onsmileychange=c.setSmileys;oirc.connect(function(){if(oirc.options.get("enable")){c.init();n.join(oirc.options.get("curChan"),function(e){if(!e){n.join(0)}})}else{oirc.disconnect();c.registerToggle();$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(e){e.preventDefault();oirc.options.set("enable",true);window.location.reload()}));$("#footer,#header").css("display","none");e.stop()}})});