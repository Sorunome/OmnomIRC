"use strict";$(function(){var e=new OmnomIRC,t=function(){var e={interval:false,$elem:false,start:function(){if(e.interval===false){var t=[true,true,true,true,true,false,false,false];e.$elem=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body");e.interval=setInterval(function(){e.$elem.empty().append($.map(t,function(e){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:e?"black":""})}));var n=t[0],i;for(i=1;i<=7;i++){t[i-1]=t[i]}t[7]=n},50)}},stop:function(){if(e.interval!==false){clearInterval(e.interval);e.interval=false;e.$elem.remove()}}};return{start:e.start,stop:e.stop}}(),n=function(){var i={draw:function(){var t=0,i=0,o=false,a=0,s=false,r=0,c=function(e){r=$(e).width();s=false;$(e).css({position:"absolute","z-index":100,left:t-a}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:r})).addClass("dragging").find("div").css("display","block").focus();o=false},l=function(e,t){e.preventDefault();i=e.clientX;a=i-$(t).position().left;o=true},u=function(e,n){t=e.clientX;if(o&&Math.abs(t-i)>=4){o=false;c(n);e.preventDefault()}else if($(n).hasClass("dragging")){var s=t-a,l=$("#topicDragPlaceHolder").next(".chanList"),u=$("#topicDragPlaceHolder").prev(".chanList");$(n).css("left",s);if(l.length>0&&l.position().left<s+r/2){l.after($("#topicDragPlaceHolder").remove())}else if(u.length>0){if(u.attr("id")==$(n).attr("id")){u=u.prev()}if(u.length>0&&u.position().left>s){u.before($("#topicDragPlaceHolder").remove())}}}},f=function(t,n){if(o){o=false}else{$(n).find("div").css("display","none");$("#topicDragPlaceHolder").replaceWith(n);e.channels.setChans($.map($(".chanList"),function(t,n){if($(t).find("span").hasClass("curchan")){e.options.set("curChan",n);e.channels.current().setI(n)}return $(t).data("json")}))}};$("#ChanList").empty().append($.map(e.channels.getList(),function(t,i){if(t.ex&&e.options.get("extraChans")||!t.ex){return $("<div>").data("json",t).attr("id","chan"+i.toString()).addClass("chanList"+(t.high?" highlightChan":"")).append($("<span>").addClass("chan "+(e.channels.current().is(i)?" curchan":"")).append(t.chan.substr(0,1)!="#"?$("<span>").addClass("closeButton").css({width:9,"float":"left"}).mouseup(function(t){if(s){e.channels.part(i)}}).text("x"):"",$("<span>").text(t.chan)).mouseup(function(){if(s){e.channels.current().unload();n.join(i)}}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(e){u(e,$(this).parent())}).mouseup(function(e){f(e,$(this).parent())}).mouseout(function(e){f(e,$(this).parent())})).mousedown(function(e){s=true;l(e,this)}).mousemove(function(e){u(e,this)}).mouseout(function(e){if(o){c(this)}}).mouseup(function(e){f(e,this)})}}))},init:function(){i.draw()},join:function(n,i){t.start();$("#message").attr("disabled","true");$("#MessageBox").empty();$(".chan").removeClass("curchan");e.channels.load(n,function(o,s){if(o){if(s.admin){$("#adminLink").css("display","")}else{$("#adminLink").css("display","none")}if(e.settings.loggedIn()){$("#message").removeAttr("disabled")}}$("#chan"+n.toString()).removeClass("highlightChan").find(".chan").addClass("curchan");if(i!==undefined){i(o)}a.down();t.stop()})}};return{init:i.init,draw:i.draw,join:i.join}}(),i=function(){var t={draw:function(t){$("#UserList").empty().append($.map(t,function(t){var n,i=encodeURIComponent(t.nick),o=$("<span>").text(t.nick).html();return $("<span>").attr("title",e.settings.getNetwork(t.network).name).append(e.settings.getNetwork(t.network).userlist.split("NICKENCODE").join(i).split("NICK").join(o),"<br>").mouseover(function(){n=e.network.getJSON("misc.php?userinfo&name="+base64.encode(t.nick)+"&chan="+e.channels.current().handlerB64+"&online="+t.network.toString(),function(e){if(e.last){$("#lastSeenCont").text("Last Seen: "+new Date(e.last*1e3).toLocaleString())}else{$("#lastSeenCont").text("Last Seen: never")}$("#lastSeenCont").css("display","block")})}).mouseout(function(){try{n.abort()}catch(e){}$("#lastSeenCont").css("display","none")})}),"<br><br>")}};return{draw:t.draw}}(),o=function(){var e={set:function(e){$("#topic").empty().append(e)}};return{set:e.set}}(),a=function(){var t={isDown:false,is_touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,headerOffset:0,$mBox:false,$mBoxCont:false,touchScroll:function(e,n){var i=-1;e.bind("touchstart",function(e){if($(e.target).is("a")){return}t.$mBox.css("transition","none");e.preventDefault();i=e.originalEvent.touches[0].clientY}).bind("touchmove",function(e){if($(e.target).is("a")){return}e.preventDefault();if(i==-1){return}var t=e.originalEvent.changedTouches[0].clientY;n(t-i);i=t}).bind("touchend touchcancel touchleave",function(e){if($(e.target).is("a")){return}t.$mBox.css("transition","");e.preventDefault();i=-1})},enableButtons:function(){var e=function(e,n,i){var o;$(e).mousedown(function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).mouseup(function(){try{clearInterval(o)}catch(e){}}).mouseout(function(){try{clearInterval(o)}catch(e){}});if(t.is_touch){$(e).bind("touchstart",function(){o=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(o)}catch(e){}})}};e("#arrowLeftChan","ChanListCont",-9);e("#arrowRightChan","ChanListCont",9);e("#arrowLeftTopic","topicCont",-9);e("#arrowRightTopic","topicCont",9)},moveWindow:function(n){var i=-parseInt(t.$mBox[0].style.top,10),o=t.$mBox.height()-t.$mBoxCont.height(),a=Math.min(o,Math.max(0,i-n));t.isDown=false;t.$mBox.css("top",-a);if(a==o){t.isDown=true}if(e.options.get("scrollBar")){t.reCalcBar()}},enableWheel:function(){t.$mBoxCont.bind("DOMMouseScroll mousewheel",function(e){var n=t.$mBox[0].style.top;t.moveWindow(/Firefox/i.test(navigator.userAgent)?e.originalEvent.detail*-20:e.originalEvent.wheelDelta/2);e.preventDefault();e.stopPropagation();e.cancelBubble=true});if(t.is_touch){t.touchScroll(t.$mBoxCont,function(e){t.moveWindow(e)})}},reCalcBar:function(){if($("#scrollBar").length!==0){if(t.$mBox.height()<=t.$mBoxCont.height()){$("#scrollBar").css("top",t.headerOffset)}else{$("#scrollBar").css("top",parseInt(t.$mBox[0].style.top,10)/(t.$mBoxCont.height()-t.$mBox.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-t.headerOffset)+t.headerOffset)}}},enableUserlist:function(){var e=function(e,t){$(t).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-t.scrollHeight,e+parseInt($("#UserList").css("top"),10))))};$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(t){if(t.preventDefault){t.preventDefault()}t=t.originalEvent;e(/Firefox/i.test(navigator.userAgent)?t.detail*-20:t.wheelDelta/2,this)});if(t.is_touch){t.touchScroll($("#UserList"),function(e){t.moveUserList(e,this)})}},showBar:function(){var e=false,n=false,i=function(i){var o=0;if(s.data("isClicked")){if(!(e!==false&&i<=e)&&!(n!==false&&i>=n)){o=parseInt(s.css("top"),10)+(i-s.data("prevY"));t.$mBox.css("top",-((o-t.headerOffset)/($("body")[0].offsetHeight-s[0].offsetHeight-t.headerOffset))*(t.$mBox.height()-t.$mBoxCont.height()));t.isDown=false;if(o<t.headerOffset){if(e===false){e=i}o=t.headerOffset;t.$mBox.css("top",0)}else{e=false}if(o>$("body")[0].offsetHeight-s[0].offsetHeight){if(n===false){n=i}o=$("body")[0].offsetHeight-s[0].offsetHeight;t.$mBox.css("top",t.$mBoxCont.height()-t.$mBox.height());t.isDown=true}else{n=false}s.css("top",o)}}s.data("prevY",i)},o=function(){s.data("isClicked",true);$("#scrollArea").css("display","block");t.$mBox.css("transition","none");c=false;e=false;n=false},a=function(){s.data("isClicked",false);$("#scrollArea").css("display","none");t.$mBox.css("transition","")},s=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:false}).appendTo("body").mousemove(function(e){i(e.clientY)}).mousedown(function(e){o()}).mouseup(function(){a()}),r,c=false;s.css("top",$("body")[0].offsetHeight-s[0].offsetHeight);r=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(e){i(e.clientY)}).mouseup(function(){a()}).mouseenter(function(e){if(e.originalEvent.buttons==0&&c){a()}c=true});if(t.is_touch){r.bind("touchend touchcancel touchleave",function(e){a()}).bind("touchmove",function(e){e.preventDefault();i(e.originalEvent.changedTouches[0].clientY)});s.bind("touchstart",function(e){e.preventDefault();o()}).bind("touchmove",function(e){e.preventDefault();i(e.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(e){e.preventDefault();a(e)})}r.appendTo("body");$("<div>").attr("id","scrollBarLine").appendTo("body");$(window).trigger("resize")},showButtons:function(){var e,n,i=function(){e=setInterval(function(){t.moveWindow(9)},50)},o=function(){n=setInterval(function(){t.moveWindow(-9)},50)},a;a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){t.$mBox.css("transition","none");i()}).mouseout(function(){t.$mBox.css("transition","");try{clearInterval(e)}catch(n){}}).mouseup(function(){t.$mBox.css("transition","");try{clearInterval(e)}catch(n){}}));if(t.is_touch){a.bind("touchstart",function(){i()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(e)}catch(t){}})}a.appendTo("body");a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){t.$mBox.css("transition","none");o()}).mouseout(function(){t.$mBox.css("transition","");try{clearInterval(n)}catch(e){}}).mouseup(function(){t.$mBox.css("transition","");try{clearInterval(n)}catch(e){}}));if(t.is_touch){a.bind("touchstart",function(){o()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(n)}catch(e){}})}a.appendTo("body")},down:function(){t.$mBox.css("top",t.$mBoxCont.height()-t.$mBox.height());t.reCalcBar();t.isDown=true},up:function(){t.$mBox.css("top",0);t.reCalcBar();t.isDown=false},slide:function(){if(t.isDown){t.down()}},init:function(){t.$mBox=$("#MessageBox");t.$mBoxCont=$("#mBoxCont");t.enableButtons();t.headerOffset=$("#header").height()-2;if(e.options.get("scrollBar")){t.showBar()}else{t.showButtons()}if(e.options.get("scrollWheel")){t.enableWheel()}t.enableUserlist();$(document).add(window).add("body").add("html").scroll(function(e){e.preventDefault()})}};return{down:t.down,up:t.up,slide:t.slide,init:t.init,reCalcBar:t.reCalcBar}}(),s=function(){var t={menuOpen:false,msgVal:"",hideMenu:function(){$("#textDecoForm").css("display","none");t.menuOpen=false},reverseParse:function(e){if(e.indexOf("<")===-1){return $("<span>").html(e).text()}var t=false,n=false,i=false,o="-1",a="-1";e=e.replace(/<img([^>]*?)>/gi,function(e,t){var n=t.match(/data-code="([^"]*)"/);if(n){return n[1]}return""});e=e.replace(/<span([^>]*?)>([^<]*?)<\/span>/gi,function(s,r,c){if(!r){return c}e="";if(r.indexOf("bold")==-1==t){t=!t;e+=""}if(r.indexOf("italic")==-1==n){n=!n;e+=""}if(r.indexOf("underline")==-1==i){i=!i;e+=""}var l=r.match(/fg-(\d+)/);dbg=r.match(/bg-(\d+)/);if(!l){l="-1"}if(!dbg){dbg="-1"}if(dbg!=a||l!=o){if(o!="-1"&&l=="-1"||a!="-1"&&dbg=="-1"){e="";if(t){e+=""}if(n){e+=""}if(i){e+=""}}e+="";o=l;if(o!="-1"){e+=o}a=dbg;if(a!="-1"){e+=","+a}}return e+c});return $("<span>").html(e).text()},getCaretCharacterOffsetWithin:function(e){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0),i=n.cloneRange(),o=0,a=document.createRange();i.selectNodeContents(e);i.setEnd(n.endContainer,n.endOffset);for(var s in i.commonAncestorContainer.getElementsByTagName("img")){if(s.dataset.code){a.selectNode(s);if(i.compareBoundaryPoints(Range.START_TO_START,a)!=1&&i.compareBoundaryPoints(Range.END_TO_END,a)!=-1){o+=s.dataset.code.length}}}return i.toString().length+o}return 0},getWholeSelection:function(e){var n=window.getSelection(),i,o=n.getRangeAt(0),a=o.cloneRange(),s=t.getCaretCharacterOffsetWithin(e);o.collapse(true);n.removeAllRanges();n.addRange(o);i=t.getCaretCharacterOffsetWithin(e);n.removeAllRanges();n.addRange(a);return[i,s]},setCaretCharacterOffsetWithin:function(e,n,i,o,a){if(i===undefined){i=0}if(o===undefined){o=document.createRange()}if(a===undefined){a=false}for(var s in e.childNodes){if(s.nodeType==3){if(s.length>=n){var r=window.getSelection();if(!a){o.setStart(s,n);a=true;n+=i}if(a&&s.length>=n){o.setEnd(s,n);r.removeAllRanges();r.addRange(o);return-1}}n-=s.length}else if(s.nodeType==1){if(s.tagName=="IMG"&&s.dataset.code){if(s.dataset.code.length>=n){var r=window.getSelection();if(!a){o.setStartAfter(s);a=true;n+=i}if(a&&s.dataset.code.length>=n){o.setEndAfter(s);r.removeAllRanges();r.addRange(o);return-1}}n-=s.dataset.code.length}else{n=t.setCaretCharacterOffsetWithin(s,n,i,o,a);if(n<0){return-1}}}else{n=t.setCaretCharacterOffsetWithin(s,n,i,o,a);if(n<0){return-1}}}return n},surroundSelection:function(e,t){var n=window.getSelection();if(n.rangeCount>0){var i=n.getRangeAt(0),o=i.startContainer,a=i.startOffset,s=document.createTextNode(e),r=document.createTextNode(t),c=i.cloneRange();c.collapse(false);c.insertNode(r);c.setStart(o,a);c.collapse(true);c.insertNode(s);i.setStartAfter(s);i.setEndBefore(r);n.removeAllRanges();n.addRange(i)}},updateContent:function(n,i){var o=$("#message");if(n===undefined){n=i=t.getCaretCharacterOffsetWithin(o[0])}t.msgVal=t.reverseParse(o.html());o.html(e.parser.parse(t.msgVal));var a=document.createRange();t.setCaretCharacterOffsetWithin(o[0],n,i-n)},init:function(){e.onsetval=function(n){t.msgVal=n;$("#message").html(e.parser.parse(n))};e.ongetval=function(){return t.msgVal};$("#message").on("input",function(e){t.updateContent()});$("#message").mouseup(function(e){var n=window.getSelection();if(n.isCollapsed){return}e.preventDefault();$("#textDecoForm").css({display:"block",left:Math.max(e.pageX-52,0)});t.menuOpen=true});$(document).mousedown(function(e){if(!$(e.target).closest("#textDecoForm").length&&t.menuOpen){t.hideMenu()}});$("#textDecoForm .colorbutton").click(function(e){e.preventDefault();var n=this.dataset.num,i=t.getWholeSelection($("#message")[0]);t.surroundSelection(""+n,"");t.updateContent(i[0],i[1])});$("#textDecoFormBold").click(function(e){e.preventDefault();var n=t.getWholeSelection($("#message")[0]);t.surroundSelection("","");t.updateContent(n[0],n[1])});$("#textDecoFormItalic").click(function(e){e.preventDefault();var n=t.getWholeSelection($("#message")[0]);t.surroundSelection("","");t.updateContent(n[0],n[1])});$("#textDecoFormUnderline").click(function(e){e.preventDefault();var n=t.getWholeSelection($("#message")[0]);t.surroundSelection("","");t.updateContent(n[0],n[1])})},support:function(){return"contentEditable"in document.documentElement&&e.options.get("wysiwyg")}};return{init:t.init,getMsg:t.getMsg,support:t.support,updateContent:t.updateContent}}(),r=function(){var t={init:function(){if(e.options.get("smileys")){$("#smileyMenuButton").css("cursor","pointer").click(function(){if($("#smileyselect").css("display")=="block"){$("#smileyselect").css("display","none");$(this).attr("src","smileys/smiley.gif")}else{$("#smileyselect").css("display","block");$(this).attr("src","smileys/tongue.gif")}})}else{$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")}},set:function(e){$("#smileyselect").empty().append($.map(e,function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!s.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code));s.updateContent()}}):""," "]}))}};return{init:t.init,set:t.set}}(),c=function(){var t={mBoxContWidthOffset:90,hide_userlist:false,show_scrollbar:true,registerToggle:function(){$("#toggleButton").click(function(t){t.preventDefault();e.options.set("enable",!e.options.get("enable"));document.location.reload()})},calcResize:function(e){var n=window.innerHeight,i=window.innerWidth,o=$("#header").outerHeight(),s=$("#footer").outerHeight(),r=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(e){$("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10));$("#mBoxCont").css("height",n-s-o-.2*r);$("html,body").height(n);$("#message").css("width",i*(t.hide_userlist?1:.91)-12*r-$("#loginForm").width())}if(t.show_scrollbar){var c=i/100*t.mBoxContWidthOffset;if(e){$("#mBoxCont").css("width",c-1.9*r)}$("#scrollBarLine").css("left",c-1.4*r);if(e){$("#scrollBarLine").css("height",n-o-.1*r)}$("#scrollBar").css("left",c-1.5*r);a.reCalcBar()}a.down()},initGuestLogin:function(){var t=function(t,i,o,a){if(o===undefined){o=i;i=""}e.settings.identGuest(t,i,o,function(i){if(!i.success){if(!a){alert("ERROR"+(i.message?": "+i.message:""))}n();return}$("#pickUsernamePopup").hide();$("#message").removeAttr("disabled");e.send.val("");$("#loginForm > button").hide();$("#guestName").text(t+" (guest) (").append($("<a>").text("logout").click(function(t){t.preventDefault();if(confirm("Are you sure? You won't be able to take this nick for half an hour!")){e.settings.logout();n()}}),")").show();$(window).trigger("resize")})},n=function(){e.send.val("You need to pick a username if you want to chat!");$("#message").attr("disabled",true);$("#loginForm > button").show();$("#guestName").hide();$(window).trigger("resize")};if(e.ls.get("guestName")){t(e.ls.get("guestName"),e.ls.get("guestSig"),true,true)}else{n()}$("#loginForm").show();$("#loginForm > button").click(function(e){e.preventDefault();$("#pickUsernamePopup").toggle()});$("#pickUsernamePopup > button").click(function(e){t($('#pickUsernamePopup > input[type="text"]').val(),$('#pickUsernamePopup > input[type="checkbox"]')[0].checked)})},init:function(){var n=navigator.userAgent,i=n.indexOf("Mozilla/5.0")>-1&&n.indexOf("Android ")>-1&&n.indexOf("AppleWebKit")>-1&&!(n.indexOf("Chrome")>-1),o=n.match(/(iPod|iPhone|iPad)/i)&&n.match(/AppleWebKit/i),c=n.match(/AppleWebKit/i)&&n.match(/Android/i);$("body").css("font-size",e.options.get("fontSize").toString(10)+"pt");t.hide_userlist=e.options.get("hideUserlist");t.show_scrollbar=e.options.get("scrollBar");e.page.changeLinks();if(!s.support()){$("#message").replaceWith($("<input>").attr({type:"text",id:"message",accesskey:"i",maxlen:"256",autocomplete:"off"}))}else{$("#message").keydown(function(e){if(e.keyCode==13){e.preventDefault();$("#sendMessage").trigger("submit")}});s.init()}e.initinput();if(!e.settings.loggedIn()){e.send.val("You need to login if you want to chat!");if(e.settings.guestLevel()>=2){t.initGuestLogin()}}if(t.hide_userlist){t.mBoxContWidthOffset=99;$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head")}a.init();t.registerToggle();if(o){t.calcResize(true)}$(window).resize(function(){t.calcResize(!o)}).trigger("resize");$("#aboutButton").click(function(e){e.preventDefault();$("#about").toggle()});r.init();l.init();$("#sendMessage").submit(function(t){t.preventDefault();if(e.settings.loggedIn()){if(!$("#message").attr("disabled")){e.send.send(function(){e.send.val("");$("#message").focus()})}}})},maxLines:200,lastMessage:0,lineHigh:false,addLine:function(n,i,o){var s=$("#MessageBox"),r="",c=new Date(o.time*1e3);if(s.find("tr").length>t.maxLines&&loadMode!==true){s.find("tr:first").remove()}if(n=="*"){r="* "}else{r="<"+o.name+"> "}if(e.options.get("times")){r="["+c.toLocaleTimeString()+"] "+r}r+=$("<span>").append(i).text();e.statusBar.set(r);if(new Date(t.lastMessage).getDay()!=c.getDay()){s.append($("<tr>").addClass("dateSeperator").append($("<td>").addClass(e.options.get("altLines")&&(t.lineHigh=!t.lineHigh)?"lineHigh":"").attr("colspan",e.options.get("times")?3:2).text(c.toLocaleDateString())))}var l=$("<tr>").addClass(e.options.get("altLines")&&(t.lineHigh=!t.lineHigh)?"lineHigh":"").append(e.options.get("times")?$("<td>").addClass("irc-date").append("["+c.toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(n),$("<td>").addClass(o.type).append(i));l.find("img").load(function(e){a.slide()});s.append(l);a.slide();t.lastMessage=o.time*1e3;return},setSmileys:function(e){$("#smileyselect").empty().append($.map(e,function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!s.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code));s.updateContent()}}):""," "]}))}};return{init:t.init,registerToggle:t.registerToggle,addLine:t.addLine,setSmileys:t.setSmileys}}(),l=function(){var n={isOpen:false,year:0,month:0,day:0,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],getLogUrlParam:function(){return base64.encode(n.year.toString(10)+"-"+n.month.toString(10)+"-"+n.day.toString(10))},updateInputVal:function(){$("#logDate").val(n.months[n.month-1]+" "+n.day.toString(10)+" "+n.year.toString(10))},displayDatePicker:function(){var e=new Date(n.year,n.month,n.day),t=["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],i=new Date(n.year,n.month,0).getDate(),o=new Date(n.year,n.month-1,1).getDay(),a=0;if(n.day>i){n.day=i}n.updateInputVal();$("#logDatePicker").empty().append($("<a>").text("<").click(function(e){e.preventDefault();e.stopPropagation();n.year--;n.displayDatePicker()})," ",n.year.toString(10)," ",$("<a>").text(">").click(function(e){e.preventDefault();e.stopPropagation();n.year++;n.displayDatePicker()}),"<br>",$("<a>").text("<").click(function(e){e.preventDefault();e.stopPropagation();n.month--;if(n.month<1){n.month=12;n.year--}n.displayDatePicker()})," ",n.months[n.month-1]," ",$("<a>").text(">").click(function(e){e.preventDefault();e.stopPropagation();n.month++;if(n.month>12){n.month=1;n.year++}n.displayDatePicker()}),"<br>",$("<table>").append($("<tr>").append($.map(t,function(e){return $("<th>").text(e)})),$.map([0,1,2,3,4,5],function(){if(a>=i){return}return $("<tr>").append($.map([0,1,2,3,4,5,6],function(e){if(a==0&&e!=o||a>=i){return $("<td>").text(" ")}a++;return $("<td>").text(a).addClass("logDatePickerDay").addClass(a==n.day?"current":"").data("day",a).click(function(){$(".logDatePickerDay.current").removeClass("current");n.day=$(this).addClass("current").data("day");n.updateInputVal()})}))})));$("#logDatePicker").css("display","block")},open:function(){var i=new Date;t.start();e.logs.open(function(){$("#MessageBox").empty();$("#message").attr("disabled","true");e.users.setUsers([]);$("#chattingHeader").css("display","none");$("#logDatePicker").css("display","none");$("#logsHeader").css("display","block");$("#logChanIndicator").text(e.channels.current().name);n.year=parseInt(i.getFullYear(),10);n.month=parseInt(i.getMonth()+1,10);n.day=parseInt(i.getDate(),10);n.updateInputVal();n.isOpen=true;n.fetch()})},close:function(){e.logs.close();$("#chattingHeader").css("display","block");$("#logsHeader").css("display","none");n.isOpen=false},fetch:function(){t.start();$("#MessageBox").empty();e.logs.fetch(n.getLogUrlParam(),function(){a.up();t.stop()})},toggle:function(){if(n.isOpen){n.close()}else{n.open()}},init:function(){$("#logCloseButton").click(function(e){e.preventDefault();n.close()});$("#logGoButton").click(function(e){e.preventDefault();n.fetch()});$("#logsButton").click(function(e){e.preventDefault();n.toggle()});$("#logDate").click(function(e){e.preventDefault();$(this).focusout();if($("#logDatePicker").css("display")!="block"){n.displayDatePicker();e.stopPropagation()}});$(document).click(function(e){if(n.isOpen){var t=$("#logDatePicker");if(!t.is(e.target)&&t.has(e.target).length===0){t.css("display","none")}}})}};return{init:n.init}}();t.start();e.error.init();e.onmessage=c.addLine;e.onerror=e.error.addError;e.onwarning=e.error.addWarning;e.onuserchange=i.draw;e.onchannelchange=n.draw;e.onchanneljoin=function(t){if(!t){return}if(t[0]=="*"){e.channels.joinPm(t.substring(1),"",function(e){if(e!=-1){n.join(e)}});return}var i=e.channels.join(t);if(i!=-1){n.join(i)}};e.onchannelpart=e.channels.part;e.ontopicchange=o.set;e.onnotification=function(t,n,i){if(n!=e.channels.current().handler){e.channels.highlight(n)}};e.onsmileychange=c.setSmileys;e.connect(function(){if(e.options.get("enable")){c.init();n.join(e.options.get("curChan"),function(e){if(!e){n.join(0)}})}else{e.disconnect();c.registerToggle();$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(t){t.preventDefault();e.options.set("enable",true);window.location.reload()}));$("#footer,#header").css("display","none");t.stop()}})});