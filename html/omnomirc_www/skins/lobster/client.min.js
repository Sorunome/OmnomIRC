/**
 * @license
 * OmnomIRC COPYRIGHT 2010,2011 Netham45
 *                    2012-2017 Sorunome
 *
 *  This file is part of OmnomIRC.
 *
 *  OmnomIRC is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  OmnomIRC is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with OmnomIRC.  If not, see <http://www.gnu.org/licenses/>.
 */
"use strict";$(function(){var i,c,t,l,e,o,d=new OmnomIRC,a={start:(o={interval:!1,$elem:!1,start:function(){if(!1===o.interval){var n=[!0,!0,!0,!0,!0,!1,!1,!1];o.$elem=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body"),o.interval=setInterval(function(){o.$elem.empty().append($.map(n,function(t){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:t?"black":""})}));var t,e=n[0];for(t=1;t<=7;t++)n[t-1]=n[t];n[7]=e},50)}},stop:function(){!1!==o.interval&&(clearInterval(o.interval),o.interval=!1,o.$elem.remove())}}).start,stop:o.stop},p={init:(e={draw:function(){var a=0,s=0,r=!1,c=0,o=!1,l=0,u=function(t){l=$(t).width(),o=!1,$(t).css({position:"absolute","z-index":100,left:a-c}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:l})).addClass("dragging").find("div").css("display","block").focus(),r=!1},n=function(t,e){if(a=t.clientX,r&&4<=Math.abs(a-s))r=!1,u(e),t.preventDefault();else if($(e).hasClass("dragging")){var n=a-c,o=$("#topicDragPlaceHolder").next(".chanList"),i=$("#topicDragPlaceHolder").prev(".chanList");$(e).css("left",n),0<o.length&&o.position().left<n+l/2?o.after($("#topicDragPlaceHolder").remove()):0<i.length&&(i.attr("id")==$(e).attr("id")&&(i=i.prev()),0<i.length&&i.position().left>n&&i.before($("#topicDragPlaceHolder").remove()))}},i=function(t,e){r?r=!1:($(e).find("div").css("display","none"),$("#topicDragPlaceHolder").replaceWith(e),d.channels.setChans($.map($(".chanList"),function(t,e){return $(t).find("span").hasClass("curchan")&&(d.options.set("curChan",e),d.channels.current().setI(e)),$(t).data("json")})))};$("#ChanList").empty().append($.map(d.channels.getList(),function(t,e){if(t.ex&&d.options.get("extraChans")||!t.ex)return $("<div>").data("json",t).attr("id","chan"+e.toString()).addClass("chanList"+(t.high?" highlightChan":"")).append($("<span>").addClass("chan "+(d.channels.current().is(e)?" curchan":"")).append("#"!=t.chan.substr(0,1)?$("<span>").addClass("closeButton").css({width:9,float:"left"}).mouseup(function(t){o&&d.channels.part(e)}).text("x"):"",$("<span>").text(t.chan)).mouseup(function(){o&&(d.channels.current().unload(),p.join(e))}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(t){n(t,$(this).parent())}).mouseup(function(t){i(0,$(this).parent())}).mouseout(function(t){i(0,$(this).parent())})).mousedown(function(t){var e,n;o=!0,n=this,(e=t).preventDefault(),s=e.clientX,c=s-$(n).position().left,r=!0}).mousemove(function(t){n(t,this)}).mouseout(function(t){r&&u(this)}).mouseup(function(t){i(0,this)})}))},init:function(){e.draw()},join:function(n,o){a.start(),$("#message").attr("disabled","true"),$("#MessageBox").empty().css("transition","none"),$(".chan").removeClass("curchan"),d.channels.load(n,function(t,e){t&&(e.admin?$("#adminLink").css("display",""):$("#adminLink").css("display","none"),d.settings.loggedIn()&&$("#message").removeAttr("disabled")),$("#chan"+n.toString()).removeClass("highlightChan").find(".chan").addClass("curchan"),void 0!==o&&o(t),u.down(),$("#MessageBox").css("transition",""),a.stop()})}}).init,draw:e.draw,join:e.join},n={draw:function(t){$("#UserList").empty().append($.map(t,function(t){var e,n=encodeURIComponent(t.nick),o=$("<span>").text(t.nick).html();return $("<span>").attr("title",d.settings.getNetwork(t.network).name).append(d.settings.getNetwork(t.network).userlist.split("NICKENCODE").join(n).split("NICK").join(o),"<br>").mouseover(function(){e=d.network.getJSON("misc.php?userinfo&name="+base64.encode(t.nick)+"&chan="+d.channels.current().handlerB64+"&online="+t.network.toString(),function(t){t.last?$("#lastSeenCont").text("Last Seen: "+new Date(1e3*t.last).toLocaleString()):$("#lastSeenCont").text("Last Seen: never"),$("#lastSeenCont").css("display","block")})}).mouseout(function(){try{e.abort()}catch(t){}$("#lastSeenCont").css("display","none")})}),"<br><br>")}},s={set:function(t){$("#topic").empty().append(t)}},u={down:(l={isDown:!1,is_touch:"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,headerOffset:0,$mBox:!1,$mBoxCont:!1,touchScroll:function(t,n){var o=-1;t.bind("touchstart",function(t){$(t.target).is("a")||(l.$mBox.css("transition","none"),t.preventDefault(),o=t.originalEvent.touches[0].clientY)}).bind("touchmove",function(t){if(!$(t.target).is("a")&&(t.preventDefault(),-1!=o)){var e=t.originalEvent.changedTouches[0].clientY;n(e-o),o=e}}).bind("touchend touchcancel touchleave",function(t){$(t.target).is("a")||(l.$mBox.css("transition",""),t.preventDefault(),o=-1)})},enableButtons:function(){var t=function(t,e,n){var o;$(t).mousedown(function(){o=setInterval(function(){document.getElementById(e).scrollLeft+=n},50)}).mouseup(function(){try{clearInterval(o)}catch(t){}}).mouseout(function(){try{clearInterval(o)}catch(t){}}),l.is_touch&&$(t).bind("touchstart",function(){o=setInterval(function(){document.getElementById(e).scrollLeft+=n},50)}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(o)}catch(t){}})};t("#arrowLeftChan","ChanListCont",-9),t("#arrowRightChan","ChanListCont",9),t("#arrowLeftTopic","topicCont",-9),t("#arrowRightTopic","topicCont",9)},moveWindow:function(t){var e=-parseInt(l.$mBox[0].style.top,10),n=l.$mBox.height()-l.$mBoxCont.height(),o=Math.min(n,Math.max(0,e-t));l.isDown=!1,l.$mBox.css("top",-o),o==n&&(l.isDown=!0),d.options.get("scrollBar")&&l.reCalcBar()},enableWheel:function(){l.$mBoxCont.bind("DOMMouseScroll mousewheel",function(t){l.moveWindow(/Firefox/i.test(navigator.userAgent)?-20*t.originalEvent.detail:t.originalEvent.wheelDelta/2),t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}),l.is_touch&&l.touchScroll(l.$mBoxCont,function(t){l.moveWindow(t)})},reCalcBar:function(){0!==$("#scrollBar").length&&(l.$mBox.height()<=l.$mBoxCont.height()?$("#scrollBar").css("top",l.headerOffset):$("#scrollBar").css("top",parseInt(l.$mBox[0].style.top,10)/(l.$mBoxCont.height()-l.$mBox.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-l.headerOffset)+l.headerOffset))},enableUserlist:function(){$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(t){var e,n;t.preventDefault&&t.preventDefault(),t=t.originalEvent,e=/Firefox/i.test(navigator.userAgent)?-20*t.detail:t.wheelDelta/2,n=this,$(n).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-n.scrollHeight,e+parseInt($("#UserList").css("top"),10))))}),l.is_touch&&l.touchScroll($("#UserList"),function(t){l.moveUserList(t,this)})},showBar:function(){var t,n=!1,o=!1,e=function(t){var e=0;s.data("isClicked")&&(!1!==n&&t<=n||!1!==o&&o<=t||(e=parseInt(s.css("top"),10)+(t-s.data("prevY")),l.$mBox.css("top",-(e-l.headerOffset)/($("body")[0].offsetHeight-s[0].offsetHeight-l.headerOffset)*(l.$mBox.height()-l.$mBoxCont.height())),l.isDown=!1,e<l.headerOffset?(!1===n&&(n=t),e=l.headerOffset,l.$mBox.css("top",0)):n=!1,e>$("body")[0].offsetHeight-s[0].offsetHeight?(!1===o&&(o=t),e=$("body")[0].offsetHeight-s[0].offsetHeight,l.$mBox.css("top",l.$mBoxCont.height()-l.$mBox.height()),l.isDown=!0):o=!1,s.css("top",e))),s.data("prevY",t)},i=function(){s.data("isClicked",!0),$("#scrollArea").css("display","block"),l.$mBox.css("transition","none"),o=n=r=!1},a=function(){s.data("isClicked",!1),$("#scrollArea").css("display","none"),l.$mBox.css("transition","")},s=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:!1}).appendTo("body").mousemove(function(t){e(t.clientY)}).mousedown(function(t){i()}).mouseup(function(){a()}),r=!1;s.css("top",$("body")[0].offsetHeight-s[0].offsetHeight),t=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(t){e(t.clientY)}).mouseup(function(){a()}).mouseenter(function(t){0==t.originalEvent.buttons&&r&&a(),r=!0}),l.is_touch&&(t.bind("touchend touchcancel touchleave",function(t){a()}).bind("touchmove",function(t){t.preventDefault(),e(t.originalEvent.changedTouches[0].clientY)}),s.bind("touchstart",function(t){t.preventDefault(),i()}).bind("touchmove",function(t){t.preventDefault(),e(t.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(t){t.preventDefault(),a()})),t.appendTo("body"),$("<div>").attr("id","scrollBarLine").appendTo("body"),$(window).trigger("resize")},showButtons:function(){var e,n,t,o=function(){e=setInterval(function(){l.moveWindow(9)},50)},i=function(){n=setInterval(function(){l.moveWindow(-9)},50)};t=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){l.$mBox.css("transition","none"),o()}).mouseout(function(){l.$mBox.css("transition","");try{clearInterval(e)}catch(t){}}).mouseup(function(){l.$mBox.css("transition","");try{clearInterval(e)}catch(t){}})),l.is_touch&&t.bind("touchstart",function(){o()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(e)}catch(t){}}),t.appendTo("body"),t=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){l.$mBox.css("transition","none"),i()}).mouseout(function(){l.$mBox.css("transition","");try{clearInterval(n)}catch(t){}}).mouseup(function(){l.$mBox.css("transition","");try{clearInterval(n)}catch(t){}})),l.is_touch&&t.bind("touchstart",function(){i()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(n)}catch(t){}}),t.appendTo("body")},down:function(){l.$mBox.css("top",l.$mBoxCont.height()-l.$mBox.height()),l.reCalcBar(),l.isDown=!0},up:function(){l.$mBox.css("top",0),l.reCalcBar(),l.isDown=!1},slide:function(){l.isDown&&l.down()},init:function(){l.$mBox=$("#MessageBox"),l.$mBoxCont=$("#mBoxCont"),l.enableButtons(),l.headerOffset=$("#header").height()-2,d.options.get("scrollBar")?l.showBar():l.showButtons(),d.options.get("scrollWheel")&&l.enableWheel(),l.enableUserlist(),$(document).add(window).add("body").add("html").scroll(function(t){t.preventDefault()})}}).down,up:l.up,slide:l.slide,init:l.init,reCalcBar:l.reCalcBar},r={init:(t={init:function(){d.options.get("smileys")?$("#smileyMenuButton").css("cursor","pointer").click(function(){"block"==$("#smileyselect").css("display")?($("#smileyselect").css("display","none"),$(this).attr("src","smileys/smiley.gif")):($("#smileyselect").css("display","block"),$(this).attr("src","smileys/tongue.gif"))}):$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")},set:function(t){$("#smileyselect").empty().append($.map(t,function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if($("#message").is("input"))replaceText(" "+e.code,$("#message")[0]);else{var t=window.getSelection().getRangeAt(0);t.deleteContents(),t.insertNode(document.createTextNode(" "+e.code)),$("#message").trigger("update")}}):""," "]}))}}).init,set:t.set},h={init:(c={mBoxContWidthOffset:90,hide_userlist:!1,show_scrollbar:!0,registerToggle:function(){$("#toggleButton").click(function(t){t.preventDefault(),d.options.set("enable",!d.options.get("enable")),document.location.reload()})},calcResize:function(t){var e=window.innerHeight,n=window.innerWidth,o=$("#header").outerHeight(),i=$("#footer").outerHeight(),a=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(t&&($("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10)),$("#message").css("width",n*(c.hide_userlist?1:.91)-12*a-$("#loginForm").width()),i=$("#footer").outerHeight(),$("#mBoxCont").css("height",e-i-o-.2*a),$("html,body").height(e)),c.show_scrollbar){var s=n/100*c.mBoxContWidthOffset;t&&$("#mBoxCont").css("width",s-1.9*a),$("#scrollBarLine").css("left",s-1.4*a),t&&$("#scrollBarLine").css("height",e-o-.1*a),$("#scrollBar").css("left",s-1.5*a),u.reCalcBar()}u.down()},initGuestLogin:function(){var e=function(e,t,n,o){void 0===n&&(n=t,t=""),d.settings.identGuest(e,t,n,function(t){if(!t.success)return o||alert("ERROR"+(t.message?": "+t.message:"")),void i();$("#pickUsernamePopup").hide(),$("#message").removeAttr("disabled"),d.send.val(""),$("#loginForm > button").hide(),$("#guestName").text(e+" (guest) (").append($("<a>").text("logout").click(function(t){t.preventDefault(),confirm("Are you sure? You won't be able to take this nick for half an hour!")&&(d.settings.logout(),i())}),")").show(),$(window).trigger("resize")})},i=function(){d.send.val("You need to pick a username if you want to chat!"),$("#message").attr("disabled",!0),$("#loginForm > button").show(),$("#guestName").hide(),$(window).trigger("resize")};d.ls.get("guestName")?e(d.ls.get("guestName"),d.ls.get("guestSig"),!0,!0):i(),$("#loginForm").show(),$("#loginForm > button").click(function(t){t.preventDefault(),$("#pickUsernamePopup").toggle()}),$("#pickUsernamePopup > button").click(function(t){e($('#pickUsernamePopup > input[type="text"]').val(),$('#pickUsernamePopup > input[type="checkbox"]')[0].checked)})},init:function(){var t=navigator.userAgent,e=t.match(/(iPod|iPhone|iPad)/i)&&t.match(/AppleWebKit/i);$("body").css("font-size",d.options.get("fontSize").toString(10)+"pt"),c.hide_userlist=d.options.get("hideUserlist"),c.show_scrollbar=d.options.get("scrollBar"),d.page.changeLinks(),d.initinput($("#message"),!0),$("#send").click(function(t){t.preventDefault(),d.send.send()}),d.settings.loggedIn()||(d.send.val("You need to login if you want to chat!"),2<=d.settings.guestLevel()&&c.initGuestLogin()),c.hide_userlist&&(c.mBoxContWidthOffset=99,$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head")),u.init(),c.registerToggle(),e&&c.calcResize(!0),$(window).resize(function(){c.calcResize(!e)}).trigger("resize"),$("#aboutButton").click(function(t){t.preventDefault(),$("#about").toggle()}),r.init(),g.init()},maxLines:200,lastMessage:0,lineHigh:!1,addLine:function(t,e,n,o){var i=$("#MessageBox"),a="",s=new Date(1e3*n.time);i.find("tr").length>c.maxLines&&!0!==o&&i.find("tr:first").remove(),a="*"==t?"* ":"<"+n.name+"> ",d.options.get("times")&&(a="["+s.toLocaleTimeString()+"] "+a),a+=$("<span>").append(e).text(),d.statusBar.set(a),new Date(c.lastMessage).getDay()!=s.getDay()&&i.append($("<tr>").addClass("dateSeperator").append($("<td>").addClass(d.options.get("altLines")&&(c.lineHigh=!c.lineHigh)?"lineHigh":"").attr("colspan",d.options.get("times")?3:2).text(s.toLocaleDateString())));var r=$("<tr>").addClass(d.options.get("altLines")&&(c.lineHigh=!c.lineHigh)?"lineHigh":"").append(d.options.get("times")?$("<td>").addClass("irc-date").append("["+s.toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(t),$("<td>").addClass(n.type).append(e));r.find("img").load(function(t){u.slide()}),i.append(r),u.slide(),c.lastMessage=1e3*n.time}}).init,registerToggle:c.registerToggle,addLine:c.addLine},g={init:(i={isOpen:!1,year:0,month:0,day:0,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],getLogUrlParam:function(){return base64.encode(i.year.toString(10)+"-"+i.month.toString(10)+"-"+i.day.toString(10))},updateInputVal:function(){$("#logDate").val(i.months[i.month-1]+" "+i.day.toString(10)+" "+i.year.toString(10))},displayDatePicker:function(){var e=new Date(i.year,i.month,0).getDate(),n=new Date(i.year,i.month-1,1).getDay(),o=0;i.day>e&&(i.day=e),i.updateInputVal(),$("#logDatePicker").empty().append($("<a>").text("<").click(function(t){t.preventDefault(),t.stopPropagation(),i.year--,i.displayDatePicker()})," ",i.year.toString(10)," ",$("<a>").text(">").click(function(t){t.preventDefault(),t.stopPropagation(),i.year++,i.displayDatePicker()}),"<br>",$("<a>").text("<").click(function(t){t.preventDefault(),t.stopPropagation(),i.month--,i.month<1&&(i.month=12,i.year--),i.displayDatePicker()})," ",i.months[i.month-1]," ",$("<a>").text(">").click(function(t){t.preventDefault(),t.stopPropagation(),i.month++,12<i.month&&(i.month=1,i.year++),i.displayDatePicker()}),"<br>",$("<table>").append($("<tr>").append($.map(["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],function(t){return $("<th>").text(t)})),$.map([0,1,2,3,4,5],function(){if(!(e<=o))return $("<tr>").append($.map([0,1,2,3,4,5,6],function(t){return 0==o&&t!=n||e<=o?$("<td>").text(" "):(o++,$("<td>").text(o).addClass("logDatePickerDay").addClass(o==i.day?"current":"").data("day",o).click(function(){$(".logDatePickerDay.current").removeClass("current"),i.day=$(this).addClass("current").data("day"),i.updateInputVal()}))}))}))),$("#logDatePicker").css("display","block")},open:function(){var t=new Date;a.start(),d.logs.open(function(){$("#MessageBox").empty(),$("#message").attr("disabled","true"),d.users.setUsers([]),$("#chattingHeader").css("display","none"),$("#logDatePicker").css("display","none"),$("#logsHeader").css("display","block"),$("#logChanIndicator").text(d.channels.current().name),i.year=parseInt(t.getFullYear(),10),i.month=parseInt(t.getMonth()+1,10),i.day=parseInt(t.getDate(),10),i.updateInputVal(),i.isOpen=!0,i.fetch()})},close:function(){d.logs.close(),$("#chattingHeader").css("display","block"),$("#logsHeader").css("display","none"),i.isOpen=!1},fetch:function(){a.start(),$("#MessageBox").empty(),d.logs.fetch(i.getLogUrlParam(),function(){u.up(),a.stop()})},toggle:function(){i.isOpen?i.close():i.open()},init:function(){$("#logCloseButton").click(function(t){t.preventDefault(),i.close()}),$("#logGoButton").click(function(t){t.preventDefault(),i.fetch()}),$("#logsButton").click(function(t){t.preventDefault(),i.toggle()}),$("#logDate").click(function(t){t.preventDefault(),$(this).focusout(),"block"!=$("#logDatePicker").css("display")&&(i.displayDatePicker(),t.stopPropagation())}),$(document).click(function(t){if(i.isOpen){var e=$("#logDatePicker");e.is(t.target)||0!==e.has(t.target).length||e.css("display","none")}})}}).init};a.start(),d.error.init(),d.onmessage=h.addLine,d.onerror=d.error.addError,d.onwarning=d.error.addWarning,d.onuserchange=n.draw,d.onchannelchange=p.draw,d.onchanneljoin=function(t){if(t)if("*"!=t[0]){var e=d.channels.join(t);-1!=e&&p.join(e)}else d.channels.joinPm(t.substring(1),"",function(t){-1!=t&&p.join(t)})},d.onchannelpart=d.channels.part,d.ontopicchange=s.set,d.onnotification=function(t,e,n){e!=d.channels.current().handler&&d.channels.highlight(e)},d.onsmileychange=r.set,d.connect(function(){d.options.get("enable")?(h.init(),p.join(d.options.get("curChan"),function(t){t||p.join(0)})):(d.disconnect(),h.registerToggle(),$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(t){t.preventDefault(),d.options.set("enable",!0),window.location.reload()})),$("#footer,#header").css("display","none"),a.stop())})});