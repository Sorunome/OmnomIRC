"use strict";function OmnomIRC(){var e="https://omnomirc.omnimaga.org",n="",t=false,i=function(e){return document.URL.split(e+"=")[1]!==undefined?document.URL.split(e+"=")[1].split("&")[0].split("#")[0]:""},s=function(e,n){if(n===undefined){n=false}if(e.name===null||e.network==-1||!n&&!d.isNew(e.curline)){d.setCurline(e.curline);return}d.setCurline(e.curline);if(N.onmessageraw!==false){N.onmessageraw(e,n)}else{S.addLine(e,n)}if(!n&&e.chan==o.get("chan")){var t=o.get("lines");t.push(e);if(t.length>200){t.shift()}o.set("lines",t);if(["part","quit","join","nick"].indexOf(e.type)!=-1){o.set("users",h.getUsers())}}},r=function(){var e={hostname:"",nick:"",signature:"",numHigh:4,uid:-1,net:"",networks:{},pmIdent:false,guestLevel:0,isGuest:true,identGuest:function(n,t,i,s){if(s===undefined){s=i;i=false}console.log("trying login");l.getJSON("misc.php?identName="+base64.encode(n)+"&nick="+base64.encode(n)+"&signature="+base64.encode(t)+"&id=-1&network="+e.net,function(t){if(t.success){if(i){a.set("guestName",n);a.set("guestSig",t.signature)}else{a.set("guestName","");a.set("guestSig","")}e.setIdent(n,t.signature,-1);d.identify()}if(s!==undefined){s(t)}},true,false)},logout:function(){e.setIdent("","",-1);a.remove("guestName");a.remove("guestSig");o.remove("config");o.remove("checkLogin");d.identify()},login:function(n,t,i){if(i===undefined){i=-1}e.setIdent(n,t,i);d.identify()},fetch:function(n,t){var s=function(s){if(!t){try{sessionStorage.setItem("defaultNetwork",s.defaultNetwork)}catch(e){}o.set("config",s);e.hostname=s.hostname;g.setChans(s.channels);S.setSmileys(s.smileys);N.onsmileychange(s.smileys);S.setSpLinks(s.spLinks);e.guestLevel=s.guests;e.networks={};$.each(s.networks,function(n,t){e.networks[t.id]=t});e.net=s.network;a.setPrefix(e.net);c.setDefaults(s.defaults);c.setExtraChanMsg(s.extraChanMsg);d.setData(s.websockets.use,s.websockets.host,s.websockets.port,s.websockets.ssl)}var r=o.get("checkLogin");if(r&&!t){e.nick=r.nick;e.signature=r.signature;e.uid=r.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=s.signature==="";var u=i("uid");if(u!==""&&u!=e.uid){o.remove("config");o.remove("checkLogin");e.fetch(n,t);return}if(n!==undefined){n()}return}if(e.loggedIn()&&e.isGuest){e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}})}else{l.getJSON(s.checkLoginUrl+"&network="+e.net.toString()+"&jsoncallback=?",function(t){o.set("checkLogin",{nick:t.nick,signature:t.signature,uid:t.uid});e.nick=t.nick;e.signature=t.signature;e.uid=t.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=t.signature==="";if(n!==undefined){n()}},true,false)}};if(t===undefined){t=false}if(t&&e.loggedIn()&&e.isGuest){console.log("i am silly");e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}});return}if(!t){var r=o.get("config");if(r){s(r);return}}o.determinePrefix();l.getJSON("config.php?js&network="+i("network")+(t?"&clonly":""),s,true,false)},setIdent:function(n,t,i){e.nick=n;e.signature=t;e.uid=i;o.set("checkLogin",{nick:n,signature:t,uid:i})},getUrlParams:function(){return"nick="+base64.encode(e.nick)+"&signature="+base64.encode(e.signature)+"&time="+(+new Date).toString()+"&id="+e.uid+"&network="+e.net+"&noLoginErrors"},getNetwork:function(n){if(e.networks[n]!==undefined){return e.networks[n]}return{id:-1,normal:"NICK",userlist:"NICK",name:"Invalid network",type:-1}},getIdentParams:function(){return{nick:e.nick,signature:e.signature,time:(+new Date).toString(),id:e.uid,network:e.net}},loggedIn:function(){return e.signature!==""},getWholePmIdent:function(n,t){var i="["+t.toString()+","+n.toString()+"]";if(t<e.net){return i+e.pmIdent}else if(e.net<t){return e.pmIdent+i}else if(n<e.uid){return i+e.pmIdent}else{return e.pmIdent+i}}};return{identGuest:e.identGuest,fetch:e.fetch,getUrlParams:e.getUrlParams,getIdentParams:e.getIdentParams,getNetwork:e.getNetwork,nick:function(){return e.nick},net:function(){return e.net},loggedIn:e.loggedIn,guestLevel:function(){return e.guestLevel},getPmIdent:function(){return e.pmIdent},isGuest:function(){return e.isGuest},getWholePmIdent:e.getWholePmIdent,logout:e.logout,login:e.login}}(),a=function(){var e={prefix:i("network"),setPrefix:function(n){if(!n){e.prefix="";return}e.prefix=n.toString()},getCookie:function(e){var n,t,i,s=document.cookie.split(";");for(n=0;n<s.length;n++){t=s[n].substr(0,s[n].indexOf("="));i=s[n].substr(s[n].indexOf("=")+1);t=t.replace(/^\s+|\s+$/g,"");if(t==e){return unescape(i)}}},setCookie:function(e,n,t){var i=new Date,s=escape(n);i.setDate(i.getDate()+t);s+=t===null?"":"; expires="+i.toUTCString();document.cookie=e+"="+s},haveSupport:null,support:function(){if(e.haveSupport===null){try{localStorage.setItem("test",1);e.haveSupport=localStorage.getItem("test")==1;localStorage.removeItem("test");e.haveSupport=true}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){var t;n=e.prefix+n;if(e.support()){t=localStorage.getItem(n)}else{t=e.getCookie(n)}try{return JSON.parse(t)}catch(e){return undefined}},set:function(n,t){n=e.prefix+n;t=JSON.stringify(t);if(e.support()){localStorage.setItem(n,t)}else{e.setCookie(n,t)}},remove:function(n,t){n=e.prefix+n;if(e.support()){localStorage.removeItem(n)}else{e.setCookie(n,"",-1)}}};return{setPrefix:e.setPrefix,get:e.get,set:e.set,remove:e.remove}}(),o=function(){var e={prefix:i("network"),setPrefix:function(n){if(!n){return}e.prefix=n.toString()},determinePrefix:function(){e.haveSupport=null},haveSupport:null,support:function(){if(e.haveSupport===null){try{sessionStorage.setItem("test",1);e.haveSupport=sessionStorage.getItem("test")==1;sessionStorage.removeItem("test");if(e.haveSupport&&e.prefix==""){e.setPrefix(sessionStorage.getItem("defaultNetwork"))}}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){if(e.support()){try{return JSON.parse(sessionStorage.getItem(e.prefix+n))}catch(e){return undefined}}return undefined},set:function(n,t){if(e.support()){sessionStorage.setItem(e.prefix+n,JSON.stringify(t))}},remove:function(n){if(e.support()){sessionStorage.removeItem(e.prefix+n)}}};return{determinePrefix:e.determinePrefix,get:e.get,set:e.set,remove:e.remove}}(),l=function(){var e={didRelog:false,removeSig:function(e){try{var n=e.split("signature="),t=n[1].split("&");t[0]="---";n[1]=t.join("&");return n.join("signature=")}catch(n){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},addError:function(n,t){n=e.removeSig(n);N.onerror(n,t)},addWarning:function(n,t){n=e.removeSig(n);N.onwarning(n,t)},checkCallback:function(n,t,i,s){if(n.relog!=2){if(n.errors!==undefined){$.map(n.errors,function(n){if(n.type!==undefined){e.addError(s,n)}else{e.addError(s,{type:"misc",message:n})}})}if(n.warnings!==undefined){$.map(n.warnings,function(n){if(n.type!==undefined){e.addWarning(s,n)}else{e.addWarning(s,{type:"misc",message:n})}})}}if(n.relog!==undefined&&n.relog!=0){if(n.relog==1){r.fetch(undefined,true);t(n)}else if(n.relog==2&&!e.didRelog){e.didRelog=true;r.fetch(function(){i()},true)}else{t(n)}}else{if(n.relog!==undefined){e.didRelog=false}t(n)}},getJSON:function(n,t,i,s){if(i==undefined){i=true}if(s==undefined){s=true}if(n.indexOf("?")==-1&&s){n+="?"}var a=n+(s?"&"+r.getUrlParams():"");return $.ajax({url:a,dataType:"json",async:i}).done(function(r){e.checkCallback(r,t,function(){e.getJSON(n,t,i,s)},a)})},post:function(n,t,i,s,a){if(s==undefined){s=true}if(a==undefined){a=true}if(n.indexOf("?")==-1&&a){n+="?"}var o=n+(a?"&"+r.getUrlParams():"");return $.ajax({type:"POST",url:o,async:s,data:t}).done(function(r){e.checkCallback(r,i,function(){e.post(n,t,i,s,a)},o)})}};return{getJSON:e.getJSON,post:e.post}}(),c=function(){var e={extraChanMsg:"",allOptions:{highBold:{disp:"Highlight Bold",default:true},highRed:{disp:"Highlight Red",default:true},colordNames:{disp:"Colored Names",default:0,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(n,t){return $("<option>").attr(e.get("colordNames")==t?"selected":"false","selected").val(t).text(n)})))}},curChan:{hidden:true,default:0},extraChans:{disp:"Show extra Channels",default:false,before:function(){if(e.extraChanMsg!==""){alert(e.extraChanMsg)}return true}},ding:{disp:"Ding on Highlight",default:false},smileys:{disp:"Show Smileys",default:true},charsHigh:{disp:"Number chars for Highlighting",default:4,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("charsHigh",this.value)}).append($.map([1,2,3,4,5,6,7,8,9,10],function(n){return $("<option>").attr(e.get("charsHigh")==n?"selected":"false","selected").val(n).text(n)})))}},oircJoinPart:{disp:"Show OmnomIRC join/part messages",default:false},textDeco:{disp:"Enable simple text decorations",default:false},statusBar:{disp:"Show Updates in Browser Status Bar",default:true},browserNotifications:{disp:"Browser Notifications",default:false,before:function(){C.request();return false}},wysiwyg:{disp:"Use WYSIWYG editor",default:false}},set:function(n,t){if(e.allOptions[n]===undefined){return}e.allOptions[n].value=t;var i=a.get("options")||{};i[n]=t;a.set("options",i)},get:function(n){if(e.allOptions[n]!==undefined){return e.allOptions[n].value}},setExtraChanMsg:function(n){e.extraChanMsg=n},setDefaults:function(n){var t=a.get("options");$.each(e.allOptions,function(i,s){var r=s.default;if(t&&t[i]!==undefined){r=t[i]}else if(n&&n[i]!==undefined){r=n[i]}e.allOptions[i].value=r})},getAll:function(n){if(n){return e.allOptions}var t={};$.each(e.allOptions,function(e,n){if(n.hidden===undefined||!n.hidden){t[e]=n.value}});return t},setAll:function(n){e.allOptions=n}};return{set:e.set,get:e.get,setDefaults:e.setDefaults,setExtraChanMsg:e.setExtraChanMsg,getAll:e.getAll,setAll:e.setAll}}(),f=function(){var e={id:Math.random().toString(36)+(new Date).getTime().toString(),update:function(){a.set("browserTab",e.id);a.set("newInstant",false)},init:function(){a.set("browserTab",e.id);$(window).focus(function(){e.update()}).unload(function(){e.kill()})},current:function(){if(a.get("newInstant")){e.update()}return e.id==a.get("browserTab")},kill:function(){a.set("newInstant",true);$(window).off("focus").off("unload")}};return{init:e.init,current:e.current,kill:e.kill}}(),d=function(){var e={ws:{socket:false,connected:false,use:true,sendBuffer:[],allowLines:false,enabled:false,host:"",port:0,ssl:true,tryFallback:true,didRelog:false,fallback:function(){console.log("trying fallback...");if(e.ws.tryFallback){try{e.ws.tryFallback=false;e.ws.socket.close()}catch(e){}e.ws.use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()}},identify:function(){e.ws.send($.extend({action:"ident"},r.getIdentParams()));e.ws.send({action:"charsHigh",chars:c.get("charsHigh")})},init:function(){if(!("WebSocket"in window)||!e.ws.enabled){e.ws.use=false;return false}try{var n=window.location.pathname.split("/");n.pop();if(n.length>1&&n[n.length-1]===""){n.pop()}n.push("ws");n.push(r.net());e.ws.socket=new PooledWebSocket((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"))}catch(t){console.log(e.ws.socket);console.log((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"));console.log(t);e.ws.fallback();return}e.ws.socket.onopen=function(n){e.ws.connected=true;for(var t=0;t<e.ws.sendBuffer.length;t++){e.ws.send(e.ws.sendBuffer[t])}e.ws.sendBuffer=[]};e.ws.socket.onmessage=function(n){try{var t=JSON.parse(n.data);console.log(t);if(e.ws.allowLines){if(t.line!==undefined){if(s(t.line)){e.ws.tryFallback=false;delete e.ws.socket}}if(t.users!==undefined){h.setUsers(t.users)}}if(t.relog!==undefined&&t.relog!=0&&t.relog<3){if(!e.ws.didRelog){e.ws.didRelog=true;r.fetch(function(){if(r.loggedIn()){e.ws.identify();e.ws.didRelog=false}},true)}}}catch(e){}};e.ws.socket.onclose=function(n){console.log("CLOOOOOOOOOSE");console.log(n);e.ws.use=false;e.ws.fallback()};e.ws.socket.onerror=function(n){console.log("ERRRORRRR");console.log(n);delete e.ws.socket;e.ws.use=false;e.ws.fallback()};e.ws.identify();$(window).on("beforeunload",function(){e.partChan(g.current().handler);delete e.ws.socket});return true},send:function(n){if(e.ws.connected){e.ws.socket.send(JSON.stringify(n))}else{e.ws.sendBuffer.push(n)}}},old:{inRequest:false,handler:false,lastSuccess:(new Date).getTime(),fnCallback:undefined,chan:"",sendRequest:function(){if(!e.old.chan){return}e.old.handler=l.getJSON("Update.php?high="+c.get("charsHigh").toString()+"&channel="+e.old.chan+"&lineNum="+e.curline.toString(),function(n){e.old.handler=false;e.old.lastSuccess=(new Date).getTime();if(n.lines!==undefined){$.map(n.lines,function(e){s(e)})}if(n.errors!=undefined&&n.errors.length>=1){return}if(n.banned!==true){e.old.setTimer()}}).fail(function(){e.old.handler=false;if(e.fnCallback!=undefined){e.fnCallback();e.fnCallback=undefined;return}if((new Date).getTime()>=e.old.lastSuccess+3e5){m.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!e.old.inRequest){e.old.lastSuccess=(new Date).getTime()}else{e.old.setTimer()}})},setTimer:function(){if(e.old.inRequest&&g.current().loaded&&e.old.handler===false){setTimeout(function(){e.old.sendRequest()},x.isBlurred()?2500:200)}else{e.old.stop()}},start:function(){if(!e.old.inRequest){e.old.inRequest=true;e.old.setTimer()}},stop:function(n){if(e.old.inRequest){e.old.inRequest=false;if(e.old.handler){e.fnCallback=n;e.old.handler.abort()}else if(n!==undefined){n()}}else if(n!==undefined){n()}},send:function(e,n,t){l.getJSON("message.php?message="+base64.encode(e)+"&channel="+n,function(e){if(t!==undefined){t(e)}})}},curline:0,joinChan:function(n){if(e.ws.use){e.ws.send({action:"joinchan",chan:n})}if(parseInt(n,10)!=n){n=base64.encode(n)}e.old.chan=n},partChan:function(n){if(e.ws.use){e.ws.send({action:"partchan",chan:n})}},stop:function(n){if(e.ws.use){e.ws.allowLines=false;n()}else{e.old.stop(n)}},kill:function(){if(e.ws.use){e.ws.socket.onclose=function(){};e.ws.socket.close()}else{e.old.stop()}},start:function(){if(e.ws.use){e.ws.allowLines=true}else{e.old.start()}},setCurline:function(n){if(n>e.curline){e.curline=n}},send:function(n,t,i){if(e.ws.use){e.ws.send({action:"message",channel:t,message:n});if(i!==undefined){i()}}else{if(parseInt(t,10)!=t){t=base64.encode(t)}e.old.send(n,t,i)}},setData:function(n,t,i,s){e.ws.enabled=n;e.ws.host=t;e.ws.port=i;e.ws.ssl=s},init:function(){if(e.ws.enabled){e.ws.init()}else{e.ws.use=false;e.old.lastSuccess=(new Date).getTime()}},identify:function(){if(e.ws.enabled){e.ws.identify()}},postfetch:function(){if(e.ws.use){e.ws.send({action:"postfetch",channel:g.current().handler,curline:e.curline})}},isNew:function(n){return n==0||n>e.curline}};return{joinChan:e.joinChan,partChan:e.partChan,start:e.start,stop:e.stop,kill:e.kill,setCurline:e.setCurline,send:e.send,setData:e.setData,init:e.init,identify:e.identify,postfetch:e.postfetch,isNew:e.isNew}}(),g=function(){var e=function(e){var t=n.chans[e]!==undefined,i={i:e,name:t?n.chans[e].chan.toLowerCase():"",handler:t?n.getHandler(e):-1,handlerB64:t?n.getHandler(e,true):-1,loaded:false,load:function(n){if(n.lines===undefined){if(n.message){m.internal(n.message)}else{m.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}return false}c.set("curChan",e);if(n.banned){m.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');return false}h.setUsers(n.users);$.each(n.lines,function(e,n){s(n,true)});i.loaded=true;return true},unload:function(){if(i.loaded){d.partChan(i.handler)}},part:function(){n.part(n.i)},reloadUserlist:function(){if(!t){return}l.getJSON("Load.php?userlist&channel="+i.handlerB64,function(e){if(!e.banned){if(e.users){h.setUsers(e.users)}}else{m.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})},reload:function(){N.onchanneljoin(i.name)},setI:function(e){i.i=e},is:function(e){return e==i.i}};return{name:i.name,handler:i.handler,handlerB64:i.handlerB64,load:i.load,part:i.part,reload:i.reload,unload:i.unload,loaded:function(){return i.loaded},setI:i.setI,is:i.is,reloadUserlist:i.reloadUserlist}},n={current:false,chans:[],save:function(){a.set("channels",n.chans)},loadSettings:function(){try{var e=a.get("channels"),t=$.map(n.chans,function(e){if(e.ex&&c.get("extraChans")||!e.ex){return e}return undefined}),i=[];if(e!==null&&e!=[]){n.chans=$.merge($.map(e,function(e){if(e.id!=-1&&e.id.toString().substr(0,1)!="*"){var t=false;$.each(n.chans,function(n,s){if(s.id==e.id){i.push(e);t=true;e.chan=s.chan;return false}});if(!t){return undefined}}return e}),$.map(t,function(e){var n=false;$.each(i,function(t,i){if(i.id==e.id){n=true;e.chan=i.chan;return false}});if(n){return undefined}return e}));save()}}catch(e){}N.onchannelchange(n.chans)},init:function(){n.current=e(-1);n.loadSettings()},addChan:function(e,t){var i=true;if(t===undefined){t=-1}e=e.toLowerCase();$.each(n.chans,function(n,t){if(t.chan==e){i=n}});if(i===true){if(e[0]=="#"){m.internal('<span style="color:#C73232;">Join Error: Cannot join new channels starting with #.</span>');return-1}n.chans.push({chan:e,high:false,ex:false,id:t,order:-1});n.save();N.onchannelchange(n.chans);return n.chans.length-1}return i},getHandler:function(e,t){if(n.chans[e].id!=-1){if(typeof n.chans[e].id!="number"&&t){return base64.encode(n.chans[e].id)}return n.chans[e].id.toString()}if(t){return base64.encode(n.chans[e].chan)}return n.chans[e].chan},requestHandler:false,load:function(t,i){var s=function(e){if(n.current.load(e)){n.chans[t].high=false;n.save();d.joinChan(n.getHandler(t));d.start();w.load();k.read();d.postfetch();i(true,e);return}i(false,{})};if(i===undefined){i=function(){}}if(n.chans[t]===undefined){i(false,{});return}d.stop(function(){if(n.requestHandler!==false){n.requestHandler.abort()}if(o.get("chan")==n.getHandler(t)){c.set("curChan",t);n.current=e(t);var i={},r=["chan","banned","admin","users","ignores","lines"];for(var a=0;a<r.length;a++){i[r[a]]=o.get(r[a])}s(i);return}n.requestHandler=l.getJSON("Load.php?count=125&channel="+n.getHandler(t,true),function(i){c.set("curChan",t);n.current=e(t);o.set("chan",n.current.handler);o.set("banned",i.banned);o.set("admin",i.admin);o.set("users",i.users);o.set("ignores",i.ignores);o.set("lines",i.lines);s(i)})})},join:function(e){var t=true;e=e.trim();if(!e){return-1}if(e[0]!="@"&&e[0]!="#"){e="@"+e}return n.addChan(e)},joinPm:function(e,t,i){if(i===undefined){i=function(){}}var s=true,r=function(t,s){t=t.trim();if(t.substr(0,1)!="*"){t="*"+e}s=s.trim();if(s.substr(0,1)!="*"){s="*"+s}i(n.addChan(t,s))};if(t==""){if(e.substr(0,1)=="@"||e.substr(0,1)=="#"){m.internal('<span style="color:#C73232;">Query Error: Cannot query a channel. Use /join instead.</span>');i(-1);return}l.getJSON("misc.php?openpm="+base64.encode(e),function(e){if(e.channick){r(e.channick,e.chanid)}else{m.internal('<span style="color:#C73232;">Query Error: User not found.</span>');i(-1)}})}else{r(e,t)}},part:function(e){if(parseInt(e,10)==e){e=parseInt(e,10)}if(typeof e!="number"){if(e&&e[0]!="@"&&e[0]!="#"&&e[0]!="*"){e="@"+e}$.each(n.chans,function(n,t){if(t.chan==e){e=n;return false}})}if(typeof e!="number"||n.chans[e]===undefined){m.internal('<span style="color:#C73232;"> Part Error: can\'t part '+e+". (You are not in it.)</span>");return false}if(n.chans[e].chan[0]=="#"){m.internal('<span style="color:#C73232;"> Part Error: can\'t part '+n.chans[e].chan+". (IRC channel.)</span>");return false}var t=n.chans[e].chanId,i=false;if(n.current.is(e)){i=true}if(t==-1){t=n.chans[e]}d.partChan(n.getHandler(e));n.chans.splice(e,1);n.save();N.onchannelchange(n.chans);if(i){N.onchanneljoin(n.chans[e-1].chan)}return true},getList:function(){return n.chans},setChans:function(e){n.chans=e;if(n.current){n.save();N.onchannelchange(n.chans)}},getNames:function(){return $.map(n.chans,function(e){return e.chan})},highlight:function(e){$.each(n.chans,function(t,i){if(e==i.id||i.chan.toLowerCase()==e.toString().toLowerCase()){n.chans[t].high=true;return false}});n.save();N.onchannelchange(n.chans)}};return{init:n.init,load:n.load,join:n.join,joinPm:n.joinPm,part:n.part,getList:n.getList,getHandler:n.getHandler,current:function(){return n.current},setChans:n.setChans,getNames:n.getNames,highlight:n.highlight}}(),h=function(){var e={users:[],draw:function(){e.users.sort(function(e,n){var t=e.nick.toLowerCase(),i=n.nick.toLowerCase();return t==i?e==n?0:e<n?-1:1:t<i?-1:1});N.onuserchange(e.users)},exists:function(n){var t=false;$.each(e.users,function(e,n){if(n.nick.toLowerCase()==u.nick.toLowerCase()&&n.network==u.network){t=true;return false}});return t},add:function(n){if(g.current().handler!==""){var t=true;$.each(e.users,function(e,i){if(i.nick==n.nick&&i.network==n.network){t=false;return false}});if(t){e.users.push(n);e.draw()}}},remove:function(n){if(g.current().handler!==""){$.each(e.users,function(t,i){if(i.nick==n.nick&&i.network==n.network){e.users.splice(t,1);return false}});e.draw()}},setUsers:function(n){e.users=n;o.set("users",e.users);e.draw()},getNames:function(){return $.map(e.users,function(e){return e.nick})}};return{add:e.add,remove:e.remove,setUsers:e.setUsers,getNames:e.getNames,getUsers:function(n){return e.users}}}(),p=function(){var n={parse:function(n){var t=n.split(" ")[0].toLowerCase(),i=n.substr(t.length+1).toLowerCase().trim();switch(t){case"j":case"join":if(r.isGuest()){m.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t join as guest</span>')}else{N.onchanneljoin(i)}return true;case"q":case"query":if(r.isGuest()){m.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t query as guest</span>')}else{N.onchanneljoin("*"+i)}return true;case"win":case"w":case"window":var s=g.getList()[parseInt(i,10)];if(s!==undefined){N.onchanneljoin(s.chan)}return true;case"p":case"part":if(i!==""){N.onchannelpart(i)}else{N.onchannelpart(g.current().name)}return true;case"help":m.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');m.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){m.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}};return{parse:n.parse}}(),m=function(){var e={sending:false,send:function(n,t,i){if(typeof n==="string"){t=n;n=undefined}if(n===undefined){n=function(){}}if(t===undefined){t=m.val()}if(!t){n();return}k.add(t);if(t!==""&&c.get("textDeco")){if(t[0]==">"){t="3"+t}t=t.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}if(i===undefined){i=g.current().handler}if(t[0]=="/"&&p.parse(t.substr(1))){n()}else{if(!e.sending){e.sending=true;d.send(t,i,function(t){if(t!==undefined&&t.lines!==undefined){$.map(t.lines,function(e){s(e)})}e.sending=false;n()})}}},internal:function(e){s({curline:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:g.current().handler})},val:function(e){if(e===undefined){if(N.ongetval===false){if(t.is("input")){return t.val()}return t.text()}return N.ongetval()}if(N.onsetval===false){if(t.is("input")){t.val(e)}else{t.text(e)}}else{N.onsetval(e)}}};return{internal:e.internal,send:e.send,val:e.val}}(),w=function(){var e={tabWord:"",tabCount:0,isInTab:false,startPos:0,startChar:"",endPos:0,endChar:"",endPos0:0,tabAppendStr:"",searchArray:[],node:false,wysiwyg:false,getCurrentWord:function(){var n=!e.wysiwyg?t[0].value:(e.node=window.getSelection().anchorNode).nodeValue;if(e.isInTab){return e.tabWord}e.startPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.startChar=n.charAt(e.startPos);while(e.startChar!=" "&&--e.startPos>0){e.startChar=n.charAt(e.startPos)}if(e.startChar==" "){e.startPos++}e.endPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.endChar=n.charAt(e.endPos);while(e.endChar!=" "&&++e.endPos<=n.length){e.endChar=n.charAt(e.endPos)}e.endPos0=e.endPos;e.tabWord=n.substr(e.startPos,e.endPos-e.startPos).trim();return e.tabWord},getTabComplete:function(){var n=!e.wysiwyg?t[0].value:e.node.nodeValue,i;if(n===null){return}i=e.search(e.getCurrentWord(),e.tabCount);if(!e.isInTab){e.tabAppendStr=" ";if(e.startPos===0){e.tabAppendStr=": "}}if(i==e.getCurrentWord()){e.tabCount=0;i=e.search(e.getCurrentWord(),e.tabCount)}n=n.substr(0,e.startPos)+i+e.tabAppendStr+n.substr(e.endPos+1);if(!e.wysiwyg){t[0].value=n}else{window.getSelection().anchorNode.nodeValue=n;window.getSelection().getRangeAt(0).setEnd(e.node,e.startPos+i.length+e.tabAppendStr.length);window.getSelection().getRangeAt(0).setStart(e.node,e.startPos+i.length+e.tabAppendStr.length)}e.endPos=e.endPos0+i.length+e.tabAppendStr.length},search:function(n,t){var i=false;if(!t){t=0}$.each(e.searchArray,function(e,s){if(s.toLowerCase().indexOf(n.toLowerCase())===0&&t--<=0&&i===false){i=s}});if(i!==false){return i}return n},init:function(){e.wysiwyg=!t.is("input");t.keydown(function(n){if(n.keyCode==9){if(!n.ctrlKey){n.preventDefault();e.getTabComplete();e.isInTab=true;e.tabCount++;setTimeout(1,1)}}else{e.tabWord="";e.tabCount=0;e.isInTab=false}})},load:function(){e.searchArray=$.merge(h.getNames(),g.getNames())}};return{init:e.init,load:e.load}}(),k=function(){var e={messages:[],counter:0,current:"",init:function(){t.keydown(function(n){if(n.keyCode==38||n.keyCode==40){n.preventDefault();if(e.counter==e.messages.length){e.current=m.val()}if(e.messages.length!==0){if(n.keyCode==38){if(e.counter!==0){e.counter--}m.val(e.messages[e.counter])}else{if(e.counter!=e.messages.length){e.counter++}if(e.counter==e.messages.length){m.val(e.current)}else{m.val(e.messages[e.counter])}}}}})},add:function(n){e.messages.push(n);if(e.messages.length>20){e.messages.shift()}e.counter=e.messages.length;N.ls.set("oldMessages-"+N.channels.current().handlerB64,e.messages)},read:function(){e.messages=N.ls.get("oldMessages-"+N.channels.current().handlerB64);if(!e.messages){e.messages=[]}console.log(e.messages);e.counter=e.messages.length}};return{init:e.init,add:e.add,read:e.read}}(),v=function(){var e={menuOpen:false,msgVal:"",$textDecoForm:false,hideMenu:function(){e.$textDecoForm.css("display","none");e.menuOpen=false},reverseParse:function(e){if(e.indexOf("<")===-1){return $("<span>").html(e).text()}var n=false,t=false,i=false,s="-1",r="-1";e=e.replace(/<img([^>]*?)>/gi,function(e,n){var t=n.match(/data-code="([^"]*)"/);if(t){return t[1]}return""});e=e.replace(/<span([^>]*?)>([^<]*?)<\/span>/gi,function(a,o,u){if(!o){return u}e="";if(o.indexOf("bold")==-1==n){n=!n;e+=""}if(o.indexOf("italic")==-1==t){t=!t;e+=""}if(o.indexOf("underline")==-1==i){i=!i;e+=""}var l=o.match(/fg-(\d+)/),c=o.match(/bg-(\d+)/);if(!l){l="-1"}if(!c){c="-1"}if(c!=r||l!=s){if(s!="-1"&&l=="-1"||r!="-1"&&c=="-1"){e="";if(n){e+=""}if(t){e+=""}if(i){e+=""}}e+="";s=l;if(s!="-1"){e+=s}r=c;if(r!="-1"){e+=","+r}}return e+u});return $("<span>").html(e).text()},getCaretCharacterOffsetWithin:function(e){var n=window.getSelection();if(n.rangeCount>0){var t=n.getRangeAt(0),i=t.cloneRange(),s=0,r=document.createRange(),a;i.selectNodeContents(e);i.setEnd(t.endContainer,t.endOffset);a=i.commonAncestorContainer.getElementsByTagName("img");for(var o=0;o<a.length;o++){var u=a[o];if(u.dataset.code){r.selectNode(u);if(i.compareBoundaryPoints(Range.START_TO_START,r)!=1&&i.compareBoundaryPoints(Range.END_TO_END,r)!=-1){s+=u.dataset.code.length}}}return i.toString().length+s}return 0},getWholeSelection:function(n){var t=window.getSelection(),i,s=t.getRangeAt(0),r=s.cloneRange(),a=e.getCaretCharacterOffsetWithin(n);s.collapse(true);t.removeAllRanges();t.addRange(s);i=e.getCaretCharacterOffsetWithin(n);t.removeAllRanges();t.addRange(r);return[i,a]},setCaretCharacterOffsetWithin:function(n,t,i,s,r){if(i===undefined){i=0}if(s===undefined){s=document.createRange()}if(r===undefined){r=false}for(var a=0;a<n.childNodes.length;a++){var o=n.childNodes[a];if(o.nodeType==3){if(o.length>=t){var u=window.getSelection();if(!r){s.setStart(o,t);r=true;t+=i}if(r&&o.length>=t){s.setEnd(o,t);u.removeAllRanges();u.addRange(s);return-1}}t-=o.length}else if(o.nodeType==1){if(o.tagName=="IMG"&&o.dataset.code){if(o.dataset.code.length>=t){var u=window.getSelection();if(!r){s.setStartAfter(o);r=true;t+=i}if(r&&o.dataset.code.length>=t){s.setEndAfter(o);u.removeAllRanges();u.addRange(s);return-1}}t-=o.dataset.code.length}else{t=e.setCaretCharacterOffsetWithin(o,t,i,s,r);if(t<0){return-1}}}else{t=e.setCaretCharacterOffsetWithin(o,t,i,s,r);if(t<0){return-1}}}return t},surroundSelection:function(e,n){var t=window.getSelection();if(t.rangeCount>0){var i=t.getRangeAt(0),s=i.startContainer,r=i.startOffset,a=document.createTextNode(e),o=document.createTextNode(n),u=i.cloneRange();u.collapse(false);u.insertNode(o);u.setStart(s,r);u.collapse(true);u.insertNode(a);i.setStartAfter(a);i.setEndBefore(o);t.removeAllRanges();t.addRange(i)}},updateContent:function(n,i){if(n===undefined){n=i=e.getCaretCharacterOffsetWithin(t[0])}e.msgVal=e.reverseParse(t.html());t.html(S.parse(e.msgVal));var s=document.createRange();e.setCaretCharacterOffsetWithin(t[0],n,i-n)},init:function(){if(!e.support()){return}var i=t.attr("id"),s=$("<span>").attr({contenteditable:"true",accesskey:"i",id:i}).css({display:"inline-block",height:"1em",padding:"0.3em 0.2em 0.2em 0.3em",fontSize:"1.2em",verticalAlign:"top",whiteSpace:"nowrap",backgroundColor:t.css("backgroundColor")});for(var r in["Top","Bottom","Left","Right"]){for(var a in["Style","Width","Color"]){s.css("border"+r+a,t.css("border"+r+a))}}t.replaceWith(s);t=s;e.$textDecoForm=$("<div>").css({position:"absolute",bottom:"3em"}).attr("id",n+"textDecoForm").append($("<button>").css("font-weight","bold").text("B").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"&nbsp;",$("<button>").css("font-style","italic").text("I").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"&nbsp;",$("<button>").css("text-decoration","underline").text("U").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"<br>",$.map([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],function(i){return[i%4==0?"<br>":"",$("<span>").css({display:"inline-block",height:"1em",width:"2em"}).addClass(n+"colorbutton").addClass(n+"bg-"+i).click(function(n){n.preventDefault();var s=e.getWholeSelection(t[0]);e.surroundSelection(""+i,"");e.updateContent(s[0],s[1])})]})).hide().insertBefore(t);N.onsetval=function(n){e.msgVal=n;t.html(S.parse(n))};N.ongetval=function(){return e.msgVal};t.on("input",function(n){e.updateContent()});t.mouseup(function(n){var t=window.getSelection();if(t.isCollapsed){return}n.preventDefault();e.$textDecoForm.show().css("left",Math.max(n.pageX-52,0));e.menuOpen=true});$(document).mousedown(function(n){if(!$(n.target).closest(e.$textDecoForm).length&&e.menuOpen){e.hideMenu()}})},support:function(){return"contentEditable"in document.documentElement&&c.get("wysiwyg")}};return{init:e.init,getMsg:e.getMsg,support:e.support,updateContent:e.updateContent}}(),b=function(){var e={text:"",started:false,start:function(){if(!c.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(e){}}},500);e.started=true}},set:function(n){e.text=n;if(!e.started){e.start()}}};return{set:e.set}}(),C=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,
support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(n){var t;if(e.support_webkit){t=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",n);t.show()}else if(e.support()){t=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:n});t.onshow=function(){setTimeout(t.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");N.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(n){if(Notification.permission!==n){Notification.permission=n}if(n==="granted"){e.show("Notifications Enabled!");N.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},sound:false,make:function(n,t){var i=f.current();if(i){if(c.get("browserNotifications")){e.show(n)}if(c.get("ding")&&e.sound){e.sound.play()}}e.startFlash();N.onnotification(n,t,i)},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var n=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(n?"[ @] ":"[@ ] ")+e.originalTitle;n=!n},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(n){if(n===undefined){n=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!n){N.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(n){if(n.originalEvent.key==r.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)}).focus(function(){e.stopFlash()});if(!e.sound){e.sound=new Audio("beep.mp3")}}};return{request:e.request,make:e.make,init:e.init}}(),S=function(){var e={smileys_a:[],cacheServerNicks:{},spLinks:[],name:function(t,i,s){if(s===undefined){s=-1}t=t=="\0"?"":t;var a=encodeURIComponent(t);t=$("<span>").text(t).html();var u=[19,20,22,24,25,26,27,28,29],f=0,d=0,g=t,h=r.getNetwork(i),p=true;switch(c.get("colordNames")){case"1":while(t[d]){f+=t.charCodeAt(d++)}g=$("<span>").append($("<span>").addClass(n+"uName-"+u[f%9].toString()).html(t)).html();break;case"2":if(h!==undefined&&h.checkLogin!==undefined&&s!=-1){g=o.get("nick"+i.toString()+":"+s.toString());if(!g){p=false;if(e.cacheServerNicks[i.toString()+":"+s.toString()]===undefined){l.getJSON(h.checkLogin+"?c="+s.toString(10)+"&n="+a,function(n){e.cacheServerNicks[i.toString()+":"+s.toString()]=n.nick},false,false)}g=e.cacheServerNicks[i.toString()+":"+s.toString()];o.set("nick"+i.toString()+":"+s.toString(),g)}}else{g=t}break;default:g=t;break}if(h!==undefined&&p){g=h.normal.split("NICKENCODE").join(a).split("NICK").join(g).split("USERID").join(s.toString(10))}if(h!==undefined){return'<span title="'+h.name+'">'+g+"</span>"}return'<span title="Unknown Network">'+g+"</span>"},smileys:function(n){if(!n){return""}if(/^[\w\s\d\.,!?]*$/.test(n)){return n}$.each(e.smileys_a,function(e,t){n=n.replace(RegExp(t.regex,"g"),t.replace)});return n},links:function(n){if(!n||n===null||n===undefined){return""}var t='[^\\s<"]';n=n.replace(RegExp("(|)","g"),"");$.map(e.spLinks,function(e){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");n=n.replace(RegExp("(^|[\\s>])((?:(?:f|ht)tps?://(?:www\\.)?)"+e+t+"*)","g"),"$1$2").replace(RegExp("(^|[\\s>])("+e+t+"*)","g"),"$1$2")});return n.replace(RegExp('(^|[^a-zA-Z0-9_"])((?:(?:f|ht)tps?://)'+t+"+)","g"),'$1<a target="_blank" href="$2">$2</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+t+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},colors:function(e){var t=[],i,s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},r,a;if(!e){return""}t=e.split(RegExp("([])"));e="<span>";for(r=0;r<t.length;r++){a=true;switch(t[r]){case"":i=t[r+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(i==t[r+1]){i=t[r+1].replace(/^([0-9]{1,2}).*/,"$1:");if(i!=t[r+1]){s.fg=i.split(":")[0];t[r+1]=t[r+1].substr(i.length-1)}else{s.fg="-1";s.bg="-1"}}else{s.fg=i.split(":")[0];s.bg=i.split(":")[1];if(i==t[r+1]){t[r+1]=""}else{t[r+1]=t[r+1].substr(i.length)}}break;case"":s.bold=!s.bold;break;case"":s.italic=!s.italic;break;case"":i=s.fg;s.fg=s.bg;s.bg=i;if(s.fg=="-1"){s.fg="0"}if(s.bg=="-1"){s.bg="1"}break;case"":s.underline=!s.underline;break;case"":s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:a=false}if(a){e+="</span>"+'<span class="'+n+"fg-"+s.fg+" "+n+"bg-"+s.bg+'" style="'+(s.bold?"font-weight:bold;":"")+(s.underline?"text-decoration:underline;":"")+(s.italic?"font-style:italic;":"")+'">'}else{e+=t[r]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},highlight:function(e){var n="";if(!c.get("highRed")){n+="background:none;padding:none;border:none;"}if(c.get("highBold")){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"},parse:function(n,t){if(t==undefined||!t){t=false}n=n=="\0"?"":n;n=$("<span>").text(n).html();if(c.get("smileys")&&t===false){n=e.smileys(n)}n=e.colors(n);n=e.links(n);return n},setSmileys:function(n){e.smileys_a=[];$.each(n,function(n,t){e.smileys_a.push({regex:t.regex,replace:t.replace.split("ADDSTUFF").join('data-code="'+t.code+'"').split("PIC").join(t.pic).split("ALT").join(t.alt)})})},setSpLinks:function(n){e.spLinks=n},parseTextDecorations:function(e){if(e!==""&&c.get("textDeco")){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e},addLine:function(n,t){if(n.type!="highlight"&&n.chan.toString().toLowerCase()!=g.current().handler.toLowerCase()&&n.name2!==r.getPmIdent()){return}var i=e.name(n.name,n.network,n.uid),s=e.parse(n.message),a="*",o=s;if(r.nick()!=""&&["message","action","pm","pmaction"].indexOf(n.type)>=0&&n.name.toLowerCase()!="*"&&s.toLowerCase().indexOf(r.nick().toLowerCase().substr(0,c.get("charsHigh")))>=0){o=s=S.highlight(s);if(!t&&x.isBlurred()){C.make("("+g.current().name+") <"+n.name+"> "+n.message,n.chan)}}switch(n.type){case"reload":if(!t){g.current().reload()}return;case"reload_userlist":if(!t){g.current().reloadUserlist()}return;case"relog":if(!t){r.fetch(undefined,true)}return;case"refresh":if(!t){location.reload(true)}return;case"join":o=[i," has joined "+g.current().name];if(!t){h.add({nick:n.name,network:n.network})}if(r.getNetwork(n.network).type==1&&!c.get("oircJoinPart")){return}break;case"part":o=[i," has left "+g.current().name+" (",s,")"];if(!t){h.remove({nick:n.name,network:n.network})}if(r.getNetwork(n.network).type==1&&!c.get("oircJoinPart")){return}break;case"quit":o=[i," has quit IRC (",s,")"];if(!t){h.remove({nick:n.name,network:n.network})}if(r.getNetwork(n.network).type==1&&!c.get("oircJoinPart")){return}break;case"kick":o=[i," has kicked ",S.name(n.name2,n.network)," from "+g.current().name+" (",s,")"];if(!t){h.remove({nick:n.name2,network:n.network})}break;case"message":a=i;break;case"action":o=[i," ",s];break;case"mode":if(typeof s=="string"){s=n.message.split(" ");$.each(s,function(e,t){var i=$("<span>").html(t).text();if(i.indexOf("+")==-1&&i.indexOf("-")==-1){s[e]=S.name(t,n.network)}});s=s.join(" ")}o=[i," set "+g.current().name+" mode ",s];break;case"nick":o=[i," has changed nicks to ",S.name(n.name2,n.network)];if(!t){h.add({nick:n.name2,network:n.network});h.remove({nick:n.name,network:n.network})}break;case"topic":N.ontopicchange(S.parse(n.message,true));if(n.name===""&&n.network===0&&t){return}o=[i," has changed the topic to ",S.parse(n.message,true)];break;case"pm":if(n.chan==g.current().handler){a=i;n.type="message"}else{if(!t){if(n.name.toLowerCase()==r.nick().toLowerCase()){g.joinPm(n.chan,r.getWholePmIdent(n.uid,n.network));return}else{a=["(PM)",i];g.joinPm(n.name,r.getWholePmIdent(n.uid,n.network));C.make("(PM) <"+n.name+"> "+n.message,n.chan)}}else{return}}break;case"pmaction":if(n.chan==g.current().handler){o=[i," ",s];n.type="action"}else{if(!t){if(n.name.toLowerCase()==r.nick().toLowerCase()){g.joinPm(n.chan,r.getWholePmIdent(n.uid,n.network));return}else{o=["(PM)",i," ",s];g.joinPm(n.name,r.getWholePmIdent(n.uid,n.network));notofication.make("* (PM)"+n.name+" "+n.message,n.chan);n.type="pm"}}else{return}}break;case"highlight":if(n.name.toLowerCase()!="*"){C.make("("+n.chan+") <"+n.name+"> "+n.message,n.chan)}return;case"internal":o=n.message;break;case"server":break;default:return}N.onmessage(a,o,n,t)}};return{setSmileys:e.setSmileys,setSpLinks:e.setSpLinks,parse:e.parse,parseTextDecorations:e.parseTextDecorations,name:e.name,highlight:e.highlight,addLine:e.addLine}}(),y=function(){var e={$errors:false,$warnings:false,errors:[],warnings:[],$errorsPopup:false,$warningsPopup:false,getSinglePopupEntry:function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,n){return["<br>",$("<span>").text(n).html(),": ",$("<span>").text(e).html()]}))},makePopup:function(n,t,i){return $("<div>").addClass("errorPopup").addClass(n.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();i()}),"&nbsp;",$("<b>").text(n),$("<div>").addClass("errorPopupCont").append($.map(t,function(n){return e.getSinglePopupEntry(n)}))).appendTo("body")},init:function(n,t){if(n===undefined){n=$("#errors")}if(t===undefined){t=$("#warnings")}n.click(function(){if(!e.$errorsPopup){e.$errorsPopup=e.makePopup("Errors",e.errors,function(){e.$errorsPopup=false})}});t.click(function(){if(!e.$warningsPopup){e.$warningsPopup=e.makePopup("Warnings",e.warnings,function(){e.$warningsPopup=false})}});e.$errors=n;e.$warnings=t},addError:function(n,t){e.errors.push({time:(new Date).getTime(),file:n,content:t});e.$errors.css("display","").find(".count").text(e.errors.length);if(e.$errorsPopup){e.$errorsPopup.children("div").append(e.getSinglePopupEntry(e.errors[e.errors.length-1]))}},addWarning:function(n,t){e.warnings.push({time:(new Date).getTime(),file:n,content:t});e.$warnings.css("display","").find(".count").text(e.warnings.length);if(e.$warningsPopup){e.$warningsPopup.children("div").append(e.getSinglePopupEntry(e.warnings[e.warnings.length-1]))}}};return{addError:e.addError,addWarning:e.addWarning,init:e.init}}(),x=function(){var e={isBlurred:true,init:function(){$(window).blur(function(){e.isBlurred=true}).focus(function(){e.isBlurred=false})},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+N.settings.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+N.settings.net())}})}};return{init:e.init,changeLinks:e.changeLinks,isBlurred:function(){return e.isBlurred}}}(),P=function(){var e={isOpen:false,open:function(n){if(e.isOpen){return}e.isOpen=true;d.stop(n)},close:function(){if(!e.isOpen){return}e.isOpen=false;g.current().reload()},fetch:function(n,t,i){if(!e.isOpen){return}if(i===undefined){i=0}l.getJSON("Log.php?day="+n+"&offset="+parseInt(i,10)+"&channel="+g.current().handlerB64,function(r){if(!r.banned){$.map(r.lines,function(e){s(e,true)});if(r.lines.length>=1e3){e.fetch(n,t,i+1e3)}else if(t!==undefined){t(true)}}else{m.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');t(false)}})}};return{fetch:e.fetch,open:e.open,close:e.close}}(),N;this.OMNOMIRCSERVER=e;this.settings={loggedIn:r.loggedIn,fetch:r.fetch,net:r.net,getNetwork:r.getNetwork,getPmIdent:r.getPmIdent,getWholePmIdent:r.getWholePmIdent,nick:r.nick,guestLevel:r.guestLevel,identGuest:r.identGuest,logout:r.logout};this.ls={get:a.get,set:a.set};this.network={getJSON:l.getJSON,post:l.post};this.options={get:c.get,set:c.set,getAll:c.getAll};this.instant={current:f.current};this.channels={load:g.load,join:g.join,joinPm:g.joinPm,part:g.part,getList:g.getList,getHandler:g.getHandler,current:g.current,setChans:g.setChans,highlight:g.highlight};this.users={add:h.add,remove:h.remove,setUsers:h.setUsers};this.send={send:m.send,internal:m.internal,val:m.val};this.parser={parse:S.parse,name:S.name,highlight:S.highlight};this.error={addWarning:y.addWarning,addError:y.addError,init:y.init};this.page={changeLinks:x.changeLinks,isBlurred:x.isBlurred};this.logs={fetch:P.fetch,open:P.open,close:P.close};this.statusBar={set:b.set};this.initinput=function(e,n){if(e===undefined){e=$("#message")}t=e;if(n){v.init()}w.init();k.init();t.keypress(function(e){if(e.which==13){e.preventDefault();if(!t.attr("disabled")){m.send(function(){m.val("");t.focus()})}}})};this.connect=function(e){x.init();C.init();r.fetch(function(){f.init();d.init();g.init();e()})};this.disconnect=function(){f.kill();d.kill()};this.setClassPrefix=function(e){n=e};this.onerror=function(){};this.onwarning=function(){};this.onmessage=function(){};this.onmessageraw=false;this.onuserchange=function(){};this.onchannelchange=function(){};this.onchanneljoin=function(){};this.onchannelpart=function(){};this.onsmileychange=function(){};this.onsetval=false;this.ongetval=false;this.ontopicchange=function(){};this.onnotification=function(){};N=this;if(this.setOptions!==undefined){this.options.setAll=c.setAll;this.setOptions();delete this.options.setAll}}