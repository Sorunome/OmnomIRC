/**
 * @license
 * OmnomIRC COPYRIGHT 2010,2011 Netham45
 *                    2012-2016 Sorunome
 *
 *  This file is part of OmnomIRC.
 *
 *  OmnomIRC is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  OmnomIRC is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with OmnomIRC.  If not, see <http://www.gnu.org/licenses/>.
 */
oirc=function(){var e="https://omnomirc.omnimaga.org",t=function(){var e={hostname:"",nick:"",signature:"",numHigh:4,uid:-1,checkLoginUrl:"",net:"",networks:{},pmIdent:false,fetch:function(t,r){if(r===undefined){r=false}i.getJSON("config.php?js"+(document.URL.split("network=")[1]!==undefined?"&network="+document.URL.split("network=")[1].split("&")[0].split("#")[0]:"")+(r?"&clonly":""),function(a){var o;if(!r){e.hostname=a.hostname;l.setChans(a.channels);parser.setSmileys(a.smileys);e.networks={};$.each(a.networks,function(t,n){e.networks[n.id]=n});e.net=a.network;n.setPrefix(e.net);s.setDefaults(a.defaults);s.setExtraChanMsg(a.extraChanMsg);c.setData(a.websockets.use,a.websockets.host,a.websockets.port,a.websockets.ssl)}e.checkLoginUrl=a.checkLoginUrl;o=n.get("checklogin");if(!o||r){i.getJSON(e.checkLoginUrl+"&network="+e.net.toString()+"&jsoncallback=?",function(i){e.nick=i.nick;e.signature=i.signature;e.uid=i.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";n.set("checklogin",{nick:e.nick,signature:e.signature,uid:e.uid});if(t!==undefined){t()}},!r,false)}else{e.nick=o.nick;e.signature=o.signature;e.uid=o.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";if(t!==undefined){t()}}},!r,false)},getUrlParams:function(){return"nick="+base64.encode(e.nick)+"&signature="+base64.encode(e.signature)+"&time="+(+new Date).toString()+"&id="+e.uid+"&network="+e.net+(e.nick!=""?"&noLoginErrors":"")},getNetwork:function(t){if(e.networks[t]!==undefined){return e.networks[t]}return{id:-1,normal:"NICK",userlist:"NICK",name:"Invalid network",type:-1}},getIdentParams:function(){return{nick:e.nick,signature:e.signature,time:(+new Date).toString(),id:e.uid,network:e.net}},loggedIn:function(){return e.signature!==""},getWholePmIdent:function(t,n){var i="["+n.toString()+","+t.toString()+"]";if(n<e.net){return i+e.pmIdent}else if(e.net<n){return e.pmIdent+i}else if(t<e.uid){return i+e.pmIdent}else{return e.pmIdent+i}}};return{fetch:e.fetch,getUrlParams:e.getUrlParams,getIdentParams:e.getIdentParams,getNetwork:e.getNetwork,nick:function(){return e.nick},net:function(){return e.net},loggedIn:e.loggedIn,getPmIdent:function(){return e.pmIdent},getWholePmIdent:e.getWholePmIdent}}(),n=function(){var e={prefix:"",setPrefix:function(t){e.prefix=t},getCookie:function(e){var t,n,i,s=document.cookie.split(";");for(t=0;t<s.length;t++){n=s[t].substr(0,s[t].indexOf("="));i=s[t].substr(s[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(i)}}},setCookie:function(e,t,n){var i=new Date,s=escape(t);i.setDate(i.getDate()+n);s+=n===null?"":"; expires="+i.toUTCString();document.cookie=e+"="+s},haveSupport:null,support:function(){if(e.haveSupport===null){try{localStorage.setItem("test",1);localStorage.removeItem("test");e.haveSupport=true}catch(t){e.haveSupport=false}}return e.haveSupport},get:function(t){var n;t=e.prefix+t;if(e.support()){n=localStorage.getItem(t)}else{n=getCookie(t)}return JSON.parse(n)},set:function(t,n){t=e.prefix+t;n=JSON.stringify(n);if(e.support()){localStorage.setItem(t,n)}else{setCookie(t,n)}}};return{setPrefix:e.setPrefix,get:e.get,set:e.set}}(),i=function(){var e={errors:[],warnings:[],errorsOpen:false,warningsOpen:false,didRelog:false,removeSig:function(e){try{var t=e.split("signature="),n=t[1].split("&");n[0]="---";t[1]=n.join("&");return t.join("signature=")}catch(i){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},addError:function(t,n){t=e.removeSig(t);e.errors.push({time:(new Date).getTime(),file:t,content:n});$("#errors").css("display","").find(".count").text(e.errors.length)},addWarning:function(t,n){t=e.removeSig(t);e.warnings.push({time:(new Date).getTime(),file:t,content:n});$("#warnings").css("display","").find(".count").text(e.warnings.length)},checkCallback:function(n,i,s,r){if(n.relog!=2){if(n.errors!==undefined){$.map(n.errors,function(t){if(t.type!==undefined){e.addError(r,t)}else{e.addError(r,{type:"misc",message:t})}if(e.errorsOpen){$(".errors > .errorPopupCont").append(e.getSinglePopupEntry(errors[errors.length-1]))}})}if(n.warnings!==undefined){$.map(n.warnings,function(t){if(t.type!==undefined){e.addWarning(r,t)}else{e.addWarning(r,{type:"misc",message:t})}if(e.warningsOpen){$(".warnings > .errorPopupCont").append(e.getSinglePopupEntry(warnings[warnings.length-1]))}})}}if(n.relog!==undefined&&n.relog!=0){if(n.relog==1){t.fetch(undefined,true);i(n)}else if(n.relog==2){t.fetch(function(){s()},true)}else if(n.relog==3){if(e.didRelog){i(n)}else{t.fetch(function(){s()},true)}}e.didRelog=true}else{if(n.relog!==undefined){e.didRelog=false}i(n)}},getSinglePopupEntry:function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,t){return["<br>",$("<span>").text(t).html(),": ",$("<span>").text(e).html()]}))},makePopup:function(t,n,i){return $("<div>").addClass("errorPopup").addClass(t.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();i()}),"&nbsp;",$("<b>").text(t),$("<div>").addClass("errorPopupCont").append($.map(n,function(t){return e.getSinglePopupEntry(t)}))).appendTo("body")},getJSON:function(n,i,s,r){if(s==undefined){s=true}if(r==undefined){r=true}var a=n+(r?"&"+t.getUrlParams():"");return $.ajax({url:a,dataType:"json",async:s}).done(function(t){e.checkCallback(t,i,function(){e.getJSON(n,i,s,r)},a)})},post:function(n,i,s,r,a){if(r==undefined){r=true}if(a==undefined){a=true}var o=n+(a?"&"+t.getUrlParams():"");return $.ajax({type:"POST",url:o,async:r,data:i}).done(function(t){e.checkCallback(t,s,function(){e.post(n,i,s,r,a)},o)})},init:function(){$("#errors > .icon").click(function(){if(!e.errorsOpen){e.errorsOpen=true;e.makePopup("Errors",e.errors,function(){e.errorsOpen=false})}});$("#warnings > .icon").click(function(){if(!e.warningsOpen){e.warningsOpen=true;e.makePopup("Warnings",e.warnings,function(){e.warningsOpen=false})}})}};return{getJSON:e.getJSON,post:e.post,init:e.init}}(),s=function(){var e={extraChanMsg:"",allOptions:{highBold:{disp:"Highlight Bold","default":true},highRed:{disp:"Highlight Red","default":true},colordNames:{disp:"Colored Names","default":0,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(t,n){return $("<option>").attr(e.get("colordNames")==n?"selected":"false","selected").val(n).text(t)})))}},curChan:{hidden:true,"default":0},extraChans:{disp:"Show extra Channels","default":false,before:function(){if(e.extraChanMsg!==""){alert(e.extraChanMsg)}return true}},altLines:{disp:"Alternating Line Highlight","default":true},enable:{disp:"Enable OmnomIRC","default":true},ding:{disp:"Ding on Highlight","default":false},times:{disp:"Show Timestamps","default":true},statusBar:{disp:"Show Updates in Browser Status Bar","default":true},smileys:{disp:"Show Smileys","default":true},hideUserlist:{disp:"Hide Userlist","default":false},charsHigh:{disp:"Number chars for Highlighting","default":4,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("charsHigh",this.value)}).append($.map([1,2,3,4,5,6,7,8,9,10],function(t){return $("<option>").attr(e.get("charsHigh")==t?"selected":"false","selected").val(t).text(t)})))}},scrollBar:{disp:"Show Scrollbar","default":true},scrollWheel:{disp:"Enable Scrollwheel","default":true},browserNotifications:{disp:"Browser Notifications","default":false,before:function(){o.request();return false}},oircJoinPart:{disp:"Show OmnomIRC join/part messages","default":false},wysiwyg:{disp:"Use WYSIWYG editor (experimental)","default":false},textDeco:{disp:"Enable simple text decorations","default":false},fontSize:{disp:"Font Size","default":9,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<input>").attr({type:"number",step:1,min:1,max:42}).css("width","3em").val(e.get("fontSize")).change(function(){e.set("fontSize",parseInt(this.value,10));$("body").css("font-size",this.value+"pt")}))}}},init:function(t){var i=n.get("options");$.each(e.allOptions,function(n,s){var r=s.default;if(i&&i[n]!==undefined){r=i[n]}else if(t&&t[n]!==undefined){r=t[n]}e.allOptions[n].value=r})},set:function(t,i){if(e.allOptions[t]===undefined){return}e.allOptions[t].value=i;var s=n.get("options")||{};s[t]=i;n.set("options",s)},get:function(t){if(e.allOptions[t]!==undefined){return e.allOptions[t].value}},setExtraChanMsg:function(t){e.extraChanMsg=t},setDefaults:function(t){e.init(t)},getHTML:function(){return $.merge($.map([false,true],function(t){return $("<table>").addClass("optionsTable").append($.map(e.allOptions,function(n,i){if(n.hidden){return}return(t=!t)?$("<tr>").append($.merge([$("<td>").text(n.disp)],n.handler===undefined?[$("<td>").addClass("option "+(e.get(i)?"selected":"")).text("Yes").click(function(){if(!e.get(i)){if(n.before!==undefined&&n.before()||n.before===undefined){e.set(i,true);$(this).addClass("selected").next().removeClass("selected")}}}),$("<td>").addClass("option "+(!e.get(i)?"selected":"")).text("No").click(function(){if(e.get(i)){e.set(i,false);$(this).addClass("selected").prev().removeClass("selected")}})]:n.handler())):""}))}),$("<div>").append("&nbsp;",$("<a>").text("Reset Defaults").click(function(e){e.preventDefault();n.set("options",null);n.set("checklogin",null);n.set("channels",null);document.location.reload()})))}};return{set:e.set,get:e.get,setDefaults:e.setDefaults,setExtraChanMsg:e.setExtraChanMsg,getHTML:e.getHTML}}(),r=function(){var e={id:Math.random().toString(36)+(new Date).getTime().toString(),update:function(){n.set("browserTab",e.id);n.set("newInstant",false)},init:function(){n.set("browserTab",e.id);$(window).focus(function(){e.update()}).unload(function(){n.set("newInstant",true)})},current:function(){if(n.get("newInstant")){e.update()}return e.id==n.get("browserTab")}};return{init:e.init,current:e.current}}(),a=function(){var e={interval:false,$elem:false,start:function(){if(e.interval===false){pixels=[true,true,true,true,true,false,false,false];e.$elem=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body");e.interval=setInterval(function(){e.$elem.empty().append($.map(pixels,function(e){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:e?"black":""})}));var t=pixels[0],n;for(n=1;n<=7;n++){pixels[n-1]=pixels[n]}pixels[7]=t},50)}},stop:function(){if(e.interval!==false){clearInterval(e.interval);e.interval=false;e.$elem.remove()}}};return{start:e.start,stop:e.stop}}(),o=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(t){var n;if(e.support_webkit){n=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",t);n.show()}else if(e.support()){n=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:t});n.onshow=function(){setTimeout(n.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){show("Notifications Enabled!");s.set(7,true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(e){if(Notification.permission!==e){Notification.permission=e}if(e==="granted"){show("Notifications Enabled!");s.set(7,true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},make:function(t,n){if(r.current()){if(s.get("browserNotifications")){e.show(t)}if(s.get("ding")){$("#ding")[0].play()}if(n!=l.current().handler){l.highlight(n,true)}}else{if(n!=l.current().handler){l.highlight(n)}}}};return{request:e.request,make:e.make}}(),c=function(){var e={ws:{socket:false,connected:false,use:true,sendBuffer:[],allowLines:false,enabled:false,host:"",port:0,ssl:true,tryFallback:true,fallback:function(){console.log("trying fallback...");if(e.ws.tryFallback){try{e.ws.tryFallback=false;e.ws.socket.close()}catch(t){}i.getJSON("omnomirc.php?getcurline&noLoginErrors",function(t){l.current().reloadUserlist();e.setCurLine(t.curline);use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()})}},identify:function(){e.ws.send($.extend({action:"ident"},t.getIdentParams()))},init:function(){if(!("WebSocket"in window)||!e.ws.enabled){e.ws.use=false;return false}try{e.ws.socket=new WebSocket((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString())}catch(n){console.log(e.ws.socket);console.log((ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString());console.log(n);e.ws.fallback()}e.ws.socket.onopen=function(t){e.ws.connected=true;for(var n=0;n<e.ws.sendBuffer.length;n++){e.ws.send(e.ws.sendBuffer[n])}e.ws.sendBuffer=[]};e.ws.socket.onmessage=function(n){try{var i=JSON.parse(n.data);console.log(i);if(e.ws.allowLines&&i.line!==undefined){if(!parser.addLine(i.line)){e.ws.tryFallback=false;e.ws.socket.close()}}if(i.relog!==undefined&&i.relog!=0){t.fetch(function(){e.ws.identify()},true)}}catch(n){}};e.ws.socket.onclose=function(t){console.log(t);e.ws.use=false;e.ws.fallback()};e.ws.socket.onerror=function(t){console.log(t);e.ws.socket.close();e.ws.use=false;e.ws.fallback()};e.ws.identify();$(window).on("beforeunload",function(){e.ws.socket.close()});return true},send:function(t){if(e.ws.connected){e.ws.socket.send(JSON.stringify(t))}else{e.ws.sendBuffer.push(t)}}},old:{inRequest:false,handler:false,lastSuccess:(new Date).getTime(),sendRequest:function(){if(!l.current().loaded()){return}e.old.handler=i.getJSON("Update.php?high="+s.get("charsHigh").toString()+"&channel="+l.current().handlerB64+"&lineNum="+e.curLine.toString(),function(t){var n=true;if(!l.current().loaded()){return}e.old.handler=false;e.old.lastSuccess=(new Date).getTime();if(t.lines!==undefined){$.each(t.lines,function(e,t){return n=parser.addLine(t)})}if(t.banned===true){n=false}if(n){e.old.setTimer()}}).fail(function(){e.old.handler=false;if((new Date).getTime()>=e.old.lastSuccess+3e5){v.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!e.old.inRequest){e.old.lastSuccess=(new Date).getTime()}else{e.old.setTimer()}})},setTimer:function(){if(l.current().loaded()&&e.old.handler===false){setTimeout(function(){e.old.sendRequest()},m.isBlurred()?2500:200)}else{e.old.stop()}},start:function(){if(!e.old.inRequest){e.old.inRequest=true;e.old.setTimer()}},stop:function(){if(e.old.inRequest){e.old.inRequest=false;try{e.old.handler.abort()}catch(t){}}},send:function(t,n){e.old.stop();i.getJSON("message.php?message="+base64.encode(t)+"&channel="+l.current().handlerB64,function(){e.old.start();if(n!==undefined){n()}})}},curLine:0,setChan:function(t){if(e.ws.use){e.ws.send({action:"chan",chan:t})}},stop:function(){if(e.ws.use){e.ws.allowLines=false}else{e.old.stop()}},start:function(){if(e.ws.use){e.ws.allowLines=true}else{e.old.start()}},setCurLine:function(t){if(t>e.curLine){e.curLine=t}},send:function(t,n){if(e.ws.use){e.ws.send({action:"message",message:t});if(n!==undefined){n()}}else{e.old.send(t,n)}},setData:function(t,n,i,s){e.ws.enabled=t;e.ws.host=n;e.ws.port=i;e.ws.ssl=s},init:function(){if(e.ws.enabled){e.ws.init()}else{e.ws.use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()}}};return{setChan:e.setChan,start:e.start,stop:e.stop,setCurLine:e.setCurLine,send:e.send,setData:e.setData,init:e.init}}(),l=function(){var e=function(e,t){var n=t.chans[e]!==undefined,r={i:e,name:n?t.chans[e].chan.toLowerCase():"",handler:n?t.getHandler(e):-1,handlerB64:n?t.getHandler(e,true):-1,loaded:false,load:function(t,n){if(t.lines===undefined){if(t.message){v.internal(t.message)}else{v.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}return false}s.set("curChan",e);if(t.banned){v.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');return false}if(t.admin){$("#adminLink").css("display","")}else{$("#adminLink").css("display","none")}if(t.ignores!==undefined){parser.setIgnoreList(t.ignores)}d.setUsers(t.users);d.draw();$.each(t.lines,function(e,t){parser.addLine(t,true)});g.down();r.loaded=true;return true},part:function(){t.part(r.i)},reloadUserlist:function(e){if(!n){return}i.getJSON("Load.php?userlist&channel="+r.handlerB64,function(e){if(!e.banned){d.setUsers(e.users);d.draw()}else{v.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})},reload:function(){t.join(r.i)},setI:function(e){r.i=e},is:function(e){return e==r.i}};return{name:r.name,handler:r.handler,handlerB64:r.handlerB64,load:r.load,part:r.part,reloadUserlist:r.reloadUserlist,reload:r.reload,loaded:function(){return r.loaded},setI:r.setI,is:r.is}},r={chans:[],current:false,save:function(){n.set("channels",r.chans)},load:function(){try{var e=n.get("channels"),t=$.map(r.chans,function(e){if(e.ex&&s.get("extraChans")||!e.ex){return e}return undefined}),i=[];if(e!==null&&e!=[]){r.chans=$.merge($.map(e,function(e){if(e.id!=-1&&e.id.toString().substr(0,1)!="*"){var t=false;$.each(r.chans,function(n,s){if(s.id==e.id){i.push(e);t=true;e.chan=s.chan;return false}});if(!t){return undefined}}return e}),$.map(t,function(e){var t=false;$.each(i,function(n,i){if(i.id==e.id){t=true;e.chan=i.chan;return false}});if(t){return undefined}return e}));save()}}catch(a){}},draw:function(){var e=0,t=0,n=false,i=0,a=false,o=0,c=function(t){o=$(t).width();a=false;$(t).css({position:"absolute","z-index":100,left:e-i}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:o})).addClass("dragging").find("div").css("display","block").focus();n=false},u=function(e,s){e.preventDefault();t=e.clientX;i=t-$(s).position().left;n=true},f=function(s,r){e=s.clientX;if(n&&Math.abs(e-t)>=4){n=false;c(r);s.preventDefault()}else if($(r).hasClass("dragging")){var a=e-i;$(r).css("left",a);$ne=$("#topicDragPlaceHolder").next(".chanList");$pe=$("#topicDragPlaceHolder").prev(".chanList");if($ne.length>0&&$ne.position().left<a+o/2){$ne.after($("#topicDragPlaceHolder").remove())}else if($pe.length>0){if($pe.attr("id")==$(r).attr("id")){$pe=$pe.prev()}if($pe.length>0&&$pe.position().left>a){$pe.before($("#topicDragPlaceHolder").remove())}}}},d=function(e,t){if(n){n=false}else{$(t).find("div").css("display","none");$("#topicDragPlaceHolder").replaceWith(t);r.chans=$.map($(".chanList"),function(e,t){if($(e).find("span").hasClass("curchan")){s.set("curChan",t);r.current.setI(t)}return $(e).data("json")});r.save();r.draw()}};$("#ChanList").empty().append($.map(r.chans,function(e,t){if(e.ex&&s.get("extraChans")||!e.ex){return $("<div>").data("json",e).attr("id","chan"+t.toString()).addClass("chanList"+(e.high?" highlightChan":"")).append($("<span>").addClass("chan "+(r.current.is(t)?" curchan":"")).append(e.chan.substr(0,1)!="#"?$("<span>").addClass("closeButton").css({width:9,"float":"left"}).mouseup(function(e){if(a){l.part(t)}}).text("x"):"",$("<span>").text(e.chan)).mouseup(function(){if(a){l.join(t)}}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(e){f(e,$(this).parent())}).mouseup(function(e){d(e,$(this).parent())}).mouseout(function(e){d(e,$(this).parent())})).mousedown(function(e){a=true;u(e,this)}).mousemove(function(e){f(e,this)}).mouseout(function(e){if(n){c(this)}}).mouseup(function(e){d(e,this)})}}))},init:function(){r.current=e(-1,r);r.load();r.draw()},getHandler:function(e,t){if(r.chans[e].id!=-1){if(typeof r.chans[e].id!="number"&&t){return base64.encode(r.chans[e].id)}return r.chans[e].id.toString()}if(t){return base64.encode(r.chans[e].chan)}return r.chans[e].chan},requestHandler:false,join:function(n,s){if(r.chans[n]===undefined){return}a.start();c.stop();$("#message").attr("disabled","true");$("#MessageBox").empty();$(".chan").removeClass("curchan");if(r.requestHandler!==false){r.requestHandler.abort()}r.requestHandler=i.getJSON("Load.php?count=125&channel="+r.getHandler(n,true),function(i){r.current=e(n,r);if(r.current.load(i,s)){c.setChan(r.getHandler(n));c.start();r.chans[n].high=false;r.save();f.load();b.read();if(t.loggedIn()){$("#message").removeAttr("disabled")}}r.requestHandler=false;$("#chan"+n.toString()).removeClass("highlightChan").find(".chan").addClass("curchan");if(s!==undefined){s()}a.stop()})},highlight:function(e,t){$.each(r.chans,function(t,n){if(e==n.id||n.chan.toLowerCase()==e.toString().toLowerCase()){$("#chan"+t.toString()).addClass("highlightChan");r.chans[t].high=true}});if(t!==undefined&&t){r.save()}},addChan:function(e,t,n){var i=true;if(n===undefined){n=-1}e=e.toLowerCase();$.each(r.chans,function(t,n){if(n.chan==e){i=t}});if(i===true){r.chans.push({chan:e,high:!t,ex:false,id:n,order:-1});r.save();r.draw();if(t){r.join(r.chans.length-1)}}else{r.chans[i].high|=!t;if(t){r.join(i)}}},open:function(e){var t=true;e=e.trim();if(e.substr(0,1)!="@"&&e.substr(0,1)!="#"){e="@"+e}r.addChan(e,true)},openPm:function(e,t,n){var s=true,a=function(t,i){if(n===undefined){n=false}t=t.trim();if(t.substr(0,1)!="*"){t="*"+e}i=i.trim();if(i.substr(0,1)!="*"){i="*"+i}r.addChan(t,n,i)};if(t==""){i.getJSON("Load.php?openpm="+base64.encode(e),function(e){if(e.chanid){a(e.channick,e.chanid)}else{v.internal('<span style="color:#C73232;">Query Error: User not found.</span>')}})}else{a(e,t)}},part:function(e){var t=false;if(parseInt(e,10)==e){e=parseInt(e,10)}if(typeof e!="number"){$.each(r.chans,function(t,n){if(n.chan==e){e=t}})}if(typeof e!="number"||r.chans[e]===undefined){v.internal('<span style="color:#C73232;"> Part Error: I cannot part '+e+". (You are not in it.)</span>");return}if(r.chans[e].chan.substr(0,1)=="#"){v.internal('<span style="color:#C73232;"> Part Error: I cannot part '+r.chans[e].chan+". (IRC channel.)</span>");return}if(r.current.is(e)){t=true}r.chans.splice(e,1);r.save();r.draw();if(t){r.join(e-1)}},getNames:function(){return $.map(r.chans,function(e){return e.chan})},setChans:function(e){r.chans=e}};return{highlight:r.highlight,join:r.join,current:function(){return r.current},open:r.open,openPm:r.openPm,part:r.part,getNames:r.getNames,init:r.init,setChans:r.setChans}}(),f=function(){var e="",t=0,n=false,i=0,s="",r=0,a="",o=0,c=" ",u=[],f;getCurrentWord=function(){var t=!h.support()?$("#message")[0].value:(f=window.getSelection().anchorNode).nodeValue;if(n){return e}i=!h.support()?$("#message")[0].selectionStart:window.getSelection().anchorOffset;s=t.charAt(i);while(s!=" "&&--i>0){s=t.charAt(i)}if(s==" "){i++}r=!h.support()?$("#message")[0].selectionStart:window.getSelection().anchorOffset;a=t.charAt(r);while(a!=" "&&++r<=t.length){a=t.charAt(r)}o=r;e=t.substr(i,r-i).trim();return e},getTabComplete=function(){var e=!h.support()?$("#message")[0].value:f.nodeValue,s;if(e===null){return}s=search(getCurrentWord(),t);if(!n){c=" ";if(i===0){c=": "}}if(s==getCurrentWord()){t=0;s=search(getCurrentWord(),t)}e=e.substr(0,i)+s+c+e.substr(r+1);if(!h.support()){$("#message")[0].value=e}else{window.getSelection().anchorNode.nodeValue=e;window.getSelection().getRangeAt(0).setEnd(f,i+s.length+c.length);window.getSelection().getRangeAt(0).setStart(f,i+s.length+c.length)}r=o+s.length+c.length},search=function(e,t){var n=false;if(!t){t=0}$.each(u,function(i,s){if(s.toLowerCase().indexOf(e.toLowerCase())===0&&t--<=0&&n===false){n=s}});if(n!==false){return n}return e};return{init:function(){$("#message").keydown(function(i){if(i.keyCode==9){if(!i.ctrlKey){i.preventDefault();getTabComplete();n=true;t++;setTimeout(1,1)}}else{e="";t=0;n=false}})},load:function(){u=$.merge(d.getNames(),l.getNames())}}}(),d=function(){var e={users:[],exists:function(t){var n=false;$.each(e.users,function(e,t){if(t.nick.toLowerCase()==u.nick.toLowerCase()&&t.network==u.network){n=true;return false}});return n},add:function(t){if(l.current().handler!==""){e.users.push(t);e.draw()}},remove:function(t){if(l.current().handler!==""){$.each(e.users,function(n,i){if(i.nick==t.nick&&i.network==t.network){e.users.splice(n,1);return false}});e.draw()}},draw:function(){e.users.sort(function(e,t){var n=e.nick.toLowerCase(),i=t.nick.toLowerCase();return n==i?e==t?0:e<t?-1:1:n<i?-1:1});$("#UserList").empty().append($.map(e.users,function(e){var n,s=encodeURIComponent(e.nick),r=$("<span>").text(e.nick).html();return $("<span>").attr("title",t.getNetwork(e.network).name).append(t.getNetwork(e.network).userlist.split("NICKENCODE").join(s).split("NICK").join(r),"<br>").mouseover(function(){n=i.getJSON("Load.php?userinfo&name="+base64.encode(e.nick)+"&chan="+l.current().handlerB64+"&online="+e.network.toString(),function(e){if(e.last){$("#lastSeenCont").text("Last Seen: "+new Date(e.last*1e3).toLocaleString())}else{$("#lastSeenCont").text("Last Seen: never")}$("#lastSeenCont").css("display","block")})}).mouseout(function(){try{n.abort()}catch(e){}$("#lastSeenCont").css("display","none")})}),"<br><br>")},setUsers:function(t){e.users=t},getNames:function(){return $.map(e.users,function(e){return e.nick})}};return{add:e.add,remove:e.remove,draw:e.draw,setUsers:e.setUsers,getNames:e.getNames}}(),p=function(){var e={set:function(e){$("#topic").empty().append(e)}};return{set:e.set}}(),g=function(){var e=false,t="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,n=0,i=false,r=false,a=function(e,t){var n=-1;e.bind("touchstart",function(e){if($(e.target).is("a")){return}i.css("transition","none");e.preventDefault();n=e.originalEvent.touches[0].clientY}).bind("touchmove",function(e){if($(e.target).is("a")){return}e.preventDefault();if(n==-1){return}var i=e.originalEvent.changedTouches[0].clientY;t(i-n);n=i}).bind("touchend touchcancel touchleave",function(e){if($(e.target).is("a")){return}i.css("transition","");e.preventDefault();n=-1})},o=function(){var e=function(e,n,i){var s;$(e).mousedown(function(){s=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).mouseup(function(){try{clearInterval(s)}catch(e){}}).mouseout(function(){try{clearInterval(s)}catch(e){}});if(t){$(e).bind("touchstart",function(){s=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(s)}catch(e){}})}};e("#arrowLeftChan","ChanListCont",-9);e("#arrowRightChan","ChanListCont",9);e("#arrowLeftTopic","topicCont",-9);e("#arrowRightTopic","topicCont",9)},c=function(t){var n=-parseInt(i[0].style.top,10),a=i.height()-r.height(),o=Math.min(a,Math.max(0,n-t));e=false;i.css("top",-o);if(o==a){e=true}if(s.get("scrollBar")){u()}},l=function(){r.bind("DOMMouseScroll mousewheel",function(e){var t=i[0].style.top;c(/Firefox/i.test(navigator.userAgent)?e.originalEvent.detail*-20:e.originalEvent.wheelDelta/2);e.preventDefault();e.stopPropagation();e.cancelBubble=true});if(t){a(r,function(e){c(e)})}},u=function(){if($("#scrollBar").length!==0){if(i.height()<=r.height()){$("#scrollBar").css("top",n)}else{$("#scrollBar").css("top",parseInt(i[0].style.top,10)/(r.height()-i.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-n)+n)}}},f=function(){var e=function(e,t){$(t).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-t.scrollHeight,e+parseInt($("#UserList").css("top"),10))))};$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(t){if(t.preventDefault){t.preventDefault()}t=t.originalEvent;e(/Firefox/i.test(navigator.userAgent)?t.detail*-20:t.wheelDelta/2,this)});if(t){a($("#UserList"),function(t){e(t,this)})}},d=function(){var s=function(t){var s=0;if(c.data("isClicked")){s=parseInt(c.css("top"),10)+(t-c.data("prevY"));i.css("top",-((s-n)/($("body")[0].offsetHeight-c[0].offsetHeight-n))*(i.height()-r.height()));e=false;if(s<n){s=n;i.css("top",0)}if(s>$("body")[0].offsetHeight-c[0].offsetHeight){s=$("body")[0].offsetHeight-c[0].offsetHeight;i.css("top",r.height()-i.height());e=true}c.css("top",s)}c.data("prevY",t)},a=function(){c.data("isClicked",true);$("#scrollArea").css("display","block");i.css("transition","none")},o=function(){c.data("isClicked",false);$("#scrollArea").css("display","none");i.css("transition","")},c=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:false}).appendTo("body").mousemove(function(e){s(e.clientY)}).mousedown(function(){a()}).mouseup(function(){o()}),l;c.css("top",$("body")[0].offsetHeight-c[0].offsetHeight);l=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(e){s(e.clientY)}).mouseup(function(){o()}).mouseout(function(){o()});if(t){l.bind("touchend touchcancel touchleave",function(e){o()}).bind("touchmove",function(e){e.preventDefault();s(e.originalEvent.changedTouches[0].clientY)});c.bind("touchstart",function(e){e.preventDefault();a()}).bind("touchmove",function(e){e.preventDefault();s(e.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(e){e.preventDefault();o(e)})}l.appendTo("body");$("<div>").attr("id","scrollBarLine").appendTo("body");$(window).trigger("resize")},p=function(){var e,n,s=function(){e=setInterval(function(){c(9)},50)},r=function(){n=setInterval(function(){c(-9)},50)},a;a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){i.css("transition","none");s()}).mouseout(function(){i.css("transition","");try{clearInterval(e)}catch(t){}}).mouseup(function(){i.css("transition","");try{clearInterval(e)}catch(t){}}));if(t){a.bind("touchstart",function(){s()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(e)}catch(t){}})}a.appendTo("body");a=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){i.css("transition","none");r()}).mouseout(function(){i.css("transition","");try{clearInterval(n)}catch(e){}}).mouseup(function(){i.css("transition","");try{clearInterval(n)}catch(e){}}));if(t){a.bind("touchstart",function(){r()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(n)}catch(e){}})}a.appendTo("body")};return{down:function(){i.css("top",r.height()-i.height());u();e=true},up:function(){i.css("top",0);u();e=false},slide:function(){if(e){g.down()}},init:function(){i=$("#MessageBox");r=$("#mBoxCont");o();n=$("#header").height()-2;if(s.get("scrollBar")){d()}else{p()}if(s.get("scrollWheel")){l()}f();$(document).add(window).add("body").add("html").scroll(function(e){e.preventDefault()})},reCalcBar:u}}(),h=function(){var e,t=false,n=function(){$("#textDecoForm").css("display","none");t=false};return{init:function(){$("#message").mouseup(function(n){e=window.getSelection();if(e.isCollapsed){return}n.preventDefault();$("#textDecoForm").css({display:"block",left:Math.max(n.pageX-52,0)});t=true});$(document).mousedown(function(e){if(!$(e.target).closest("#textDecoForm").length&&t){n()}});$("#textDecoFormBold").click(function(){e.getRangeAt(0).surroundContents($("<b>")[0])});$("#textDecoFormItalic").click(function(){e.getRangeAt(0).surroundContents($("<i>")[0])});$("#textDecoFormUnderline").click(function(){e.getRangeAt(0).surroundContents($("<u>")[0])})},getMsg:function(){var e=$("#message").html();
e=e.split("<b>").join("").split("</b>").join("");e=e.split("<i>").join("").split("</i>").join("");e=e.split("<u>").join("").split("</u>").join("");e=e.split("&nbsp;").join(" ");e=$("<span>").html(e).text();return e},support:function(){return"contentEditable"in document.documentElement&&s.get("wysiwyg")}}}(),m=function(){var e=function(){if(s.get("smileys")){$("#smileyMenuButton").css("cursor","pointer").click(function(){if($("#smileyselect").css("display")=="block"){$("#smileyselect").css("display","none");$(this).attr("src","smileys/smiley.gif")}else{$("#smileyselect").css("display","block");$(this).attr("src","smileys/tongue.gif")}})}else{$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")}$("#smileyselect").append($.map(parser.getSmileys(),function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!h.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code))}}):""," "]}))},n=90,i=false,o=true,u=function(){$("#toggleButton").click(function(e){e.preventDefault();s.set("enable",!s.get("enable"));document.location.reload()})},d=false,p=function(e){var t=window.innerHeight,s=window.innerWidth,r=$("#header").outerHeight(),a=$("#footer").outerHeight(),c=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(e){$("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10));$("#mBoxCont").css("height",t-a-r-.2*c);$("html,body").height(t);$("#message").css("width",s*(i?1:.91)-12*c)}if(o){var l=s/100*n;if(e){$("#mBoxCont").css("width",l-1.9*c)}$("#scrollBarLine").css("left",l-1.4*c);if(e){$("#scrollBarLine").css("height",t-r-.1*c)}$("#scrollBar").css("left",l-1.5*c);g.reCalcBar()}g.down()},w=function(){var e=navigator.userAgent,t=e.indexOf("Mozilla/5.0")>-1&&e.indexOf("Android ")>-1&&e.indexOf("AppleWebKit")>-1&&!(e.indexOf("Chrome")>-1),a=e.match(/(iPod|iPhone|iPad)/i)&&e.match(/AppleWebKit/i),c=e.match(/AppleWebKit/i)&&e.match(/Android/i);$("body").css("font-size",s.get("fontSize").toString(10)+"pt");i=s.get("hideUserlist");o=s.get("scrollBar");m.changeLinks();if(!h.support()){$("#message").replaceWith($("<input>").attr({type:"text",id:"message",accesskey:"i",maxlen:"256",autocomplete:"off"}))}else{$("#message").keydown(function(e){if(e.keyCode==13){e.preventDefault();$("#sendMessage").trigger("submit")}});h.init()}if(i){n=99;$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head")}g.init();f.init();r.init();y.init();u();if(a){p(true)}$(window).resize(function(){p(!a)}).trigger("resize").blur(function(){d=true}).focus(function(){d=false});$("#aboutButton").click(function(e){e.preventDefault();$("#about").toggle()})};return{load:function(){a.start();t.fetch(function(){if(s.get("enable")){w();e();v.init();b.init();l.init();c.init();l.join(s.get("curChan"))}else{u();$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(e){e.preventDefault();s.set("enable",true);window.location.reload()}));$("#footer,#header").css("display","none");a.stop()}})},isBlurred:function(){return d},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+t.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+t.net())}})}}}(),w=function(){var e={text:"",started:false,start:function(){if(!s.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(t){}}},500);e.started=true}},set:function(t){e.text=t;if(!e.started){e.start()}}};return{set:e.set}}(),k=function(){var t={parse:function(t){var n=t.split(" ")[0].toLowerCase(),i=t.substr(n.length+1).toLowerCase().trim();switch(n){case"j":case"join":l.open(i);return true;case"q":case"query":l.openPm(i,"",true);return true;case"win":case"w":case"window":l.join(parseInt(i,10));return true;case"p":case"part":l.part(i!==""?i:undefined);return true;case"help":v.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');v.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){v.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}};return{parse:t.parse}}(),b=function(){var e={messages:[],counter:0,current:"",setMsg:function(e){if(!h.support()){$("#message").val(e)}else{$("#message").html(e)}},getMsg:function(){if(!h.support()){return $("#message").val()}return $("#message").html()},init:function(){$("#message").keydown(function(t){if(t.keyCode==38||t.keyCode==40){t.preventDefault();if(e.counter==e.messages.length){e.current=e.getMsg()}if(e.messages.length!==0){if(t.keyCode==38){if(e.counter!==0){e.counter--}e.setMsg(e.messages[e.counter])}else{if(e.counter!=e.messages.length){e.counter++}if(e.counter==e.messages.length){e.setMsg(e.current)}else{e.setMsg(e.messages[e.counter])}}}}})},add:function(t){e.messages.push(t);if(e.messages.length>20){e.messages.shift()}e.counter=e.messages.length;n.set("oldMessages-"+l.current().handlerB64,e.messages)},read:function(){e.messages=n.get("oldMessages-"+l.current().handlerB64);if(!e.messages){e.messages=[]}console.log(e.messages);e.counter=e.messages.length}};return{init:e.init,add:e.add,read:e.read}}(),v=function(){var e={sending:false,sendMessage:function(t){if(t[0]=="/"&&k.parse(t.substr(1))){if(!h.support()){$("#message").val("")}else{$("#message").html("")}}else{if(!e.sending){e.sending=true;c.send(t,function(){if(!h.support()){$("#message").val("")}else{$("#message").html("")}e.sending=false})}}},internal:function(e){parser.addLine({curLine:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:l.current().handler})},init:function(){$("#sendMessage").submit(function(n){n.preventDefault();if(t.loggedIn()){var i="";if(!h.support()){i=$("#message").val();b.add(i)}else{b.add($("#message").html());i=h.getMsg()}console.log(i);i=parser.parseTextDecorations(i);if(!$("#message").attr("disabled")&&i!==""){e.sendMessage(i);$("#message").focus()}}});if(!t.loggedIn()){$("#message").val("You need to login if you want to chat!")}}};return{internal:e.internal,init:e.init}}(),y=function(){var e={isOpen:false,year:0,month:0,day:0,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],getLogUrlParam:function(){return base64.encode(e.year.toString(10)+"-"+e.month.toString(10)+"-"+e.day.toString(10))},updateInputVal:function(){$("#logDate").val(e.months[e.month-1]+" "+e.day.toString(10)+" "+e.year.toString(10))},displayDatePicker:function(){var t=new Date(e.year,e.month,e.day),n=["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],i=new Date(e.year,e.month,0).getDate(),s=new Date(e.year,e.month-1,1).getDay(),r=0;if(e.day>i){e.day=i}e.updateInputVal();$("#logDatePicker").empty().append($("<a>").text("<").click(function(t){t.preventDefault();t.stopPropagation();e.year--;e.displayDatePicker()})," ",e.year.toString(10)," ",$("<a>").text(">").click(function(t){t.preventDefault();t.stopPropagation();e.year++;e.displayDatePicker()}),"<br>",$("<a>").text("<").click(function(t){t.preventDefault();t.stopPropagation();e.month--;if(e.month<1){e.month=12;e.year--}e.displayDatePicker()})," ",e.months[e.month-1]," ",$("<a>").text(">").click(function(t){t.preventDefault();t.stopPropagation();e.month++;if(e.month>12){e.month=1;e.year++}e.displayDatePicker()}),"<br>",$("<table>").append($("<tr>").append($.map(n,function(e){return $("<th>").text(e)})),$.map([0,1,2,3,4,5],function(){if(r>=i){return}return $("<tr>").append($.map([0,1,2,3,4,5,6],function(t){if(r==0&&t!=s||r>=i){return $("<td>").text(" ")}r++;return $("<td>").text(r).addClass("logDatePickerDay").addClass(r==e.day?"current":"").data("day",r).click(function(){$(".logDatePickerDay.current").removeClass("current");e.day=$(this).addClass("current").data("day");e.updateInputVal()})}))})));$("#logDatePicker").css("display","block")},open:function(){var t=new Date;a.start();c.stop();$("#message").attr("disabled","true");d.setUsers([]);d.draw();$("#chattingHeader").css("display","none");$("#logDatePicker").css("display","none");$("#logsHeader").css("display","block");$("#logChanIndicator").text(l.current().name);e.year=parseInt(t.getFullYear(),10);e.month=parseInt(t.getMonth()+1,10);e.day=parseInt(t.getDate(),10);e.updateInputVal();e.isOpen=true;e.fetch()},close:function(){var t;$("#chattingHeader").css("display","block");$("#logsHeader").css("display","none");e.isOpen=false;l.current().reload()},fetchPart:function(t){i.getJSON("Log.php?day="+e.getLogUrlParam()+"&offset="+parseInt(t,10)+"&channel="+l.current().handlerB64,function(n){if(!n.banned){if(n.lines.length>=1e3){e.fetchPart(t+1e3)}$.each(n.lines,function(e,t){parser.addLine(t,true)});g.up();if(n.lines.length<1e3){a.stop()}}else{v.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</banned>')}})},fetch:function(){a.start();$("#MessageBox").empty();e.fetchPart(0)},toggle:function(){if(e.isOpen){e.close()}else{e.open()}},init:function(){$("#logCloseButton").click(function(t){t.preventDefault();e.close()});$("#logGoButton").click(function(t){t.preventDefault();e.fetch()});$("#logsButton").click(function(t){t.preventDefault();e.toggle()});$("#logDate").click(function(t){t.preventDefault();$(this).focusout();if($("#logDatePicker").css("display")!="block"){e.displayDatePicker();t.stopPropagation()}});$(document).click(function(t){if(e.isOpen){var n=$("#logDatePicker");if(!n.is(t.target)&&n.has(t.target).length===0){n.css("display","none")}}})}};return{init:e.init}}();parser=function(){var e=[],n=200,r=0,a=[],u={},f=function(e,n,r){if(r===undefined){r=-1}e=e=="\x00"?"":e;var a=encodeURIComponent(e);e=$("<span>").text(e).html();var o=[19,20,22,24,25,26,27,28,29],c=0,l=0,f=e,d=t.getNetwork(n),p=true;switch(s.get("colordNames")){case"1":while(e[l]){c+=e.charCodeAt(l++)}f=$("<span>").append($("<span>").addClass("uName-"+o[c%=9].toString()).html(e)).html();break;case"2":if(d!==undefined&&d.checkLogin!==undefined){p=false;if(u[n.toString()+":"+r.toString()]===undefined){i.getJSON(d.checkLogin+"?c="+r.toString(10)+"&n="+a,function(e){u[n.toString()+":"+r.toString()]=e.nick},false,false)}f=u[n.toString()+":"+r.toString()]}else{f=e}break;default:f=e;break}if(d!==undefined&&p){f=d.normal.split("NICKENCODE").join(a).split("NICK").join(f).split("USERID").join(r.toString(10))}if(d!==undefined){return'<span title="'+d.name+'">'+f+"</span>"}return'<span title="Unknown Network">'+f+"</span>"},h=function(t){var n="";if(!t){return""}$.each(e,function(e,i){t=t.replace(RegExp(i.regex,"g"),i.replace.split("ADDSTUFF").join(n).split("PIC").join(i.pic).split("ALT").join(i.alt))});return t},k=function(e){if(!e||e===null||e===undefined){return""}var t=["ourl.ca","omnimaga.org","www.omnimaga.org"];var n='[^\\s"]';e=e.replace(RegExp("(|)","g"),"");$.map(t,function(t){t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");e=e.replace(RegExp("(^|\\s)(((f|ht)(tp|tps)://)"+t+n+"*)","g"),"$1$2").replace(RegExp("(^|\\s)("+t+n+"*)","g"),"$1$2")});return e.replace(RegExp("(^|[^a-zA-Z0-9_]|\\d{1,2}(|,\\d{1,2}))(((f|ht)(tp|tps)://)"+n+"+)","g"),'$1<a target="_blank" href="$3">$3</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+n+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+n+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+n+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},b=function(e){var t=[],n,i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},s,r;if(!e){return""}t=e.split(RegExp("([])"));e="<span>";for(s=0;s<t.length;s++){r=true;switch(t[s]){case"":n=t[s+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(n==t[s+1]){n=t[s+1].replace(/^([0-9]{1,2}).*/,"$1:");if(n!=t[s+1]){i.fg=n.split(":")[0];t[s+1]=t[s+1].substr(n.length-1)}else{i.fg="-1";i.bg="-1"}}else{i.fg=n.split(":")[0];i.bg=n.split(":")[1];if(n==t[s+1]){t[s+1]=""}else{t[s+1]=t[s+1].substr(n.length)}}break;case"":i.bold=!i.bold;break;case"":i.italic=!i.italic;break;case"":n=i.fg;i.fg=i.bg;i.bg=n;if(i.fg=="-1"){i.fg="0"}if(i.bg=="-1"){i.bg="1"}break;case"":i.underline=!i.underline;break;case"":i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:r=false}if(r){e+="</span>"+'<span class="fg-'+i.fg+" bg-"+i.bg+'" style="'+(i.bold?"font-weight:bold;":"")+(i.underline?"text-decoration:underline;":"")+(i.italic?"font-style:italic;":"")+'">'}else{e+=t[s]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},v=function(e){if(e.toLowerCase().indexOf(t.nick().toLowerCase().substr(0,s.get("charsHigh")))>=0&&t.nick()!=""){var n="";if(!s.get("highRed")){n+="background:none;padding:none;border:none;"}if(s.get("highBold")){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"}return e},y=function(e,t){if(t==undefined||!t){t=false}e=e=="\x00"?"":e;e=$("<span>").text(e).html();e=k(e);if(s.get("smileys")&&t===false){e=h(e)}e=b(e);return e},C=false;return{addLine:function(e,i){if(i===undefined){i=false}c.setCurLine(e.curLine);if(e.name==null||a.indexOf(e.name.toLowerCase())>-1||e.chan.toString().toLowerCase()!=l.current().handler.toLowerCase()&&e.name2!==t.getPmIdent()){return true}var u=$("#MessageBox"),h=f(e.name,e.network,e.uid),k=y(e.message),b="*",x=k,S="";if(e.network==-1){return true}if(["message","action","pm","pmaction"].indexOf(e.type)>=0&&e.name.toLowerCase()!="*"){x=k=v(k,e);if(m.isBlurred()){o.make("("+l.current().name+") <"+e.name+"> "+e.message,e.chan)}}switch(e.type){case"reload":if(!i){l.current().reload();return false}return true;case"reload_userlist":if(!i){l.current().reloadUserlist()}return true;case"relog":if(!i){t.fetch(undefined,true)}return true;case"refresh":if(!i){location.reload(true)}return true;break;case"join":x=[h," has joined "+l.current().name];if(!i){d.add({nick:e.name,network:e.network})}if(t.getNetwork(e.network).type==1&&!s.get("oircJoinPart")){return true}break;case"part":x=[h," has left "+l.current().name+" (",k,")"];if(!i){d.remove({nick:e.name,network:e.network})}if(t.getNetwork(e.network).type==1&&!s.get("oircJoinPart")){return true}break;case"quit":x=[h," has quit IRC (",k,")"];if(!i){d.remove({nick:e.name,network:e.network})}if(t.getNetwork(e.network).type==1&&!s.get("oircJoinPart")){return true}break;case"kick":x=[h," has kicked ",f(e.name2,e.network)," from "+l.current().name+" (",k,")"];if(!i){d.remove({nick:e.name2,network:e.network})}break;case"message":b=h;break;case"action":x=[h," ",k];break;case"mode":if(typeof k=="string"){k=e.message.split(" ");$.each(k,function(t,n){var i=$("<span>").html(n).text();if(i.indexOf("+")==-1&&i.indexOf("-")==-1){k[t]=f(n,e.network)}});k=k.join(" ")}x=[h," set "+l.current().name+" mode ",k];break;case"nick":x=[h," has changed nicks to ",f(e.name2,e.network)];if(!i){d.add({nick:e.name2,network:e.network});d.remove({nick:e.name,network:e.network})}break;case"topic":p.set(y(e.message,true));x=[h," has changed the topic to ",y(e.message,true)];break;case"pm":if(e.chan==l.current().handler){b=h;e.type="message"}else{if(!i){if(e.name.toLowerCase()==t.nick().toLowerCase()){l.openPm(e.chan,t.getWholePmIdent(e.uid,e.network));return true}else{b=["(PM)",h];l.openPm(e.name,t.getWholePmIdent(e.uid,e.network));o.make("(PM) <"+e.name+"> "+e.message,e.chan)}}else{return true}}break;case"pmaction":if(e.chan==l.current().handler){x=[h," ",k];e.type="action"}else{if(!i){if(e.name.toLowerCase()==t.nick().toLowerCase()){l.openPm(e.chan,t.getWholePmIdent(e.uid,e.network));return true}else{x=["(PM)",h," ",k];l.openPm(e.name,t.getWholePmIdent(e.uid,e.network));o.make("* (PM)"+e.name+" "+e.message,e.chan);e.type="pm"}}else{return true}}break;case"highlight":if(e.name.toLowerCase()!="*"){o.make("("+e.chan+") <"+e.name+"> "+e.message,e.chan)}return true;case"internal":x=e.message;break;case"server":break;default:return true}if(u.find("tr").length>n&&logMode!==true){u.find("tr:first").remove()}if(b=="*"){S="* "}else{S="<"+e.name+"> "}if(s.get("times")){S="["+new Date(e.time*1e3).toLocaleTimeString()+"] "+S}S+=$("<span>").append(x).text();w.set(S);var D=$("<tr>").addClass(s.get("altLines")&&(C=!C)?"lineHigh":"").addClass(new Date(r).getDay()!=new Date(e.time*1e3).getDay()?"seperator":"").append(s.get("times")?$("<td>").addClass("irc-date").append("["+new Date(e.time*1e3).toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(b),$("<td>").addClass(e.type).append(x));D.find("img").load(function(e){g.slide()});u.append(D);g.slide();r=e.time*1e3;return true},setSmileys:function(t){e=t},getSmileys:function(){return e},setIgnoreList:function(e){a=e},parseTextDecorations:function(e){if(e!==""&&s.get("textDeco")){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e}}}();$(function(){i.init();switch($("body").attr("page")){case"options":t.fetch(function(){m.changeLinks();$("#options").height($(window).height()-75);$(window).resize(function(){if(!(navigator.userAgent.match(/(iPod|iPhone|iPad)/i)&&navigator.userAgent.match(/AppleWebKit/i))){$("#options").height($(window).height()-75)}});$("body").css("font-size",s.get("fontSize").toString(10)+"pt");$("#options").append(s.getHTML())});break;case"admin":$.getScript("admin.min.js");break;default:m.load()}});return{OMNOMIRCSERVER:e,page:{changeLinks:function(){m.changeLinks()}},settings:{fetch:function(e){t.fetch(e)}},indicator:{start:a.start,stop:a.stop},network:{getJSON:function(e,t,n,s){i.getJSON(e,t,n,s)},post:function(e,t,n,s,r){i.post(e,t,n,s,r)}},options:{getFullOptionsString:function(){return s.getFullOptionsString()}}}}();