"use strict";var OmnomIRC=function(){var e="https://omnomirc.omnimaga.org",n=false,t=function(e,n){if(n===undefined){n=false}l.setCurLine(e.curline);if(e.name===null||e.network==-1){return}if(y.onmessageraw!==false){y.onmessageraw(e,n);return}k.addLine(e,n)},s=function(){var e={hostname:"",nick:"",signature:"",numHigh:4,uid:-1,checkLoginUrl:"",net:"",networks:{},pmIdent:false,guestLevel:0,isGuest:true,identGuest:function(n,t,s,a){if(a===undefined){a=s;s=false}console.log("trying login");r.getJSON("misc.php?identName="+base64.encode(n)+"&nick="+base64.encode(n)+"&signature="+base64.encode(t)+"&id=-1&network="+e.getNetwork(),function(t){if(t.success){if(s){i.set("guestName",n);i.set("guestSig",t.signature)}else{i.set("guestName","");i.set("guestSig","")}e.setIdent(n,t.signature,-1);l.identify()}if(a!==undefined){a(t)}},true,false)},logout:function(){i.set("guestName","");i.set("guestSig","");e.setIdent("","",-1);l.identify()},login:function(n,t,s){if(s===undefined){s=-1}e.setIdent(n,t,s);l.identify()},fetch:function(n,t){if(t===undefined){t=false}if(t&&e.loggedIn()&&e.isGuest){console.log("i am silly");e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}});return}r.getJSON("config.php?js"+(document.URL.split("network=")[1]!==undefined?"&network="+document.URL.split("network=")[1].split("&")[0].split("#")[0]:"")+(t?"&clonly":""),function(s){var o;if(!t){e.hostname=s.hostname;c.setChans(s.channels);k.setSmileys(s.smileys);y.onsmileychange(s.smileys);k.setSpLinks(s.spLinks);e.guestLevel=s.guests;e.networks={};$.each(s.networks,function(n,t){e.networks[t.id]=t});e.net=s.network;i.setPrefix(e.net);a.setDefaults(s.defaults);a.setExtraChanMsg(s.extraChanMsg);l.setData(s.websockets.use,s.websockets.host,s.websockets.port,s.websockets.ssl)}e.checkLoginUrl=s.checkLoginUrl;if(e.loggedIn()&&e.isGuest){e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}})}else{r.getJSON(e.checkLoginUrl+"&network="+e.net.toString()+"&jsoncallback=?",function(t){e.nick=t.nick;e.signature=t.signature;e.uid=t.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=t.signature==="";if(n!==undefined){n()}},true,false)}},true,false)},setIdent:function(n,t,s){e.nick=n;e.signature=t;e.uid=s},getUrlParams:function(){return"nick="+base64.encode(e.nick)+"&signature="+base64.encode(e.signature)+"&time="+(+new Date).toString()+"&id="+e.uid+"&network="+e.net+"&noLoginErrors"},getNetwork:function(n){if(e.networks[n]!==undefined){return e.networks[n]}return{id:-1,normal:"NICK",userlist:"NICK",name:"Invalid network",type:-1}},getIdentParams:function(){return{nick:e.nick,signature:e.signature,time:(+new Date).toString(),id:e.uid,network:e.net}},loggedIn:function(){return e.signature!==""},guestLevel:function(){return e.guestLevel},getWholePmIdent:function(n,t){var s="["+t.toString()+","+n.toString()+"]";if(t<e.net){return s+e.pmIdent}else if(e.net<t){return e.pmIdent+s}else if(n<e.uid){return s+e.pmIdent}else{return e.pmIdent+s}}};return{identGuest:e.identGuest,fetch:e.fetch,getUrlParams:e.getUrlParams,getIdentParams:e.getIdentParams,getNetwork:e.getNetwork,nick:function(){return e.nick},net:function(){return e.net},loggedIn:e.loggedIn,guestLevel:e.guestLevel,getPmIdent:function(){return e.pmIdent},isGuest:function(){return e.isGuest},getWholePmIdent:e.getWholePmIdent,logout:e.logout,login:e.login}}(),i=function(){var e={prefix:document.URL.split("network=")[1]!==undefined?document.URL.split("network=")[1].split("&")[0].split("#")[0]:"",setPrefix:function(n){e.prefix=n},getCookie:function(e){var n,t,s,i=document.cookie.split(";");for(n=0;n<i.length;n++){t=i[n].substr(0,i[n].indexOf("="));s=i[n].substr(i[n].indexOf("=")+1);t=t.replace(/^\s+|\s+$/g,"");if(t==e){return unescape(s)}}},setCookie:function(e,n,t){var s=new Date,i=escape(n);s.setDate(s.getDate()+t);i+=t===null?"":"; expires="+s.toUTCString();document.cookie=e+"="+i},haveSupport:null,support:function(){if(e.haveSupport===null){try{localStorage.setItem("test",1);localStorage.removeItem("test");e.haveSupport=true}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){var t;n=e.prefix+n;if(e.support()){t=localStorage.getItem(n)}else{t=e.getCookie(n)}try{return JSON.parse(t)}catch(s){return undefined}},set:function(n,t){n=e.prefix+n;t=JSON.stringify(t);if(e.support()){localStorage.setItem(n,t)}else{e.setCookie(n,t)}}};return{setPrefix:e.setPrefix,get:e.get,set:e.set}}(),r=function(){var e={removeSig:function(e){try{var n=e.split("signature="),t=n[1].split("&");t[0]="---";n[1]=t.join("&");return n.join("signature=")}catch(s){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},addError:function(n,t){n=e.removeSig(n);y.onerror(n,t)},addWarning:function(n,t){n=e.removeSig(n);y.onwarning(n,t)},checkCallback:function(n,t,i,r){if(n.relog!=2){if(n.errors!==undefined){$.map(n.errors,function(n){if(n.type!==undefined){e.addError(r,n)}else{e.addError(r,{type:"misc",message:n})}})}if(n.warnings!==undefined){$.map(n.warnings,function(n){if(n.type!==undefined){e.addWarning(r,n)}else{e.addWarning(r,{type:"misc",message:n})}})}}if(n.relog!==undefined&&n.relog!=0){if(n.relog==1){s.fetch(undefined,true);t(n)}else if(n.relog==2){s.fetch(function(){i()},true)}else{t(n)}}else{if(n.relog!==undefined){e.didRelog=false}t(n)}},getJSON:function(n,t,i,r){if(i==undefined){i=true}if(r==undefined){r=true}if(n.indexOf("?")==-1&&r){n+="?"}var a=n+(r?"&"+s.getUrlParams():"");return $.ajax({url:a,dataType:"json",async:i}).done(function(s){e.checkCallback(s,t,function(){e.getJSON(n,t,i,r)},a)})},post:function(n,t,i,r,a){if(r==undefined){r=true}if(a==undefined){a=true}if(n.indexOf("?")==-1&&a){n+="?"}var o=n+(a?"&"+s.getUrlParams():"");return $.ajax({type:"POST",url:o,async:r,data:t}).done(function(s){e.checkCallback(s,i,function(){e.post(n,t,i,r,a)},o)})}};return{getJSON:e.getJSON,post:e.post}}(),a=function(){var e={extraChanMsg:"",allOptions:{highBold:{disp:"Highlight Bold","default":true},highRed:{disp:"Highlight Red","default":true},colordNames:{disp:"Colored Names","default":0,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(n,t){return $("<option>").attr(e.get("colordNames")==t?"selected":"false","selected").val(t).text(n)})))}},curChan:{hidden:true,"default":0},extraChans:{disp:"Show extra Channels","default":false,before:function(){if(e.extraChanMsg!==""){alert(e.extraChanMsg)}return true}},ding:{disp:"Ding on Highlight","default":false},smileys:{disp:"Show Smileys","default":true},charsHigh:{disp:"Number chars for Highlighting","default":4,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("charsHigh",this.value)}).append($.map([1,2,3,4,5,6,7,8,9,10],function(n){return $("<option>").attr(e.get("charsHigh")==n?"selected":"false","selected").val(n).text(n)})))}},oircJoinPart:{disp:"Show OmnomIRC join/part messages","default":false},textDeco:{disp:"Enable simple text decorations","default":false},statusBar:{disp:"Show Updates in Browser Status Bar","default":true},browserNotifications:{disp:"Browser Notifications","default":false,before:function(){w.request();return false}}},set:function(n,t){if(e.allOptions[n]===undefined){return}e.allOptions[n].value=t;var s=i.get("options")||{};s[n]=t;i.set("options",s)},get:function(n){if(e.allOptions[n]!==undefined){return e.allOptions[n].value}},setExtraChanMsg:function(n){e.extraChanMsg=n},setDefaults:function(n){var t=i.get("options");$.each(e.allOptions,function(s,i){var r=i.default;if(t&&t[s]!==undefined){r=t[s]}else if(n&&n[s]!==undefined){r=n[s]}e.allOptions[s].value=r})},getAll:function(n){if(n){return e.allOptions}var t={};$.each(e.allOptions,function(e,n){if(n.hidden===undefined||!n.hidden){t[e]=n.value}});return t},setAll:function(n){e.allOptions=n}};return{set:e.set,get:e.get,setDefaults:e.setDefaults,setExtraChanMsg:e.setExtraChanMsg,getAll:e.getAll,setAll:e.setAll}}(),o=function(){var e={id:Math.random().toString(36)+(new Date).getTime().toString(),update:function(){i.set("browserTab",e.id);i.set("newInstant",false)},init:function(){i.set("browserTab",e.id);$(window).focus(function(){e.update()}).unload(function(){e.kill()})},current:function(){if(i.get("newInstant")){e.update()}return e.id==i.get("browserTab")},kill:function(){i.set("newInstant",true);$(window).off("focus").off("unload")}};return{init:e.init,current:e.current,kill:e.kill}}(),l=function(){var e={ws:{socket:false,connected:false,use:true,sendBuffer:[],allowLines:false,enabled:false,host:"",port:0,ssl:true,tryFallback:true,didRelog:false,fallback:function(){console.log("trying fallback...");if(e.ws.tryFallback){try{e.ws.tryFallback=false;e.ws.socket.close()}catch(n){}r.getJSON("misc.php?getcurline&noLoginErrors",function(n){e.setCurLine(n.curline);e.ws.use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()})}},identify:function(){e.ws.send($.extend({action:"ident"},s.getIdentParams()));e.ws.send({action:"charsHigh",chars:a.get("charsHigh")})},init:function(){if(!("WebSocket"in window)||!e.ws.enabled){e.ws.use=false;return false}try{var n=window.location.pathname.split("/");n.pop();if(n.length>1&&n[n.length-1]===""){n.pop()}n.push("ws");n.push(s.net());e.ws.socket=new PooledWebSocket((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"))}catch(i){console.log(e.ws.socket);console.log((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"));console.log(i);e.ws.fallback()}e.ws.socket.onopen=function(n){e.ws.connected=true;for(var t=0;t<e.ws.sendBuffer.length;t++){e.ws.send(e.ws.sendBuffer[t])}e.ws.sendBuffer=[]};e.ws.socket.onmessage=function(n){try{var i=JSON.parse(n.data);console.log(i);if(e.ws.allowLines&&i.line!==undefined){if(t(i.line)){e.ws.tryFallback=false;delete e.ws.socket}}if(i.relog!==undefined&&i.relog!=0&&i.relog<3){if(!e.ws.didRelog){e.ws.didRelog=true;s.fetch(function(){if(s.loggedIn()){e.ws.identify();e.ws.didRelog=false}},true)}}}catch(n){}};e.ws.socket.onclose=function(n){console.log("CLOOOOOOOOOSE");console.log(n);e.ws.use=false;e.ws.fallback()};e.ws.socket.onerror=function(n){console.log("ERRRORRRR");console.log(n);delete e.ws.socket;e.ws.use=false;e.ws.fallback()};e.ws.identify();$(window).on("beforeunload",function(){e.partChan(c.current().handler);delete e.ws.socket});return true},send:function(n){if(e.ws.connected){e.ws.socket.send(JSON.stringify(n))}else{e.ws.sendBuffer.push(n)}}},old:{inRequest:false,handler:false,lastSuccess:(new Date).getTime(),fnCallback:undefined,chan:"",sendRequest:function(){if(!e.old.chan){return}e.old.handler=r.getJSON("Update.php?high="+a.get("charsHigh").toString()+"&channel="+e.old.chan+"&lineNum="+e.curLine.toString(),function(n){e.old.handler=false;e.old.lastSuccess=(new Date).getTime();if(n.lines!==undefined){$.map(n.lines,function(e){t(e)})}if(n.errors!=undefined&&n.errors.length>=1){return}if(n.banned!==true){e.old.setTimer()}}).fail(function(){e.old.handler=false;if(e.fnCallback!=undefined){e.fnCallback();e.fnCallback=undefined;return}if((new Date).getTime()>=e.old.lastSuccess+3e5){g.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!e.old.inRequest){e.old.lastSuccess=(new Date).getTime()}else{e.old.setTimer()}})},setTimer:function(){if(e.old.inRequest&&c.current().loaded&&e.old.handler===false){setTimeout(function(){e.old.sendRequest()},v.isBlurred()?2500:200)}else{e.old.stop()}},start:function(){if(!e.old.inRequest){e.old.inRequest=true;e.old.setTimer()}},stop:function(n){if(e.old.inRequest){e.old.inRequest=false;if(e.old.handler){e.fnCallback=n;e.old.handler.abort()}else if(n!==undefined){n()}}else if(n!==undefined){n()}},send:function(e,n,t){r.getJSON("message.php?message="+base64.encode(e)+"&channel="+n,function(e){if(t!==undefined){t(e)}})}},curLine:0,joinChan:function(n){if(e.ws.use){e.ws.send({action:"joinchan",chan:n})}if(parseInt(n,10)!=n){n=base64.encode(n)}e.old.chan=n},partChan:function(n){if(e.ws.use){e.ws.send({action:"partchan",chan:n})}},stop:function(n){if(e.ws.use){e.ws.allowLines=false;n()}else{e.old.stop(n)}},kill:function(){if(e.ws.use){e.ws.socket.onclose=function(){};e.ws.socket.close()}else{e.old.stop()}},start:function(){if(e.ws.use){e.ws.allowLines=true}else{e.old.start()}},setCurLine:function(n){if(n>e.curLine){e.curLine=n}},send:function(n,t,s){if(e.ws.use){e.ws.send({action:"message",channel:t,message:n});if(s!==undefined){s()}}else{if(parseInt(t,10)!=t){t=base64.encode(t)}e.old.send(n,t,s)}},setData:function(n,t,s,i){e.ws.enabled=n;e.ws.host=t;e.ws.port=s;e.ws.ssl=i},init:function(){if(e.ws.enabled){e.ws.init()}else{e.ws.use=false;e.old.lastSuccess=(new Date).getTime()}},identify:function(){if(e.ws.enabled){e.ws.identify()}}};return{joinChan:e.joinChan,partChan:e.partChan,start:e.start,stop:e.stop,kill:e.kill,setCurLine:e.setCurLine,send:e.send,setData:e.setData,init:e.init,identify:e.identify}}(),c=function(){var e=function(e){var s=n.chans[e]!==undefined,i={i:e,name:s?n.chans[e].chan.toLowerCase():"",handler:s?n.getHandler(e):-1,handlerB64:s?n.getHandler(e,true):-1,loaded:false,load:function(n){if(n.lines===undefined){if(n.message){g.internal(n.message)}else{g.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}return false}a.set("curChan",e);if(n.banned){g.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');return false}f.setUsers(n.users);$.each(n.lines,function(e,n){t(n,true)});i.loaded=true;return true},unload:function(){if(i.loaded){l.partChan(i.handler)}},part:function(){n.part(n.i)},reloadUserlist:function(){if(!s){return}r.getJSON("Load.php?userlist&channel="+i.handlerB64,function(e){if(!e.banned){if(e.users){f.setUsers(e.users)}}else{g.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})},reload:function(){y.onchanneljoin(i.name)},setI:function(e){i.i=e},is:function(e){return e==i.i}};return{name:i.name,handler:i.handler,handlerB64:i.handlerB64,load:i.load,part:i.part,reload:i.reload,unload:i.unload,loaded:function(){return i.loaded},setI:i.setI,is:i.is,reloadUserlist:i.reloadUserlist}},n={current:false,chans:[],save:function(){i.set("channels",n.chans)},loadSettings:function(){try{var e=i.get("channels"),t=$.map(n.chans,function(e){if(e.ex&&a.get("extraChans")||!e.ex){return e}return undefined}),s=[];if(e!==null&&e!=[]){n.chans=$.merge($.map(e,function(e){if(e.id!=-1&&e.id.toString().substr(0,1)!="*"){var t=false;$.each(n.chans,function(n,i){if(i.id==e.id){s.push(e);t=true;e.chan=i.chan;return false}});if(!t){return undefined}}return e}),$.map(t,function(e){var n=false;$.each(s,function(t,s){if(s.id==e.id){n=true;e.chan=s.chan;return false}});if(n){return undefined}return e}));save()}}catch(r){}y.onchannelchange(n.chans)},init:function(){n.current=e(-1);n.loadSettings()},addChan:function(e,t){var s=true;if(t===undefined){t=-1}e=e.toLowerCase();$.each(n.chans,function(n,t){if(t.chan==e){s=n}});if(s===true){if(e[0]=="#"){g.internal('<span style="color:#C73232;">Join Error: Cannot join new channels starting with #.</span>');return-1}n.chans.push({chan:e,high:false,ex:false,id:t,order:-1});n.save();y.onchannelchange(n.chans);return n.chans.length-1}return s},getHandler:function(e,t){if(n.chans[e].id!=-1){if(typeof n.chans[e].id!="number"&&t){return base64.encode(n.chans[e].id)}return n.chans[e].id.toString()}if(t){return base64.encode(n.chans[e].chan)}return n.chans[e].chan},requestHandler:false,load:function(t,s){if(s===undefined){s=function(){}}if(n.chans[t]===undefined){s(false,{});return}l.stop(function(){if(n.requestHandler!==false){n.requestHandler.abort()}n.requestHandler=r.getJSON("Load.php?count=125&channel="+n.getHandler(t,true),function(i){a.set("curChan",t);n.current=e(t);if(n.current.load(i)){n.chans[t].high=false;n.save();l.joinChan(n.getHandler(t));l.start();h.load();p.read();s(true,i);return}s(false,{})})})},join:function(e){var t=true;e=e.trim();if(!e){return-1}if(e[0]!="@"&&e[0]!="#"){e="@"+e}return n.addChan(e)},joinPm:function(e,t,s){if(s===undefined){s=function(){}}var i=true,a=function(t,i){t=t.trim();if(t.substr(0,1)!="*"){t="*"+e}i=i.trim();if(i.substr(0,1)!="*"){i="*"+i}s(n.addChan(t,i))};if(t==""){if(e.substr(0,1)=="@"||e.substr(0,1)=="#"){g.internal('<span style="color:#C73232;">Query Error: Cannot query a channel. Use /join instead.</span>');s(-1);return}r.getJSON("misc.php?openpm="+base64.encode(e),function(e){if(e.channick){a(e.channick,e.chanid)}else{g.internal('<span style="color:#C73232;">Query Error: User not found.</span>');s(-1)}})}else{a(e,t)}},part:function(e){if(parseInt(e,10)==e){e=parseInt(e,10)}if(typeof e!="number"){if(e&&e[0]!="@"&&e[0]!="#"&&e[0]!="*"){e="@"+e}$.each(n.chans,function(n,t){if(t.chan==e){e=n;return false}})}if(typeof e!="number"||n.chans[e]===undefined){g.internal('<span style="color:#C73232;"> Part Error: can\'t part '+e+". (You are not in it.)</span>");return false}if(n.chans[e].chan[0]=="#"){g.internal('<span style="color:#C73232;"> Part Error: can\'t part '+n.chans[e].chan+". (IRC channel.)</span>");return false}var t=n.chans[e].chanId,s=false;if(n.current.is(e)){s=true}if(t==-1){t=n.chans[e]}l.partChan(n.getHandler(e));n.chans.splice(e,1);n.save();y.onchannelchange(n.chans);if(s){y.onchanneljoin(n.chans[e-1].chan)}return true},getList:function(){return n.chans},setChans:function(e){n.chans=e;if(n.current){n.save();y.onchannelchange(n.chans)}},getNames:function(){return $.map(n.chans,function(e){return e.chan})},highlight:function(e){$.each(n.chans,function(t,s){if(e==s.id||s.chan.toLowerCase()==e.toString().toLowerCase()){n.chans[t].high=true;return false}});n.save();y.onchannelchange(n.chans)}};return{init:n.init,load:n.load,join:n.join,joinPm:n.joinPm,part:n.part,getList:n.getList,getHandler:n.getHandler,current:function(){return n.current},setChans:n.setChans,getNames:n.getNames,highlight:n.highlight}}(),f=function(){var e={users:[],draw:function(){e.users.sort(function(e,n){var t=e.nick.toLowerCase(),s=n.nick.toLowerCase();return t==s?e==n?0:e<n?-1:1:t<s?-1:1});y.onuserchange(e.users)},exists:function(n){var t=false;$.each(e.users,function(e,n){if(n.nick.toLowerCase()==u.nick.toLowerCase()&&n.network==u.network){t=true;return false}});return t},add:function(n){if(c.current().handler!==""){var t=true;$.each(e.users,function(e,s){if(s.nick==n.nick&&s.network==n.network){t=false;return false}});if(t){e.users.push(n);e.draw()}}},remove:function(n){if(c.current().handler!==""){$.each(e.users,function(t,s){if(s.nick==n.nick&&s.network==n.network){e.users.splice(t,1);return false}});e.draw()}},setUsers:function(n){e.users=n;e.draw()},getNames:function(){return $.map(e.users,function(e){return e.nick})}};return{add:e.add,remove:e.remove,setUsers:e.setUsers,getNames:e.getNames}}(),d=function(){var n={parse:function(n){var t=n.split(" ")[0].toLowerCase(),i=n.substr(t.length+1).toLowerCase().trim();switch(t){case"j":case"join":if(s.isGuest()){g.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t join as guest</span>')}else{y.onchanneljoin(i)}return true;case"q":case"query":if(s.isGuest()){g.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t query as guest</span>')}else{y.onchanneljoin("*"+i)}return true;case"win":case"w":case"window":var r=c.getList()[parseInt(i,10)];if(r!==undefined){y.onchanneljoin(r.chan)}return true;case"p":case"part":if(i!==""){y.onchannelpart(i)}else{y.onchannelpart(c.current().name)}return true;case"help":g.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');g.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){g.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}};return{parse:n.parse}}(),g=function(){var e={sending:false,send:function(n,s,i){if(typeof n==="string"){s=n;n=undefined}if(n===undefined){n=function(){}}if(s===undefined){s=g.val()}if(!s){n();return}p.add(s);if(s!==""&&a.get("textDeco")){if(s[0]==">"){s="3"+s}s=s.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}if(i===undefined){i=c.current().handler}if(s[0]=="/"&&d.parse(s.substr(1))){n()}else{if(!e.sending){e.sending=true;l.send(s,i,function(s){if(s!==undefined&&s.lines!==undefined){$.map(s.lines,function(e){t(e)})}e.sending=false;n()})}}},internal:function(e){t({curLine:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:c.current().handler})},val:function(e){if(e===undefined){if(y.ongetval===false){if(n.is("input")){return n.val()}return n.text()}return y.ongetval()}if(y.onsetval===false){if(n.is("input")){n.val(e)}else{n.text(e)}}else{y.onsetval(e)}}};return{internal:e.internal,send:e.send,val:e.val}}(),h=function(){var e={tabWord:"",tabCount:0,isInTab:false,startPos:0,startChar:"",endPos:0,endChar:"",endPos0:0,tabAppendStr:"",searchArray:[],node:false,wysiwyg:false,getCurrentWord:function(){var t=!e.wysiwyg?n[0].value:(e.node=window.getSelection().anchorNode).nodeValue;if(e.isInTab){return e.tabWord}e.startPos=!e.wysiwyg?n[0].selectionStart:window.getSelection().anchorOffset;e.startChar=t.charAt(e.startPos);while(e.startChar!=" "&&--e.startPos>0){e.startChar=t.charAt(e.startPos)}if(e.startChar==" "){e.startPos++}e.endPos=!e.wysiwyg?n[0].selectionStart:window.getSelection().anchorOffset;e.endChar=t.charAt(e.endPos);while(e.endChar!=" "&&++e.endPos<=t.length){e.endChar=t.charAt(e.endPos)}e.endPos0=e.endPos;e.tabWord=t.substr(e.startPos,e.endPos-e.startPos).trim();return e.tabWord},getTabComplete:function(){var t=!e.wysiwyg?n[0].value:e.node.nodeValue,s;if(t===null){return}s=e.search(e.getCurrentWord(),e.tabCount);if(!e.isInTab){e.tabAppendStr=" ";if(e.startPos===0){e.tabAppendStr=": "}}if(s==e.getCurrentWord()){e.tabCount=0;s=e.search(e.getCurrentWord(),e.tabCount)}t=t.substr(0,e.startPos)+s+e.tabAppendStr+t.substr(e.endPos+1);if(!e.wysiwyg){n[0].value=t}else{window.getSelection().anchorNode.nodeValue=t;window.getSelection().getRangeAt(0).setEnd(e.node,e.startPos+s.length+e.tabAppendStr.length);window.getSelection().getRangeAt(0).setStart(e.node,e.startPos+s.length+e.tabAppendStr.length)}e.endPos=e.endPos0+s.length+e.tabAppendStr.length},search:function(n,t){var s=false;if(!t){t=0}$.each(e.searchArray,function(e,i){if(i.toLowerCase().indexOf(n.toLowerCase())===0&&t--<=0&&s===false){s=i}});if(s!==false){return s}return n},init:function(){e.wysiwyg=!n.is("input");n.keydown(function(n){if(n.keyCode==9){if(!n.ctrlKey){n.preventDefault();e.getTabComplete();e.isInTab=true;e.tabCount++;setTimeout(1,1)}}else{e.tabWord="";e.tabCount=0;e.isInTab=false}})},load:function(){e.searchArray=$.merge(f.getNames(),c.getNames())}};return{init:e.init,load:e.load}}(),p=function(){var e={messages:[],counter:0,current:"",init:function(){n.keydown(function(n){if(n.keyCode==38||n.keyCode==40){n.preventDefault();if(e.counter==e.messages.length){e.current=g.val()}if(e.messages.length!==0){if(n.keyCode==38){if(e.counter!==0){e.counter--}g.val(e.messages[e.counter])}else{if(e.counter!=e.messages.length){e.counter++}if(e.counter==e.messages.length){g.val(e.current)}else{g.val(e.messages[e.counter])}}}}})},add:function(n){e.messages.push(n);if(e.messages.length>20){e.messages.shift()}e.counter=e.messages.length;y.ls.set("oldMessages-"+y.channels.current().handlerB64,e.messages)},read:function(){e.messages=y.ls.get("oldMessages-"+y.channels.current().handlerB64);if(!e.messages){e.messages=[]}console.log(e.messages);e.counter=e.messages.length}};return{init:e.init,add:e.add,read:e.read}}(),m=function(){var e={text:"",started:false,start:function(){if(!a.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(n){}}},500);e.started=true}},set:function(n){e.text=n;if(!e.started){e.start()}}};return{set:e.set}}(),w=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(n){var t;if(e.support_webkit){t=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",n);t.show()}else if(e.support()){t=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:n});t.onshow=function(){setTimeout(t.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");y.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(n){if(Notification.permission!==n){Notification.permission=n}if(n==="granted"){e.show("Notifications Enabled!");y.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},sound:false,make:function(n,t){var s=o.current();if(s){if(a.get("browserNotifications")){e.show(n)}if(a.get("ding")&&e.sound){e.sound.play()}}e.startFlash();y.onnotification(n,t,s)},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var n=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(n?"[ @] ":"[@ ] ")+e.originalTitle;n=!n},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(n){if(n===undefined){n=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!n){y.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(n){if(n.originalEvent.key==s.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)}).focus(function(){e.stopFlash()});if(!e.sound){e.sound=new Audio("beep.mp3")}}};return{request:e.request,make:e.make,init:e.init}}(),k=function(){var e={smileys_a:[],cacheServerNicks:{},spLinks:[],name:function(n,t,i){if(i===undefined){i=-1}n=n=="\x00"?"":n;var o=encodeURIComponent(n);n=$("<span>").text(n).html();var l=[19,20,22,24,25,26,27,28,29],u=0,c=0,f=n,d=s.getNetwork(t),g=true;switch(a.get("colordNames")){case"1":while(n[c]){u+=n.charCodeAt(c++)}f=$("<span>").append($("<span>").addClass("uName-"+l[u%9].toString()).html(n)).html();break;case"2":if(d!==undefined&&d.checkLogin!==undefined&&i!=-1){g=false;if(e.cacheServerNicks[t.toString()+":"+i.toString()]===undefined){r.getJSON(d.checkLogin+"?c="+i.toString(10)+"&n="+o,function(n){e.cacheServerNicks[t.toString()+":"+i.toString()]=n.nick},false,false)}f=e.cacheServerNicks[t.toString()+":"+i.toString()]}else{f=n}break;default:f=n;break}if(d!==undefined&&g){f=d.normal.split("NICKENCODE").join(o).split("NICK").join(f).split("USERID").join(i.toString(10))}if(d!==undefined){return'<span title="'+d.name+'">'+f+"</span>"}return'<span title="Unknown Network">'+f+"</span>"},smileys:function(n){if(!n){return""}if(/^[\w\s\d\.,!?]*$/.test(n)){return n}$.each(e.smileys_a,function(e,t){n=n.replace(RegExp(t.regex,"g"),t.replace)});return n},links:function(n){if(!n||n===null||n===undefined){return""}var t='[^\\s<"]';n=n.replace(RegExp("(|)","g"),"");$.map(e.spLinks,function(e){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");n=n.replace(RegExp("(^|[\\s>])((?:(?:f|ht)tps?://(?:www\\.)?)"+e+t+"*)","g"),"$1$2").replace(RegExp("(^|[\\s>])("+e+t+"*)","g"),"$1$2")});return n.replace(RegExp("(^|[^a-zA-Z0-9_])((?:(?:f|ht)tps?://)"+t+"+)","g"),'$1<a target="_blank" href="$2">$2</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+t+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},colors:function(e){var n=[],t,s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},i,r;if(!e){return""}n=e.split(RegExp("([])"));e="<span>";for(i=0;i<n.length;i++){r=true;switch(n[i]){case"":t=n[i+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(t==n[i+1]){t=n[i+1].replace(/^([0-9]{1,2}).*/,"$1:");if(t!=n[i+1]){s.fg=t.split(":")[0];n[i+1]=n[i+1].substr(t.length-1)}else{s.fg="-1";s.bg="-1"}}else{s.fg=t.split(":")[0];s.bg=t.split(":")[1];if(t==n[i+1]){n[i+1]=""}else{n[i+1]=n[i+1].substr(t.length)}}break;case"":s.bold=!s.bold;break;case"":s.italic=!s.italic;break;case"":t=s.fg;s.fg=s.bg;s.bg=t;if(s.fg=="-1"){s.fg="0"}if(s.bg=="-1"){s.bg="1"}break;case"":s.underline=!s.underline;break;case"":s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:r=false}if(r){e+="</span>"+'<span class="fg-'+s.fg+" bg-"+s.bg+'" style="'+(s.bold?"font-weight:bold;":"")+(s.underline?"text-decoration:underline;":"")+(s.italic?"font-style:italic;":"")+'">'}else{e+=n[i]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},highlight:function(e){var n="";if(!a.get("highRed")){n+="background:none;padding:none;border:none;"}if(a.get("highBold")){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"},parse:function(n,t){if(t==undefined||!t){t=false}n=n=="\x00"?"":n;n=$("<span>").text(n).html();if(a.get("smileys")&&t===false){n=e.smileys(n)}n=e.colors(n);n=e.links(n);return n},setSmileys:function(n){e.smileys_a=[];$.each(n,function(n,t){e.smileys_a.push({regex:t.regex,replace:t.replace.split("ADDSTUFF").join('data-code="'+t.code+'"').split("PIC").join(t.pic).split("ALT").join(t.alt)})})},setSpLinks:function(n){e.spLinks=n},parseTextDecorations:function(e){if(e!==""&&a.get("textDeco")){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e},addLine:function(n,t){if(n.type!="highlight"&&n.chan.toString().toLowerCase()!=c.current().handler.toLowerCase()&&n.name2!==s.getPmIdent()){return}var i=e.name(n.name,n.network,n.uid),r=e.parse(n.message),o="*",l=r;if(s.nick()!=""&&["message","action","pm","pmaction"].indexOf(n.type)>=0&&n.name.toLowerCase()!="*"&&r.toLowerCase().indexOf(s.nick().toLowerCase().substr(0,a.get("charsHigh")))>=0){l=r=k.highlight(r);if(!t&&v.isBlurred()){w.make("("+c.current().name+") <"+n.name+"> "+n.message,n.chan)}}switch(n.type){case"reload":if(!t){c.current().reload()}return;case"reload_userlist":if(!t){c.current().reloadUserlist()}return;case"relog":if(!t){s.fetch(undefined,true)}return;case"refresh":if(!t){location.reload(true)}return;case"join":l=[i," has joined "+c.current().name];if(!t){f.add({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!a.get("oircJoinPart")){return}break;case"part":l=[i," has left "+c.current().name+" (",r,")"];if(!t){f.remove({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!a.get("oircJoinPart")){return}break;case"quit":l=[i," has quit IRC (",r,")"];if(!t){f.remove({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!a.get("oircJoinPart")){return}break;case"kick":l=[i," has kicked ",k.name(n.name2,n.network)," from "+c.current().name+" (",r,")"];if(!t){f.remove({nick:n.name2,network:n.network})}break;case"message":o=i;break;case"action":l=[i," ",r];break;case"mode":if(typeof r=="string"){r=n.message.split(" ");
$.each(r,function(e,t){var s=$("<span>").html(t).text();if(s.indexOf("+")==-1&&s.indexOf("-")==-1){r[e]=k.name(t,n.network)}});r=r.join(" ")}l=[i," set "+c.current().name+" mode ",r];break;case"nick":l=[i," has changed nicks to ",k.name(n.name2,n.network)];if(!t){f.add({nick:n.name2,network:n.network});f.remove({nick:n.name,network:n.network})}break;case"topic":y.ontopicchange(k.parse(n.message,true));if(n.name===""&&n.network===0&&t){return}l=[i," has changed the topic to ",k.parse(n.message,true)];break;case"pm":if(n.chan==c.current().handler){o=i;n.type="message"}else{if(!t){if(n.name.toLowerCase()==s.nick().toLowerCase()){c.joinPm(n.chan,s.getWholePmIdent(n.uid,n.network));return}else{o=["(PM)",i];c.joinPm(n.name,s.getWholePmIdent(n.uid,n.network));w.make("(PM) <"+n.name+"> "+n.message,n.chan)}}else{return}}break;case"pmaction":if(n.chan==c.current().handler){l=[i," ",r];n.type="action"}else{if(!t){if(n.name.toLowerCase()==s.nick().toLowerCase()){c.joinPm(n.chan,s.getWholePmIdent(n.uid,n.network));return}else{l=["(PM)",i," ",r];c.joinPm(n.name,s.getWholePmIdent(n.uid,n.network));notofication.make("* (PM)"+n.name+" "+n.message,n.chan);n.type="pm"}}else{return}}break;case"highlight":if(n.name.toLowerCase()!="*"){w.make("("+n.chan+") <"+n.name+"> "+n.message,n.chan)}return;case"internal":l=n.message;break;case"server":break;default:return}y.onmessage(o,l,n,t)}};return{setSmileys:e.setSmileys,setSpLinks:e.setSpLinks,parse:e.parse,parseTextDecorations:e.parseTextDecorations,name:e.name,highlight:e.highlight,addLine:e.addLine}}(),b=function(){var e={$errors:false,$warnings:false,errors:[],warnings:[],$errorsPopup:false,$warningsPopup:false,getSinglePopupEntry:function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,n){return["<br>",$("<span>").text(n).html(),": ",$("<span>").text(e).html()]}))},makePopup:function(n,t,s){return $("<div>").addClass("errorPopup").addClass(n.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();s()}),"&nbsp;",$("<b>").text(n),$("<div>").addClass("errorPopupCont").append($.map(t,function(n){return e.getSinglePopupEntry(n)}))).appendTo("body")},init:function(n,t){if(n===undefined){n=$("#errors")}if(t===undefined){t=$("#warnings")}n.click(function(){if(!e.$errorsPopup){e.$errorsPopup=e.makePopup("Errors",e.errors,function(){e.$errorsPopup=false})}});t.click(function(){if(!e.$warningsPopup){e.$warningsPopup=e.makePopup("Warnings",e.warnings,function(){e.$warningsPopup=false})}});e.$errors=n;e.$warnings=t},addError:function(n,t){e.errors.push({time:(new Date).getTime(),file:n,content:t});e.$errors.css("display","").find(".count").text(e.errors.length);if(e.$errorsPopup){e.$errorsPopup.children("div").append(e.getSinglePopupEntry(e.errors[e.errors.length-1]))}},addWarning:function(n,t){e.warnings.push({time:(new Date).getTime(),file:n,content:t});e.$warnings.css("display","").find(".count").text(e.warnings.length);if(e.$warningsPopup){e.$warningsPopup.children("div").append(e.getSinglePopupEntry(e.warnings[e.warnings.length-1]))}}};return{addError:e.addError,addWarning:e.addWarning,init:e.init}}(),v=function(){var e={isBlurred:true,init:function(){$(window).blur(function(){e.isBlurred=true}).focus(function(){e.isBlurred=false})},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+y.settings.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+y.settings.net())}})}};return{init:e.init,changeLinks:e.changeLinks,isBlurred:function(){return e.isBlurred}}}(),C=function(){var e={isOpen:false,open:function(n){if(e.isOpen){return}e.isOpen=true;l.stop(n)},close:function(){if(!e.isOpen){return}e.isOpen=false;c.current().reload()},fetch:function(n,s,i){if(!e.isOpen){return}if(i===undefined){i=0}r.getJSON("Log.php?day="+n+"&offset="+parseInt(i,10)+"&channel="+c.current().handlerB64,function(r){if(!r.banned){$.map(r.lines,function(e){t(e,true)});if(r.lines.length>=1e3){e.fetch(n,s,i+1e3)}else if(s!==undefined){s(true)}}else{g.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');s(false)}})}};return{fetch:e.fetch,open:e.open,close:e.close}}(),y;this.OMNOMIRCSERVER=e;this.settings={loggedIn:s.loggedIn,fetch:s.fetch,net:s.net,getNetwork:s.getNetwork,getPmIdent:s.getPmIdent,getWholePmIdent:s.getWholePmIdent,nick:s.nick,guestLevel:s.guestLevel,identGuest:s.identGuest,logout:s.logout};this.ls={get:i.get,set:i.set};this.network={getJSON:r.getJSON,post:r.post};this.options={get:a.get,set:a.set,getAll:a.getAll};this.instant={current:o.current};this.channels={load:c.load,join:c.join,joinPm:c.joinPm,part:c.part,getList:c.getList,getHandler:c.getHandler,current:c.current,setChans:c.setChans,highlight:c.highlight};this.users={add:f.add,remove:f.remove,setUsers:f.setUsers};this.send={send:g.send,internal:g.internal,val:g.val};this.parser={parse:k.parse,name:k.name,highlight:k.highlight};this.error={addWarning:b.addWarning,addError:b.addError,init:b.init};this.page={changeLinks:v.changeLinks,isBlurred:v.isBlurred};this.logs={fetch:C.fetch,open:C.open,close:C.close};this.statusBar={set:m.set};this.initinput=function(e){if(e===undefined){e=$("#message")}n=e;h.init();p.init()};this.connect=function(e){v.init();w.init();s.fetch(function(){o.init();l.init();c.init();e()})};this.disconnect=function(){o.kill();l.kill()};this.onerror=function(){};this.onwarning=function(){};this.onmessage=function(){};this.onmessageraw=false;this.onuserchange=function(){};this.onchannelchange=function(){};this.onchanneljoin=function(){};this.onchannelpart=function(){};this.onsmileychange=function(){};this.onsetval=false;this.ongetval=false;this.ontopicchange=function(){};this.onnotification=function(){};y=this;if(this.setOptions!==undefined){this.options.setAll=a.setAll;this.setOptions();delete this.options.setAll}};