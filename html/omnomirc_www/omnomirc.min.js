"use strict";function OmnomIRC(){var e="https://omnomirc.omnimaga.org",n="",t=false,i=function(e,n){if(n===undefined){n=false}if(e.name===null||e.network==-1||!n&&!f.isNew(e.curline)){f.setCurline(e.curline);return}f.setCurline(e.curline);if(P.onmessageraw!==false){P.onmessageraw(e,n)}else{C.addLine(e,n)}if(!n&&e.chan==a.get("chan")){var t=a.get("lines");t.push(e);if(t.length>200){t.shift()}a.set("lines",t);if(["part","quit","join","nick"].indexOf(e.type)!=-1){a.set("users",g.getUsers())}}},s=function(){var e={hostname:"",nick:"",signature:"",numHigh:4,uid:-1,net:"",networks:{},pmIdent:false,guestLevel:0,isGuest:true,identGuest:function(n,t,i,s){if(s===undefined){s=i;i=false}console.log("trying login");o.getJSON("misc.php?identName="+base64.encode(n)+"&nick="+base64.encode(n)+"&signature="+base64.encode(t)+"&id=-1&network="+e.net,function(t){if(t.success){if(i){r.set("guestName",n);r.set("guestSig",t.signature)}else{r.set("guestName","");r.set("guestSig","")}e.setIdent(n,t.signature,-1);f.identify()}if(s!==undefined){s(t)}},true,false)},logout:function(){r.set("guestName","");r.set("guestSig","");e.setIdent("","",-1);a.remove("config");a.remove("checkLogin");f.identify()},login:function(n,t,i){if(i===undefined){i=-1}e.setIdent(n,t,i);f.identify()},fetch:function(n,t){var i=function(i){if(!t){try{sessionStorage.setItem("defaultNetwork",i.defaultNetwork)}catch(s){}a.set("config",i);e.hostname=i.hostname;d.setChans(i.channels);C.setSmileys(i.smileys);P.onsmileychange(i.smileys);C.setSpLinks(i.spLinks);e.guestLevel=i.guests;e.networks={};$.each(i.networks,function(n,t){e.networks[t.id]=t});e.net=i.network;r.setPrefix(e.net);l.setDefaults(i.defaults);l.setExtraChanMsg(i.extraChanMsg);f.setData(i.websockets.use,i.websockets.host,i.websockets.port,i.websockets.ssl)}var u=a.get("checkLogin");if(u){e.nick=u.nick;e.signature=u.signature;e.uid=u.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=i.signature==="";if(n!==undefined){n()}return}if(e.loggedIn()&&e.isGuest){e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}})}else{o.getJSON(i.checkLoginUrl+"&network="+e.net.toString()+"&jsoncallback=?",function(t){a.set("checkLogin",{nick:t.nick,signature:t.signature,uid:t.uid});e.nick=t.nick;e.signature=t.signature;e.uid=t.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=t.signature==="";if(n!==undefined){n()}},true,false)}};if(t===undefined){t=false}if(t&&e.loggedIn()&&e.isGuest){console.log("i am silly");e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}});return}if(!t){var s=a.get("config");if(s){i(s);return}}a.determinePrefix();o.getJSON("config.php?js"+(document.URL.split("network=")[1]!==undefined?"&network="+document.URL.split("network=")[1].split("&")[0].split("#")[0]:"")+(t?"&clonly":""),i,true,false)},setIdent:function(n,t,i){e.nick=n;e.signature=t;e.uid=i;a.set("checkLogin",{nick:n,signature:t,uid:i})},getUrlParams:function(){return"nick="+base64.encode(e.nick)+"&signature="+base64.encode(e.signature)+"&time="+(+new Date).toString()+"&id="+e.uid+"&network="+e.net+"&noLoginErrors"},getNetwork:function(n){if(e.networks[n]!==undefined){return e.networks[n]}return{id:-1,normal:"NICK",userlist:"NICK",name:"Invalid network",type:-1}},getIdentParams:function(){return{nick:e.nick,signature:e.signature,time:(+new Date).toString(),id:e.uid,network:e.net}},loggedIn:function(){return e.signature!==""},getWholePmIdent:function(n,t){var i="["+t.toString()+","+n.toString()+"]";if(t<e.net){return i+e.pmIdent}else if(e.net<t){return e.pmIdent+i}else if(n<e.uid){return i+e.pmIdent}else{return e.pmIdent+i}}};return{identGuest:e.identGuest,fetch:e.fetch,getUrlParams:e.getUrlParams,getIdentParams:e.getIdentParams,getNetwork:e.getNetwork,nick:function(){return e.nick},net:function(){return e.net},loggedIn:e.loggedIn,guestLevel:function(){return e.guestLevel},getPmIdent:function(){return e.pmIdent},isGuest:function(){return e.isGuest},getWholePmIdent:e.getWholePmIdent,logout:e.logout,login:e.login}}(),r=function(){var e={prefix:document.URL.split("network=")[1]!==undefined?document.URL.split("network=")[1].split("&")[0].split("#")[0]:"",setPrefix:function(n){if(!n){e.prefix="";return}e.prefix=n.toString()},getCookie:function(e){var n,t,i,s=document.cookie.split(";");for(n=0;n<s.length;n++){t=s[n].substr(0,s[n].indexOf("="));i=s[n].substr(s[n].indexOf("=")+1);t=t.replace(/^\s+|\s+$/g,"");if(t==e){return unescape(i)}}},setCookie:function(e,n,t){var i=new Date,s=escape(n);i.setDate(i.getDate()+t);s+=t===null?"":"; expires="+i.toUTCString();document.cookie=e+"="+s},haveSupport:null,support:function(){if(e.haveSupport===null){try{localStorage.setItem("test",1);e.haveSupport=localStorage.getItem("test")==1;localStorage.removeItem("test");e.haveSupport=true}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){var t;n=e.prefix+n;if(e.support()){t=localStorage.getItem(n)}else{t=e.getCookie(n)}try{return JSON.parse(t)}catch(i){return undefined}},set:function(n,t){n=e.prefix+n;t=JSON.stringify(t);if(e.support()){localStorage.setItem(n,t)}else{e.setCookie(n,t)}}};return{setPrefix:e.setPrefix,get:e.get,set:e.set}}(),a=function(){var e={prefix:document.URL.split("network=")[1]!==undefined?document.URL.split("network=")[1].split("&")[0].split("#")[0]:"",setPrefix:function(n){if(!n){return}e.prefix=n.toString()},determinePrefix:function(){e.haveSupport=null},haveSupport:null,support:function(){if(e.haveSupport===null){try{sessionStorage.setItem("test",1);e.haveSupport=sessionStorage.getItem("test")==1;sessionStorage.removeItem("test");if(e.haveSupport&&e.prefix==""){e.setPrefix(sessionStorage.getItem("defaultNetwork"))}}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){if(e.support()){try{return JSON.parse(sessionStorage.getItem(e.prefix+n))}catch(t){return undefined}}return undefined},set:function(n,t){if(e.support()){sessionStorage.setItem(e.prefix+n,JSON.stringify(t))}},remove:function(n){if(e.support()){sessionStorage.removeItem(e.prefix+n)}}};return{determinePrefix:e.determinePrefix,get:e.get,set:e.set,remove:e.remove}}(),o=function(){var e={didRelog:false,removeSig:function(e){try{var n=e.split("signature="),t=n[1].split("&");t[0]="---";n[1]=t.join("&");return n.join("signature=")}catch(i){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},addError:function(n,t){n=e.removeSig(n);P.onerror(n,t)},addWarning:function(n,t){n=e.removeSig(n);P.onwarning(n,t)},checkCallback:function(n,t,i,r){if(n.relog!=2){if(n.errors!==undefined){$.map(n.errors,function(n){if(n.type!==undefined){e.addError(r,n)}else{e.addError(r,{type:"misc",message:n})}})}if(n.warnings!==undefined){$.map(n.warnings,function(n){if(n.type!==undefined){e.addWarning(r,n)}else{e.addWarning(r,{type:"misc",message:n})}})}}if(n.relog!==undefined&&n.relog!=0){if(n.relog==1){s.fetch(undefined,true);t(n)}else if(n.relog==2&&!e.didRelog){e.didRelog=true;s.fetch(function(){i()},true)}else{t(n)}}else{if(n.relog!==undefined){e.didRelog=false}t(n)}},getJSON:function(n,t,i,r){if(i==undefined){i=true}if(r==undefined){r=true}if(n.indexOf("?")==-1&&r){n+="?"}var a=n+(r?"&"+s.getUrlParams():"");return $.ajax({url:a,dataType:"json",async:i}).done(function(s){e.checkCallback(s,t,function(){e.getJSON(n,t,i,r)},a)})},post:function(n,t,i,r,a){if(r==undefined){r=true}if(a==undefined){a=true}if(n.indexOf("?")==-1&&a){n+="?"}var o=n+(a?"&"+s.getUrlParams():"");return $.ajax({type:"POST",url:o,async:r,data:t}).done(function(s){e.checkCallback(s,i,function(){e.post(n,t,i,r,a)},o)})}};return{getJSON:e.getJSON,post:e.post}}(),l=function(){var e={extraChanMsg:"",allOptions:{highBold:{disp:"Highlight Bold","default":true},highRed:{disp:"Highlight Red","default":true},colordNames:{disp:"Colored Names","default":0,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(n,t){return $("<option>").attr(e.get("colordNames")==t?"selected":"false","selected").val(t).text(n)})))}},curChan:{hidden:true,"default":0},extraChans:{disp:"Show extra Channels","default":false,before:function(){if(e.extraChanMsg!==""){alert(e.extraChanMsg)}return true}},ding:{disp:"Ding on Highlight","default":false},smileys:{disp:"Show Smileys","default":true},charsHigh:{disp:"Number chars for Highlighting","default":4,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("charsHigh",this.value)}).append($.map([1,2,3,4,5,6,7,8,9,10],function(n){return $("<option>").attr(e.get("charsHigh")==n?"selected":"false","selected").val(n).text(n)})))}},oircJoinPart:{disp:"Show OmnomIRC join/part messages","default":false},textDeco:{disp:"Enable simple text decorations","default":false},statusBar:{disp:"Show Updates in Browser Status Bar","default":true},browserNotifications:{disp:"Browser Notifications","default":false,before:function(){v.request();return false}},wysiwyg:{disp:"Use WYSIWYG editor","default":false}},set:function(n,t){if(e.allOptions[n]===undefined){return}e.allOptions[n].value=t;var i=r.get("options")||{};i[n]=t;r.set("options",i)},get:function(n){if(e.allOptions[n]!==undefined){return e.allOptions[n].value}},setExtraChanMsg:function(n){e.extraChanMsg=n},setDefaults:function(n){var t=r.get("options");$.each(e.allOptions,function(i,s){var r=s.default;if(t&&t[i]!==undefined){r=t[i]}else if(n&&n[i]!==undefined){r=n[i]}e.allOptions[i].value=r})},getAll:function(n){if(n){return e.allOptions}var t={};$.each(e.allOptions,function(e,n){if(n.hidden===undefined||!n.hidden){t[e]=n.value}});return t},setAll:function(n){e.allOptions=n}};return{set:e.set,get:e.get,setDefaults:e.setDefaults,setExtraChanMsg:e.setExtraChanMsg,getAll:e.getAll,setAll:e.setAll}}(),c=function(){var e={id:Math.random().toString(36)+(new Date).getTime().toString(),update:function(){r.set("browserTab",e.id);r.set("newInstant",false)},init:function(){r.set("browserTab",e.id);$(window).focus(function(){e.update()}).unload(function(){e.kill()})},current:function(){if(r.get("newInstant")){e.update()}return e.id==r.get("browserTab")},kill:function(){r.set("newInstant",true);$(window).off("focus").off("unload")}};return{init:e.init,current:e.current,kill:e.kill}}(),f=function(){var e={ws:{socket:false,connected:false,use:true,sendBuffer:[],allowLines:false,enabled:false,host:"",port:0,ssl:true,tryFallback:true,didRelog:false,fallback:function(){console.log("trying fallback...");if(e.ws.tryFallback){try{e.ws.tryFallback=false;e.ws.socket.close()}catch(n){}e.ws.use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()}},identify:function(){e.ws.send($.extend({action:"ident"},s.getIdentParams()));e.ws.send({action:"charsHigh",chars:l.get("charsHigh")})},init:function(){if(!("WebSocket"in window)||!e.ws.enabled){e.ws.use=false;return false}try{var n=window.location.pathname.split("/");n.pop();if(n.length>1&&n[n.length-1]===""){n.pop()}n.push("ws");n.push(s.net());e.ws.socket=new PooledWebSocket((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"))}catch(t){console.log(e.ws.socket);console.log((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"));console.log(t);e.ws.fallback();return}e.ws.socket.onopen=function(n){e.ws.connected=true;for(var t=0;t<e.ws.sendBuffer.length;t++){e.ws.send(e.ws.sendBuffer[t])}e.ws.sendBuffer=[]};e.ws.socket.onmessage=function(n){try{var t=JSON.parse(n.data);console.log(t);if(e.ws.allowLines){if(t.line!==undefined){if(i(t.line)){e.ws.tryFallback=false;delete e.ws.socket}}if(t.users!==undefined){g.setUsers(t.users)}}if(t.relog!==undefined&&t.relog!=0&&t.relog<3){if(!e.ws.didRelog){e.ws.didRelog=true;s.fetch(function(){if(s.loggedIn()){e.ws.identify();e.ws.didRelog=false}},true)}}}catch(n){}};e.ws.socket.onclose=function(n){console.log("CLOOOOOOOOOSE");console.log(n);e.ws.use=false;e.ws.fallback()};e.ws.socket.onerror=function(n){console.log("ERRRORRRR");console.log(n);delete e.ws.socket;e.ws.use=false;e.ws.fallback()};e.ws.identify();$(window).on("beforeunload",function(){e.partChan(d.current().handler);delete e.ws.socket});return true},send:function(n){if(e.ws.connected){e.ws.socket.send(JSON.stringify(n))}else{e.ws.sendBuffer.push(n)}}},old:{inRequest:false,handler:false,lastSuccess:(new Date).getTime(),fnCallback:undefined,chan:"",sendRequest:function(){if(!e.old.chan){return}e.old.handler=o.getJSON("Update.php?high="+l.get("charsHigh").toString()+"&channel="+e.old.chan+"&lineNum="+e.curline.toString(),function(n){e.old.handler=false;e.old.lastSuccess=(new Date).getTime();if(n.lines!==undefined){$.map(n.lines,function(e){i(e)})}if(n.errors!=undefined&&n.errors.length>=1){return}if(n.banned!==true){e.old.setTimer()}}).fail(function(){e.old.handler=false;if(e.fnCallback!=undefined){e.fnCallback();e.fnCallback=undefined;return}if((new Date).getTime()>=e.old.lastSuccess+3e5){p.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!e.old.inRequest){e.old.lastSuccess=(new Date).getTime()}else{e.old.setTimer()}})},setTimer:function(){if(e.old.inRequest&&d.current().loaded&&e.old.handler===false){setTimeout(function(){e.old.sendRequest()},y.isBlurred()?2500:200)}else{e.old.stop()}},start:function(){if(!e.old.inRequest){e.old.inRequest=true;e.old.setTimer()}},stop:function(n){if(e.old.inRequest){e.old.inRequest=false;if(e.old.handler){e.fnCallback=n;e.old.handler.abort()}else if(n!==undefined){n()}}else if(n!==undefined){n()}},send:function(e,n,t){o.getJSON("message.php?message="+base64.encode(e)+"&channel="+n,function(e){if(t!==undefined){t(e)}})}},curline:0,joinChan:function(n){if(e.ws.use){e.ws.send({action:"joinchan",chan:n})}if(parseInt(n,10)!=n){n=base64.encode(n)}e.old.chan=n},partChan:function(n){if(e.ws.use){e.ws.send({action:"partchan",chan:n})}},stop:function(n){if(e.ws.use){e.ws.allowLines=false;n()}else{e.old.stop(n)}},kill:function(){if(e.ws.use){e.ws.socket.onclose=function(){};e.ws.socket.close()}else{e.old.stop()}},start:function(){if(e.ws.use){e.ws.allowLines=true}else{e.old.start()}},setCurline:function(n){if(n>e.curline){e.curline=n}},send:function(n,t,i){if(e.ws.use){e.ws.send({action:"message",channel:t,message:n});if(i!==undefined){i()}}else{if(parseInt(t,10)!=t){t=base64.encode(t)}e.old.send(n,t,i)}},setData:function(n,t,i,s){e.ws.enabled=n;e.ws.host=t;e.ws.port=i;e.ws.ssl=s},init:function(){if(e.ws.enabled){e.ws.init()}else{e.ws.use=false;e.old.lastSuccess=(new Date).getTime()}},identify:function(){if(e.ws.enabled){e.ws.identify()}},postfetch:function(){if(e.ws.use){e.ws.send({action:"postfetch",channel:d.current().handler,curline:e.curline})}},isNew:function(n){return n==0||n>e.curline}};return{joinChan:e.joinChan,partChan:e.partChan,start:e.start,stop:e.stop,kill:e.kill,setCurline:e.setCurline,send:e.send,setData:e.setData,init:e.init,identify:e.identify,postfetch:e.postfetch,isNew:e.isNew}}(),d=function(){var e=function(e){var t=n.chans[e]!==undefined,s={i:e,name:t?n.chans[e].chan.toLowerCase():"",handler:t?n.getHandler(e):-1,handlerB64:t?n.getHandler(e,true):-1,loaded:false,load:function(n){if(n.lines===undefined){if(n.message){p.internal(n.message)}else{p.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}return false}l.set("curChan",e);if(n.banned){p.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');return false}g.setUsers(n.users);$.each(n.lines,function(e,n){i(n,true)});s.loaded=true;return true},unload:function(){if(s.loaded){f.partChan(s.handler)}},part:function(){n.part(n.i)},reloadUserlist:function(){if(!t){return}o.getJSON("Load.php?userlist&channel="+s.handlerB64,function(e){if(!e.banned){if(e.users){g.setUsers(e.users)}}else{p.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})},reload:function(){P.onchanneljoin(s.name)},setI:function(e){s.i=e},is:function(e){return e==s.i}};return{name:s.name,handler:s.handler,handlerB64:s.handlerB64,load:s.load,part:s.part,reload:s.reload,unload:s.unload,loaded:function(){return s.loaded},setI:s.setI,is:s.is,reloadUserlist:s.reloadUserlist}},n={current:false,chans:[],save:function(){r.set("channels",n.chans)},loadSettings:function(){try{var e=r.get("channels"),t=$.map(n.chans,function(e){if(e.ex&&l.get("extraChans")||!e.ex){return e}return undefined}),i=[];if(e!==null&&e!=[]){n.chans=$.merge($.map(e,function(e){if(e.id!=-1&&e.id.toString().substr(0,1)!="*"){var t=false;$.each(n.chans,function(n,s){if(s.id==e.id){i.push(e);t=true;e.chan=s.chan;return false}});if(!t){return undefined}}return e}),$.map(t,function(e){var n=false;$.each(i,function(t,i){if(i.id==e.id){n=true;e.chan=i.chan;return false}});if(n){return undefined}return e}));save()}}catch(s){}P.onchannelchange(n.chans)},init:function(){n.current=e(-1);n.loadSettings()},addChan:function(e,t){var i=true;if(t===undefined){t=-1}e=e.toLowerCase();$.each(n.chans,function(n,t){if(t.chan==e){i=n}});if(i===true){if(e[0]=="#"){p.internal('<span style="color:#C73232;">Join Error: Cannot join new channels starting with #.</span>');return-1}n.chans.push({chan:e,high:false,ex:false,id:t,order:-1});n.save();P.onchannelchange(n.chans);return n.chans.length-1}return i},getHandler:function(e,t){if(n.chans[e].id!=-1){if(typeof n.chans[e].id!="number"&&t){return base64.encode(n.chans[e].id)}return n.chans[e].id.toString()}if(t){return base64.encode(n.chans[e].chan)}return n.chans[e].chan},requestHandler:false,load:function(t,i){var s=function(e){if(n.current.load(e)){n.chans[t].high=false;n.save();f.joinChan(n.getHandler(t));f.start();m.load();w.read();f.postfetch();i(true,e);return}i(false,{})};if(i===undefined){i=function(){}}if(n.chans[t]===undefined){i(false,{});return}f.stop(function(){if(n.requestHandler!==false){n.requestHandler.abort()}if(a.get("chan")==n.getHandler(t)){l.set("curChan",t);n.current=e(t);var i={},r=["chan","banned","admin","users","ignores","lines"];for(var u=0;u<r.length;u++){i[r[u]]=a.get(r[u])}s(i);return}n.requestHandler=o.getJSON("Load.php?count=125&channel="+n.getHandler(t,true),function(i){l.set("curChan",t);n.current=e(t);a.set("chan",n.current.handler);a.set("banned",i.banned);a.set("admin",i.admin);a.set("users",i.users);a.set("ignores",i.ignores);a.set("lines",i.lines);s(i)})})},join:function(e){var t=true;e=e.trim();if(!e){return-1}if(e[0]!="@"&&e[0]!="#"){e="@"+e}return n.addChan(e)},joinPm:function(e,t,i){if(i===undefined){i=function(){}}var s=true,r=function(t,s){t=t.trim();if(t.substr(0,1)!="*"){t="*"+e}s=s.trim();if(s.substr(0,1)!="*"){s="*"+s}i(n.addChan(t,s))};if(t==""){if(e.substr(0,1)=="@"||e.substr(0,1)=="#"){p.internal('<span style="color:#C73232;">Query Error: Cannot query a channel. Use /join instead.</span>');i(-1);return}o.getJSON("misc.php?openpm="+base64.encode(e),function(e){if(e.channick){r(e.channick,e.chanid)}else{p.internal('<span style="color:#C73232;">Query Error: User not found.</span>');i(-1)}})}else{r(e,t)}},part:function(e){if(parseInt(e,10)==e){e=parseInt(e,10)}if(typeof e!="number"){if(e&&e[0]!="@"&&e[0]!="#"&&e[0]!="*"){e="@"+e}$.each(n.chans,function(n,t){if(t.chan==e){e=n;return false}})}if(typeof e!="number"||n.chans[e]===undefined){p.internal('<span style="color:#C73232;"> Part Error: can\'t part '+e+". (You are not in it.)</span>");return false}if(n.chans[e].chan[0]=="#"){p.internal('<span style="color:#C73232;"> Part Error: can\'t part '+n.chans[e].chan+". (IRC channel.)</span>");return false}var t=n.chans[e].chanId,i=false;if(n.current.is(e)){i=true}if(t==-1){t=n.chans[e]}f.partChan(n.getHandler(e));n.chans.splice(e,1);n.save();P.onchannelchange(n.chans);if(i){P.onchanneljoin(n.chans[e-1].chan)}return true},getList:function(){return n.chans},setChans:function(e){n.chans=e;if(n.current){n.save();P.onchannelchange(n.chans)}},getNames:function(){return $.map(n.chans,function(e){return e.chan})},highlight:function(e){$.each(n.chans,function(t,i){if(e==i.id||i.chan.toLowerCase()==e.toString().toLowerCase()){n.chans[t].high=true;return false}});n.save();P.onchannelchange(n.chans)}};return{init:n.init,load:n.load,join:n.join,joinPm:n.joinPm,part:n.part,getList:n.getList,getHandler:n.getHandler,current:function(){return n.current},setChans:n.setChans,getNames:n.getNames,highlight:n.highlight}}(),g=function(){var e={users:[],draw:function(){e.users.sort(function(e,n){var t=e.nick.toLowerCase(),i=n.nick.toLowerCase();return t==i?e==n?0:e<n?-1:1:t<i?-1:1});P.onuserchange(e.users)},exists:function(n){var t=false;$.each(e.users,function(e,n){if(n.nick.toLowerCase()==u.nick.toLowerCase()&&n.network==u.network){t=true;return false}});return t},add:function(n){if(d.current().handler!==""){var t=true;$.each(e.users,function(e,i){if(i.nick==n.nick&&i.network==n.network){t=false;return false}});if(t){e.users.push(n);e.draw()}}},remove:function(n){if(d.current().handler!==""){$.each(e.users,function(t,i){if(i.nick==n.nick&&i.network==n.network){e.users.splice(t,1);return false}});e.draw()}},setUsers:function(n){e.users=n;a.set("users",e.users);e.draw()},getNames:function(){return $.map(e.users,function(e){return e.nick})}};return{add:e.add,remove:e.remove,setUsers:e.setUsers,getNames:e.getNames,getUsers:function(n){return e.users}}}(),h=function(){var n={parse:function(n){var t=n.split(" ")[0].toLowerCase(),i=n.substr(t.length+1).toLowerCase().trim();switch(t){case"j":case"join":if(s.isGuest()){p.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t join as guest</span>')}else{P.onchanneljoin(i)}return true;case"q":case"query":if(s.isGuest()){p.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t query as guest</span>')}else{P.onchanneljoin("*"+i)}return true;case"win":case"w":case"window":var r=d.getList()[parseInt(i,10)];if(r!==undefined){P.onchanneljoin(r.chan)}return true;case"p":case"part":if(i!==""){P.onchannelpart(i)}else{P.onchannelpart(d.current().name)}return true;case"help":p.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');p.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){p.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}};return{parse:n.parse}}(),p=function(){var e={sending:false,send:function(n,t,s){if(typeof n==="string"){t=n;n=undefined}if(n===undefined){n=function(){}}if(t===undefined){t=p.val()}if(!t){n();return}w.add(t);if(t!==""&&l.get("textDeco")){if(t[0]==">"){t="3"+t}t=t.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}if(s===undefined){s=d.current().handler}if(t[0]=="/"&&h.parse(t.substr(1))){n()}else{if(!e.sending){e.sending=true;f.send(t,s,function(t){if(t!==undefined&&t.lines!==undefined){$.map(t.lines,function(e){i(e)})}e.sending=false;n()})}}},internal:function(e){i({curline:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:d.current().handler})},val:function(e){if(e===undefined){if(P.ongetval===false){if(t.is("input")){return t.val()}return t.text()}return P.ongetval()}if(P.onsetval===false){if(t.is("input")){t.val(e)}else{t.text(e)}}else{P.onsetval(e)}}};return{internal:e.internal,send:e.send,val:e.val}}(),m=function(){var e={tabWord:"",tabCount:0,isInTab:false,startPos:0,startChar:"",endPos:0,endChar:"",endPos0:0,tabAppendStr:"",searchArray:[],node:false,wysiwyg:false,getCurrentWord:function(){var n=!e.wysiwyg?t[0].value:(e.node=window.getSelection().anchorNode).nodeValue;if(e.isInTab){return e.tabWord}e.startPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.startChar=n.charAt(e.startPos);while(e.startChar!=" "&&--e.startPos>0){e.startChar=n.charAt(e.startPos)}if(e.startChar==" "){e.startPos++}e.endPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.endChar=n.charAt(e.endPos);while(e.endChar!=" "&&++e.endPos<=n.length){e.endChar=n.charAt(e.endPos)}e.endPos0=e.endPos;e.tabWord=n.substr(e.startPos,e.endPos-e.startPos).trim();return e.tabWord},getTabComplete:function(){var n=!e.wysiwyg?t[0].value:e.node.nodeValue,i;if(n===null){return}i=e.search(e.getCurrentWord(),e.tabCount);if(!e.isInTab){e.tabAppendStr=" ";if(e.startPos===0){e.tabAppendStr=": "}}if(i==e.getCurrentWord()){e.tabCount=0;i=e.search(e.getCurrentWord(),e.tabCount)}n=n.substr(0,e.startPos)+i+e.tabAppendStr+n.substr(e.endPos+1);if(!e.wysiwyg){t[0].value=n}else{window.getSelection().anchorNode.nodeValue=n;window.getSelection().getRangeAt(0).setEnd(e.node,e.startPos+i.length+e.tabAppendStr.length);window.getSelection().getRangeAt(0).setStart(e.node,e.startPos+i.length+e.tabAppendStr.length)}e.endPos=e.endPos0+i.length+e.tabAppendStr.length},search:function(n,t){var i=false;if(!t){t=0}$.each(e.searchArray,function(e,s){if(s.toLowerCase().indexOf(n.toLowerCase())===0&&t--<=0&&i===false){i=s}});if(i!==false){return i}return n},init:function(){e.wysiwyg=!t.is("input");t.keydown(function(n){if(n.keyCode==9){if(!n.ctrlKey){n.preventDefault();e.getTabComplete();e.isInTab=true;e.tabCount++;setTimeout(1,1)}}else{e.tabWord="";e.tabCount=0;e.isInTab=false}})},load:function(){e.searchArray=$.merge(g.getNames(),d.getNames())}};return{init:e.init,load:e.load}}(),w=function(){var e={messages:[],counter:0,current:"",init:function(){t.keydown(function(n){if(n.keyCode==38||n.keyCode==40){n.preventDefault();if(e.counter==e.messages.length){e.current=p.val()}if(e.messages.length!==0){if(n.keyCode==38){if(e.counter!==0){e.counter--}p.val(e.messages[e.counter])}else{if(e.counter!=e.messages.length){e.counter++}if(e.counter==e.messages.length){p.val(e.current)}else{p.val(e.messages[e.counter])}}}}})},add:function(n){e.messages.push(n);if(e.messages.length>20){e.messages.shift()}e.counter=e.messages.length;P.ls.set("oldMessages-"+P.channels.current().handlerB64,e.messages)},read:function(){e.messages=P.ls.get("oldMessages-"+P.channels.current().handlerB64);if(!e.messages){e.messages=[]}console.log(e.messages);e.counter=e.messages.length}};return{init:e.init,add:e.add,read:e.read}}(),k=function(){var e={menuOpen:false,msgVal:"",$textDecoForm:false,hideMenu:function(){e.$textDecoForm.css("display","none");e.menuOpen=false},reverseParse:function(e){if(e.indexOf("<")===-1){return $("<span>").html(e).text()}var n=false,t=false,i=false,s="-1",r="-1";e=e.replace(/<img([^>]*?)>/gi,function(e,n){var t=n.match(/data-code="([^"]*)"/);if(t){return t[1]}return""});e=e.replace(/<span([^>]*?)>([^<]*?)<\/span>/gi,function(a,o,u){if(!o){return u}e="";if(o.indexOf("bold")==-1==n){n=!n;e+=""}if(o.indexOf("italic")==-1==t){t=!t;e+=""}if(o.indexOf("underline")==-1==i){i=!i;e+=""}var l=o.match(/fg-(\d+)/),c=o.match(/bg-(\d+)/);if(!l){l="-1"}if(!c){c="-1"}if(c!=r||l!=s){if(s!="-1"&&l=="-1"||r!="-1"&&c=="-1"){e="";if(n){e+=""}if(t){e+=""}if(i){e+=""}}e+="";s=l;if(s!="-1"){e+=s}r=c;if(r!="-1"){e+=","+r}}return e+u});return $("<span>").html(e).text()},getCaretCharacterOffsetWithin:function(e){var n=window.getSelection();if(n.rangeCount>0){var t=n.getRangeAt(0),i=t.cloneRange(),s=0,r=document.createRange(),a;i.selectNodeContents(e);i.setEnd(t.endContainer,t.endOffset);a=i.commonAncestorContainer.getElementsByTagName("img");for(var o=0;o<a.length;o++){var u=a[o];if(u.dataset.code){r.selectNode(u);if(i.compareBoundaryPoints(Range.START_TO_START,r)!=1&&i.compareBoundaryPoints(Range.END_TO_END,r)!=-1){s+=u.dataset.code.length}}}return i.toString().length+s}return 0},getWholeSelection:function(n){var t=window.getSelection(),i,s=t.getRangeAt(0),r=s.cloneRange(),a=e.getCaretCharacterOffsetWithin(n);s.collapse(true);t.removeAllRanges();t.addRange(s);i=e.getCaretCharacterOffsetWithin(n);t.removeAllRanges();t.addRange(r);return[i,a]},setCaretCharacterOffsetWithin:function(n,t,i,s,r){if(i===undefined){i=0}if(s===undefined){s=document.createRange()}if(r===undefined){r=false}for(var a=0;a<n.childNodes.length;a++){var o=n.childNodes[a];if(o.nodeType==3){if(o.length>=t){var u=window.getSelection();if(!r){s.setStart(o,t);r=true;t+=i}if(r&&o.length>=t){s.setEnd(o,t);u.removeAllRanges();u.addRange(s);return-1}}t-=o.length}else if(o.nodeType==1){if(o.tagName=="IMG"&&o.dataset.code){if(o.dataset.code.length>=t){var u=window.getSelection();if(!r){s.setStartAfter(o);r=true;t+=i}if(r&&o.dataset.code.length>=t){s.setEndAfter(o);u.removeAllRanges();u.addRange(s);return-1}}t-=o.dataset.code.length}else{t=e.setCaretCharacterOffsetWithin(o,t,i,s,r);if(t<0){return-1}}}else{t=e.setCaretCharacterOffsetWithin(o,t,i,s,r);if(t<0){return-1}}}return t},surroundSelection:function(e,n){var t=window.getSelection();if(t.rangeCount>0){var i=t.getRangeAt(0),s=i.startContainer,r=i.startOffset,a=document.createTextNode(e),o=document.createTextNode(n),u=i.cloneRange();u.collapse(false);u.insertNode(o);u.setStart(s,r);u.collapse(true);u.insertNode(a);i.setStartAfter(a);i.setEndBefore(o);t.removeAllRanges();t.addRange(i)}},updateContent:function(n,i){if(n===undefined){n=i=e.getCaretCharacterOffsetWithin(t[0])}e.msgVal=e.reverseParse(t.html());t.html(C.parse(e.msgVal));var s=document.createRange();e.setCaretCharacterOffsetWithin(t[0],n,i-n)},init:function(){if(!e.support()){return}var i=t.attr("id"),s=$("<span>").attr({contenteditable:"true",accesskey:"i",id:i}).css({display:"inline-block",height:"1em",padding:"0.3em 0.2em 0.2em 0.3em",fontSize:"1.2em",verticalAlign:"top",whiteSpace:"nowrap",backgroundColor:t.css("backgroundColor")});for(var r in["Top","Bottom","Left","Right"]){for(var a in["Style","Width","Color"]){s.css("border"+r+a,t.css("border"+r+a))}}t.replaceWith(s);t=s;e.$textDecoForm=$("<div>").css({position:"absolute",bottom:"3em"}).attr("id",n+"textDecoForm").append($("<button>").css("font-weight","bold").text("B").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"&nbsp;",$("<button>").css("font-style","italic").text("I").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"&nbsp;",$("<button>").css("text-decoration","underline").text("U").click(function(n){n.preventDefault();var i=e.getWholeSelection(t[0]);e.surroundSelection("","");e.updateContent(i[0],i[1])}),"<br>",$.map([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],function(i){return[i%4==0?"<br>":"",$("<span>").css({display:"inline-block",height:"1em",width:"2em"}).addClass(n+"colorbutton").addClass(n+"bg-"+i).click(function(n){n.preventDefault();var s=e.getWholeSelection(t[0]);e.surroundSelection(""+i,"");e.updateContent(s[0],s[1])})]})).hide().insertBefore(t);P.onsetval=function(n){e.msgVal=n;t.html(C.parse(n))};P.ongetval=function(){return e.msgVal};t.on("input",function(n){e.updateContent()});t.mouseup(function(n){var t=window.getSelection();if(t.isCollapsed){return}n.preventDefault();e.$textDecoForm.show().css("left",Math.max(n.pageX-52,0));e.menuOpen=true});$(document).mousedown(function(n){if(!$(n.target).closest(e.$textDecoForm).length&&e.menuOpen){e.hideMenu()}})},support:function(){return"contentEditable"in document.documentElement&&l.get("wysiwyg")}};return{init:e.init,getMsg:e.getMsg,support:e.support,updateContent:e.updateContent}}(),b=function(){var e={text:"",started:false,start:function(){if(!l.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(n){}}},500);e.started=true}},set:function(n){e.text=n;if(!e.started){e.start()}}};return{set:e.set}}(),v=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){
return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(n){var t;if(e.support_webkit){t=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",n);t.show()}else if(e.support()){t=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:n});t.onshow=function(){setTimeout(t.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");P.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(n){if(Notification.permission!==n){Notification.permission=n}if(n==="granted"){e.show("Notifications Enabled!");P.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},sound:false,make:function(n,t){var i=c.current();if(i){if(l.get("browserNotifications")){e.show(n)}if(l.get("ding")&&e.sound){e.sound.play()}}e.startFlash();P.onnotification(n,t,i)},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var n=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(n?"[ @] ":"[@ ] ")+e.originalTitle;n=!n},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(n){if(n===undefined){n=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!n){P.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(n){if(n.originalEvent.key==s.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)}).focus(function(){e.stopFlash()});if(!e.sound){e.sound=new Audio("beep.mp3")}}};return{request:e.request,make:e.make,init:e.init}}(),C=function(){var e={smileys_a:[],cacheServerNicks:{},spLinks:[],name:function(t,i,r){if(r===undefined){r=-1}t=t=="\0"?"":t;var u=encodeURIComponent(t);t=$("<span>").text(t).html();var c=[19,20,22,24,25,26,27,28,29],f=0,d=0,g=t,h=s.getNetwork(i),p=true;switch(l.get("colordNames")){case"1":while(t[d]){f+=t.charCodeAt(d++)}g=$("<span>").append($("<span>").addClass(n+"uName-"+c[f%9].toString()).html(t)).html();break;case"2":if(h!==undefined&&h.checkLogin!==undefined&&r!=-1){g=a.get("nick"+i.toString()+":"+r.toString());if(!g){p=false;if(e.cacheServerNicks[i.toString()+":"+r.toString()]===undefined){o.getJSON(h.checkLogin+"?c="+r.toString(10)+"&n="+u,function(n){e.cacheServerNicks[i.toString()+":"+r.toString()]=n.nick},false,false)}a.set("nick"+i.toString()+":"+r.toString(),g);g=e.cacheServerNicks[i.toString()+":"+r.toString()]}}else{g=t}break;default:g=t;break}if(h!==undefined&&p){g=h.normal.split("NICKENCODE").join(u).split("NICK").join(g).split("USERID").join(r.toString(10))}if(h!==undefined){return'<span title="'+h.name+'">'+g+"</span>"}return'<span title="Unknown Network">'+g+"</span>"},smileys:function(n){if(!n){return""}if(/^[\w\s\d\.,!?]*$/.test(n)){return n}$.each(e.smileys_a,function(e,t){n=n.replace(RegExp(t.regex,"g"),t.replace)});return n},links:function(n){if(!n||n===null||n===undefined){return""}var t='[^\\s<"]';n=n.replace(RegExp("(|)","g"),"");$.map(e.spLinks,function(e){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");n=n.replace(RegExp("(^|[\\s>])((?:(?:f|ht)tps?://(?:www\\.)?)"+e+t+"*)","g"),"$1$2").replace(RegExp("(^|[\\s>])("+e+t+"*)","g"),"$1$2")});return n.replace(RegExp('(^|[^a-zA-Z0-9_"])((?:(?:f|ht)tps?://)'+t+"+)","g"),'$1<a target="_blank" href="$2">$2</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+t+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},colors:function(e){var t=[],i,s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},r,a;if(!e){return""}t=e.split(RegExp("([])"));e="<span>";for(r=0;r<t.length;r++){a=true;switch(t[r]){case"":i=t[r+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(i==t[r+1]){i=t[r+1].replace(/^([0-9]{1,2}).*/,"$1:");if(i!=t[r+1]){s.fg=i.split(":")[0];t[r+1]=t[r+1].substr(i.length-1)}else{s.fg="-1";s.bg="-1"}}else{s.fg=i.split(":")[0];s.bg=i.split(":")[1];if(i==t[r+1]){t[r+1]=""}else{t[r+1]=t[r+1].substr(i.length)}}break;case"":s.bold=!s.bold;break;case"":s.italic=!s.italic;break;case"":i=s.fg;s.fg=s.bg;s.bg=i;if(s.fg=="-1"){s.fg="0"}if(s.bg=="-1"){s.bg="1"}break;case"":s.underline=!s.underline;break;case"":s={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:a=false}if(a){e+="</span>"+'<span class="'+n+"fg-"+s.fg+" "+n+"bg-"+s.bg+'" style="'+(s.bold?"font-weight:bold;":"")+(s.underline?"text-decoration:underline;":"")+(s.italic?"font-style:italic;":"")+'">'}else{e+=t[r]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},highlight:function(e){var n="";if(!l.get("highRed")){n+="background:none;padding:none;border:none;"}if(l.get("highBold")){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"},parse:function(n,t){if(t==undefined||!t){t=false}n=n=="\0"?"":n;n=$("<span>").text(n).html();if(l.get("smileys")&&t===false){n=e.smileys(n)}n=e.colors(n);n=e.links(n);return n},setSmileys:function(n){e.smileys_a=[];$.each(n,function(n,t){e.smileys_a.push({regex:t.regex,replace:t.replace.split("ADDSTUFF").join('data-code="'+t.code+'"').split("PIC").join(t.pic).split("ALT").join(t.alt)})})},setSpLinks:function(n){e.spLinks=n},parseTextDecorations:function(e){if(e!==""&&l.get("textDeco")){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e},addLine:function(n,t){if(n.type!="highlight"&&n.chan.toString().toLowerCase()!=d.current().handler.toLowerCase()&&n.name2!==s.getPmIdent()){return}var i=e.name(n.name,n.network,n.uid),r=e.parse(n.message),a="*",o=r;if(s.nick()!=""&&["message","action","pm","pmaction"].indexOf(n.type)>=0&&n.name.toLowerCase()!="*"&&r.toLowerCase().indexOf(s.nick().toLowerCase().substr(0,l.get("charsHigh")))>=0){o=r=C.highlight(r);if(!t&&y.isBlurred()){v.make("("+d.current().name+") <"+n.name+"> "+n.message,n.chan)}}switch(n.type){case"reload":if(!t){d.current().reload()}return;case"reload_userlist":if(!t){d.current().reloadUserlist()}return;case"relog":if(!t){s.fetch(undefined,true)}return;case"refresh":if(!t){location.reload(true)}return;case"join":o=[i," has joined "+d.current().name];if(!t){g.add({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!l.get("oircJoinPart")){return}break;case"part":o=[i," has left "+d.current().name+" (",r,")"];if(!t){g.remove({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!l.get("oircJoinPart")){return}break;case"quit":o=[i," has quit IRC (",r,")"];if(!t){g.remove({nick:n.name,network:n.network})}if(s.getNetwork(n.network).type==1&&!l.get("oircJoinPart")){return}break;case"kick":o=[i," has kicked ",C.name(n.name2,n.network)," from "+d.current().name+" (",r,")"];if(!t){g.remove({nick:n.name2,network:n.network})}break;case"message":a=i;break;case"action":o=[i," ",r];break;case"mode":if(typeof r=="string"){r=n.message.split(" ");$.each(r,function(e,t){var i=$("<span>").html(t).text();if(i.indexOf("+")==-1&&i.indexOf("-")==-1){r[e]=C.name(t,n.network)}});r=r.join(" ")}o=[i," set "+d.current().name+" mode ",r];break;case"nick":o=[i," has changed nicks to ",C.name(n.name2,n.network)];if(!t){g.add({nick:n.name2,network:n.network});g.remove({nick:n.name,network:n.network})}break;case"topic":P.ontopicchange(C.parse(n.message,true));if(n.name===""&&n.network===0&&t){return}o=[i," has changed the topic to ",C.parse(n.message,true)];break;case"pm":if(n.chan==d.current().handler){a=i;n.type="message"}else{if(!t){if(n.name.toLowerCase()==s.nick().toLowerCase()){d.joinPm(n.chan,s.getWholePmIdent(n.uid,n.network));return}else{a=["(PM)",i];d.joinPm(n.name,s.getWholePmIdent(n.uid,n.network));v.make("(PM) <"+n.name+"> "+n.message,n.chan)}}else{return}}break;case"pmaction":if(n.chan==d.current().handler){o=[i," ",r];n.type="action"}else{if(!t){if(n.name.toLowerCase()==s.nick().toLowerCase()){d.joinPm(n.chan,s.getWholePmIdent(n.uid,n.network));return}else{o=["(PM)",i," ",r];d.joinPm(n.name,s.getWholePmIdent(n.uid,n.network));notofication.make("* (PM)"+n.name+" "+n.message,n.chan);n.type="pm"}}else{return}}break;case"highlight":if(n.name.toLowerCase()!="*"){v.make("("+n.chan+") <"+n.name+"> "+n.message,n.chan)}return;case"internal":o=n.message;break;case"server":break;default:return}P.onmessage(a,o,n,t)}};return{setSmileys:e.setSmileys,setSpLinks:e.setSpLinks,parse:e.parse,parseTextDecorations:e.parseTextDecorations,name:e.name,highlight:e.highlight,addLine:e.addLine}}(),S=function(){var e={$errors:false,$warnings:false,errors:[],warnings:[],$errorsPopup:false,$warningsPopup:false,getSinglePopupEntry:function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,n){return["<br>",$("<span>").text(n).html(),": ",$("<span>").text(e).html()]}))},makePopup:function(n,t,i){return $("<div>").addClass("errorPopup").addClass(n.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();i()}),"&nbsp;",$("<b>").text(n),$("<div>").addClass("errorPopupCont").append($.map(t,function(n){return e.getSinglePopupEntry(n)}))).appendTo("body")},init:function(n,t){if(n===undefined){n=$("#errors")}if(t===undefined){t=$("#warnings")}n.click(function(){if(!e.$errorsPopup){e.$errorsPopup=e.makePopup("Errors",e.errors,function(){e.$errorsPopup=false})}});t.click(function(){if(!e.$warningsPopup){e.$warningsPopup=e.makePopup("Warnings",e.warnings,function(){e.$warningsPopup=false})}});e.$errors=n;e.$warnings=t},addError:function(n,t){e.errors.push({time:(new Date).getTime(),file:n,content:t});e.$errors.css("display","").find(".count").text(e.errors.length);if(e.$errorsPopup){e.$errorsPopup.children("div").append(e.getSinglePopupEntry(e.errors[e.errors.length-1]))}},addWarning:function(n,t){e.warnings.push({time:(new Date).getTime(),file:n,content:t});e.$warnings.css("display","").find(".count").text(e.warnings.length);if(e.$warningsPopup){e.$warningsPopup.children("div").append(e.getSinglePopupEntry(e.warnings[e.warnings.length-1]))}}};return{addError:e.addError,addWarning:e.addWarning,init:e.init}}(),y=function(){var e={isBlurred:true,init:function(){$(window).blur(function(){e.isBlurred=true}).focus(function(){e.isBlurred=false})},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+P.settings.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+P.settings.net())}})}};return{init:e.init,changeLinks:e.changeLinks,isBlurred:function(){return e.isBlurred}}}(),x=function(){var e={isOpen:false,open:function(n){if(e.isOpen){return}e.isOpen=true;f.stop(n)},close:function(){if(!e.isOpen){return}e.isOpen=false;d.current().reload()},fetch:function(n,t,s){if(!e.isOpen){return}if(s===undefined){s=0}o.getJSON("Log.php?day="+n+"&offset="+parseInt(s,10)+"&channel="+d.current().handlerB64,function(r){if(!r.banned){$.map(r.lines,function(e){i(e,true)});if(r.lines.length>=1e3){e.fetch(n,t,s+1e3)}else if(t!==undefined){t(true)}}else{p.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');t(false)}})}};return{fetch:e.fetch,open:e.open,close:e.close}}(),P;this.OMNOMIRCSERVER=e;this.settings={loggedIn:s.loggedIn,fetch:s.fetch,net:s.net,getNetwork:s.getNetwork,getPmIdent:s.getPmIdent,getWholePmIdent:s.getWholePmIdent,nick:s.nick,guestLevel:s.guestLevel,identGuest:s.identGuest,logout:s.logout};this.ls={get:r.get,set:r.set};this.network={getJSON:o.getJSON,post:o.post};this.options={get:l.get,set:l.set,getAll:l.getAll};this.instant={current:c.current};this.channels={load:d.load,join:d.join,joinPm:d.joinPm,part:d.part,getList:d.getList,getHandler:d.getHandler,current:d.current,setChans:d.setChans,highlight:d.highlight};this.users={add:g.add,remove:g.remove,setUsers:g.setUsers};this.send={send:p.send,internal:p.internal,val:p.val};this.parser={parse:C.parse,name:C.name,highlight:C.highlight};this.error={addWarning:S.addWarning,addError:S.addError,init:S.init};this.page={changeLinks:y.changeLinks,isBlurred:y.isBlurred};this.logs={fetch:x.fetch,open:x.open,close:x.close};this.statusBar={set:b.set};this.initinput=function(e,n){if(e===undefined){e=$("#message")}t=e;if(n){k.init()}m.init();w.init();t.keypress(function(e){if(e.which==13){e.preventDefault();if(!t.attr("disabled")){p.send(function(){p.val("");t.focus()})}}})};this.connect=function(e){y.init();v.init();s.fetch(function(){c.init();f.init();d.init();e()})};this.disconnect=function(){c.kill();f.kill()};this.setClassPrefix=function(e){n=e};this.onerror=function(){};this.onwarning=function(){};this.onmessage=function(){};this.onmessageraw=false;this.onuserchange=function(){};this.onchannelchange=function(){};this.onchanneljoin=function(){};this.onchannelpart=function(){};this.onsmileychange=function(){};this.onsetval=false;this.ongetval=false;this.ontopicchange=function(){};this.onnotification=function(){};P=this;if(this.setOptions!==undefined){this.options.setAll=l.setAll;this.setOptions();delete this.options.setAll}}