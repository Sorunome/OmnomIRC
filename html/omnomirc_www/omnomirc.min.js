"use strict";function OmnomIRC(){var e="https://omnomirc.omnimaga.org",n="",t=false,s=function(e,n){if(n===undefined){n=false}c.setCurLine(e.curline);if(e.name===null||e.network==-1){return}if(S.onmessageraw!==false){S.onmessageraw(e,n);return}b.addLine(e,n)},i=function(){var e={hostname:"",nick:"",signature:"",numHigh:4,uid:-1,checkLoginUrl:"",net:"",networks:{},pmIdent:false,guestLevel:0,isGuest:true,identGuest:function(n,t,s,i){if(i===undefined){i=s;s=false}console.log("trying login");a.getJSON("misc.php?identName="+base64.encode(n)+"&nick="+base64.encode(n)+"&signature="+base64.encode(t)+"&id=-1&network="+e.getNetwork(),function(t){if(t.success){if(s){r.set("guestName",n);r.set("guestSig",t.signature)}else{r.set("guestName","");r.set("guestSig","")}e.setIdent(n,t.signature,-1);c.identify()}if(i!==undefined){i(t)}},true,false)},logout:function(){r.set("guestName","");r.set("guestSig","");e.setIdent("","",-1);c.identify()},login:function(n,t,s){if(s===undefined){s=-1}e.setIdent(n,t,s);c.identify()},fetch:function(n,t){if(t===undefined){t=false}if(t&&e.loggedIn()&&e.isGuest){console.log("i am silly");e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}});return}a.getJSON("config.php?js"+(document.URL.split("network=")[1]!==undefined?"&network="+document.URL.split("network=")[1].split("&")[0].split("#")[0]:"")+(t?"&clonly":""),function(s){var i;if(!t){e.hostname=s.hostname;f.setChans(s.channels);b.setSmileys(s.smileys);S.onsmileychange(s.smileys);b.setSpLinks(s.spLinks);e.guestLevel=s.guests;e.networks={};$.each(s.networks,function(n,t){e.networks[t.id]=t});e.net=s.network;r.setPrefix(e.net);o.setDefaults(s.defaults);o.setExtraChanMsg(s.extraChanMsg);c.setData(s.websockets.use,s.websockets.host,s.websockets.port,s.websockets.ssl)}e.checkLoginUrl=s.checkLoginUrl;if(e.loggedIn()&&e.isGuest){e.identGuest(e.nick,function(t){if(t.success){e.signature=t.signature}if(n!==undefined){n()}})}else{a.getJSON(e.checkLoginUrl+"&network="+e.net.toString()+"&jsoncallback=?",function(t){e.nick=t.nick;e.signature=t.signature;e.uid=t.uid;e.pmIdent="["+e.net.toString()+","+e.uid.toString()+"]";e.isGuest=t.signature==="";if(n!==undefined){n()}},true,false)}},true,false)},setIdent:function(n,t,s){e.nick=n;e.signature=t;e.uid=s},getUrlParams:function(){return"nick="+base64.encode(e.nick)+"&signature="+base64.encode(e.signature)+"&time="+(+new Date).toString()+"&id="+e.uid+"&network="+e.net+"&noLoginErrors"},getNetwork:function(n){if(e.networks[n]!==undefined){return e.networks[n]}return{id:-1,normal:"NICK",userlist:"NICK",name:"Invalid network",type:-1}},getIdentParams:function(){return{nick:e.nick,signature:e.signature,time:(+new Date).toString(),id:e.uid,network:e.net}},loggedIn:function(){return e.signature!==""},getWholePmIdent:function(n,t){var s="["+t.toString()+","+n.toString()+"]";if(t<e.net){return s+e.pmIdent}else if(e.net<t){return e.pmIdent+s}else if(n<e.uid){return s+e.pmIdent}else{return e.pmIdent+s}}};return{identGuest:e.identGuest,fetch:e.fetch,getUrlParams:e.getUrlParams,getIdentParams:e.getIdentParams,getNetwork:e.getNetwork,nick:function(){return e.nick},net:function(){return e.net},loggedIn:e.loggedIn,guestLevel:function(){return e.guestLevel},getPmIdent:function(){return e.pmIdent},isGuest:function(){return e.isGuest},getWholePmIdent:e.getWholePmIdent,logout:e.logout,login:e.login}}(),r=function(){var e={prefix:document.URL.split("network=")[1]!==undefined?document.URL.split("network=")[1].split("&")[0].split("#")[0]:"",setPrefix:function(n){e.prefix=n},getCookie:function(e){var n,t,s,i=document.cookie.split(";");for(n=0;n<i.length;n++){t=i[n].substr(0,i[n].indexOf("="));s=i[n].substr(i[n].indexOf("=")+1);t=t.replace(/^\s+|\s+$/g,"");if(t==e){return unescape(s)}}},setCookie:function(e,n,t){var s=new Date,i=escape(n);s.setDate(s.getDate()+t);i+=t===null?"":"; expires="+s.toUTCString();document.cookie=e+"="+i},haveSupport:null,support:function(){if(e.haveSupport===null){try{localStorage.setItem("test",1);localStorage.removeItem("test");e.haveSupport=true}catch(n){e.haveSupport=false}}return e.haveSupport},get:function(n){var t;n=e.prefix+n;if(e.support()){t=localStorage.getItem(n)}else{t=e.getCookie(n)}try{return JSON.parse(t)}catch(s){return undefined}},set:function(n,t){n=e.prefix+n;t=JSON.stringify(t);if(e.support()){localStorage.setItem(n,t)}else{e.setCookie(n,t)}}};return{setPrefix:e.setPrefix,get:e.get,set:e.set}}(),a=function(){var e={removeSig:function(e){try{var n=e.split("signature="),t=n[1].split("&");t[0]="---";n[1]=t.join("&");return n.join("signature=")}catch(s){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},addError:function(n,t){n=e.removeSig(n);S.onerror(n,t)},addWarning:function(n,t){n=e.removeSig(n);S.onwarning(n,t)},checkCallback:function(n,t,s,r){if(n.relog!=2){if(n.errors!==undefined){$.map(n.errors,function(n){if(n.type!==undefined){e.addError(r,n)}else{e.addError(r,{type:"misc",message:n})}})}if(n.warnings!==undefined){$.map(n.warnings,function(n){if(n.type!==undefined){e.addWarning(r,n)}else{e.addWarning(r,{type:"misc",message:n})}})}}if(n.relog!==undefined&&n.relog!=0){if(n.relog==1){i.fetch(undefined,true);t(n)}else if(n.relog==2){i.fetch(function(){s()},true)}else{t(n)}}else{if(n.relog!==undefined){e.didRelog=false}t(n)}},getJSON:function(n,t,s,r){if(s==undefined){s=true}if(r==undefined){r=true}if(n.indexOf("?")==-1&&r){n+="?"}var a=n+(r?"&"+i.getUrlParams():"");return $.ajax({url:a,dataType:"json",async:s}).done(function(i){e.checkCallback(i,t,function(){e.getJSON(n,t,s,r)},a)})},post:function(n,t,s,r,a){if(r==undefined){r=true}if(a==undefined){a=true}if(n.indexOf("?")==-1&&a){n+="?"}var o=n+(a?"&"+i.getUrlParams():"");return $.ajax({type:"POST",url:o,async:r,data:t}).done(function(i){e.checkCallback(i,s,function(){e.post(n,t,s,r,a)},o)})}};return{getJSON:e.getJSON,post:e.post}}(),o=function(){var e={extraChanMsg:"",allOptions:{highBold:{disp:"Highlight Bold","default":true},highRed:{disp:"Highlight Red","default":true},colordNames:{disp:"Colored Names","default":0,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(n,t){return $("<option>").attr(e.get("colordNames")==t?"selected":"false","selected").val(t).text(n)})))}},curChan:{hidden:true,"default":0},extraChans:{disp:"Show extra Channels","default":false,before:function(){if(e.extraChanMsg!==""){alert(e.extraChanMsg)}return true}},ding:{disp:"Ding on Highlight","default":false},smileys:{disp:"Show Smileys","default":true},charsHigh:{disp:"Number chars for Highlighting","default":4,handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){e.set("charsHigh",this.value)}).append($.map([1,2,3,4,5,6,7,8,9,10],function(n){return $("<option>").attr(e.get("charsHigh")==n?"selected":"false","selected").val(n).text(n)})))}},oircJoinPart:{disp:"Show OmnomIRC join/part messages","default":false},textDeco:{disp:"Enable simple text decorations","default":false},statusBar:{disp:"Show Updates in Browser Status Bar","default":true},browserNotifications:{disp:"Browser Notifications","default":false,before:function(){k.request();return false}}},set:function(n,t){if(e.allOptions[n]===undefined){return}e.allOptions[n].value=t;var s=r.get("options")||{};s[n]=t;r.set("options",s)},get:function(n){if(e.allOptions[n]!==undefined){return e.allOptions[n].value}},setExtraChanMsg:function(n){e.extraChanMsg=n},setDefaults:function(n){var t=r.get("options");$.each(e.allOptions,function(s,i){var r=i.default;if(t&&t[s]!==undefined){r=t[s]}else if(n&&n[s]!==undefined){r=n[s]}e.allOptions[s].value=r})},getAll:function(n){if(n){return e.allOptions}var t={};$.each(e.allOptions,function(e,n){if(n.hidden===undefined||!n.hidden){t[e]=n.value}});return t},setAll:function(n){e.allOptions=n}};return{set:e.set,get:e.get,setDefaults:e.setDefaults,setExtraChanMsg:e.setExtraChanMsg,getAll:e.getAll,setAll:e.setAll}}(),l=function(){var e={id:Math.random().toString(36)+(new Date).getTime().toString(),update:function(){r.set("browserTab",e.id);r.set("newInstant",false)},init:function(){r.set("browserTab",e.id);$(window).focus(function(){e.update()}).unload(function(){e.kill()})},current:function(){if(r.get("newInstant")){e.update()}return e.id==r.get("browserTab")},kill:function(){r.set("newInstant",true);$(window).off("focus").off("unload")}};return{init:e.init,current:e.current,kill:e.kill}}(),c=function(){var e={ws:{socket:false,connected:false,use:true,sendBuffer:[],allowLines:false,enabled:false,host:"",port:0,ssl:true,tryFallback:true,didRelog:false,fallback:function(){console.log("trying fallback...");if(e.ws.tryFallback){try{e.ws.tryFallback=false;e.ws.socket.close()}catch(n){}a.getJSON("misc.php?getcurline&noLoginErrors",function(n){e.setCurLine(n.curline);e.ws.use=false;e.old.lastSuccess=(new Date).getTime();e.old.start()})}},identify:function(){e.ws.send($.extend({action:"ident"},i.getIdentParams()));e.ws.send({action:"charsHigh",chars:o.get("charsHigh")})},init:function(){if(!("WebSocket"in window)||!e.ws.enabled){e.ws.use=false;return false}try{var n=window.location.pathname.split("/");n.pop();if(n.length>1&&n[n.length-1]===""){n.pop()}n.push("ws");n.push(i.net());e.ws.socket=new PooledWebSocket((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"))}catch(t){console.log(e.ws.socket);console.log((e.ws.ssl?"wss://":"ws://")+e.ws.host+":"+e.ws.port.toString()+n.join("/"));console.log(t);e.ws.fallback()}e.ws.socket.onopen=function(n){e.ws.connected=true;for(var t=0;t<e.ws.sendBuffer.length;t++){e.ws.send(e.ws.sendBuffer[t])}e.ws.sendBuffer=[]};e.ws.socket.onmessage=function(n){try{var t=JSON.parse(n.data);console.log(t);if(e.ws.allowLines&&t.line!==undefined){if(s(t.line)){e.ws.tryFallback=false;delete e.ws.socket}}if(t.relog!==undefined&&t.relog!=0&&t.relog<3){if(!e.ws.didRelog){e.ws.didRelog=true;i.fetch(function(){if(i.loggedIn()){e.ws.identify();e.ws.didRelog=false}},true)}}}catch(n){}};e.ws.socket.onclose=function(n){console.log("CLOOOOOOOOOSE");console.log(n);e.ws.use=false;e.ws.fallback()};e.ws.socket.onerror=function(n){console.log("ERRRORRRR");console.log(n);delete e.ws.socket;e.ws.use=false;e.ws.fallback()};e.ws.identify();$(window).on("beforeunload",function(){e.partChan(f.current().handler);delete e.ws.socket});return true},send:function(n){if(e.ws.connected){e.ws.socket.send(JSON.stringify(n))}else{e.ws.sendBuffer.push(n)}}},old:{inRequest:false,handler:false,lastSuccess:(new Date).getTime(),fnCallback:undefined,chan:"",sendRequest:function(){if(!e.old.chan){return}e.old.handler=a.getJSON("Update.php?high="+o.get("charsHigh").toString()+"&channel="+e.old.chan+"&lineNum="+e.curLine.toString(),function(n){e.old.handler=false;e.old.lastSuccess=(new Date).getTime();if(n.lines!==undefined){$.map(n.lines,function(e){s(e)})}if(n.errors!=undefined&&n.errors.length>=1){return}if(n.banned!==true){e.old.setTimer()}}).fail(function(){e.old.handler=false;if(e.fnCallback!=undefined){e.fnCallback();e.fnCallback=undefined;return}if((new Date).getTime()>=e.old.lastSuccess+3e5){h.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!e.old.inRequest){e.old.lastSuccess=(new Date).getTime()}else{e.old.setTimer()}})},setTimer:function(){if(e.old.inRequest&&f.current().loaded&&e.old.handler===false){setTimeout(function(){e.old.sendRequest()},C.isBlurred()?2500:200)}else{e.old.stop()}},start:function(){if(!e.old.inRequest){e.old.inRequest=true;e.old.setTimer()}},stop:function(n){if(e.old.inRequest){e.old.inRequest=false;if(e.old.handler){e.fnCallback=n;e.old.handler.abort()}else if(n!==undefined){n()}}else if(n!==undefined){n()}},send:function(e,n,t){a.getJSON("message.php?message="+base64.encode(e)+"&channel="+n,function(e){if(t!==undefined){t(e)}})}},curLine:0,joinChan:function(n){if(e.ws.use){e.ws.send({action:"joinchan",chan:n})}if(parseInt(n,10)!=n){n=base64.encode(n)}e.old.chan=n},partChan:function(n){if(e.ws.use){e.ws.send({action:"partchan",chan:n})}},stop:function(n){if(e.ws.use){e.ws.allowLines=false;n()}else{e.old.stop(n)}},kill:function(){if(e.ws.use){e.ws.socket.onclose=function(){};e.ws.socket.close()}else{e.old.stop()}},start:function(){if(e.ws.use){e.ws.allowLines=true}else{e.old.start()}},setCurLine:function(n){if(n>e.curLine){e.curLine=n}},send:function(n,t,s){if(e.ws.use){e.ws.send({action:"message",channel:t,message:n});if(s!==undefined){s()}}else{if(parseInt(t,10)!=t){t=base64.encode(t)}e.old.send(n,t,s)}},setData:function(n,t,s,i){e.ws.enabled=n;e.ws.host=t;e.ws.port=s;e.ws.ssl=i},init:function(){if(e.ws.enabled){e.ws.init()}else{e.ws.use=false;e.old.lastSuccess=(new Date).getTime()}},identify:function(){if(e.ws.enabled){e.ws.identify()}}};return{joinChan:e.joinChan,partChan:e.partChan,start:e.start,stop:e.stop,kill:e.kill,setCurLine:e.setCurLine,send:e.send,setData:e.setData,init:e.init,identify:e.identify}}(),f=function(){var e=function(e){var t=n.chans[e]!==undefined,i={i:e,name:t?n.chans[e].chan.toLowerCase():"",handler:t?n.getHandler(e):-1,handlerB64:t?n.getHandler(e,true):-1,loaded:false,load:function(n){if(n.lines===undefined){if(n.message){h.internal(n.message)}else{h.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}return false}o.set("curChan",e);if(n.banned){h.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');return false}d.setUsers(n.users);$.each(n.lines,function(e,n){s(n,true)});i.loaded=true;return true},unload:function(){if(i.loaded){c.partChan(i.handler)}},part:function(){n.part(n.i)},reloadUserlist:function(){if(!t){return}a.getJSON("Load.php?userlist&channel="+i.handlerB64,function(e){if(!e.banned){if(e.users){d.setUsers(e.users)}}else{h.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})},reload:function(){S.onchanneljoin(i.name)},setI:function(e){i.i=e},is:function(e){return e==i.i}};return{name:i.name,handler:i.handler,handlerB64:i.handlerB64,load:i.load,part:i.part,reload:i.reload,unload:i.unload,loaded:function(){return i.loaded},setI:i.setI,is:i.is,reloadUserlist:i.reloadUserlist}},n={current:false,chans:[],save:function(){r.set("channels",n.chans)},loadSettings:function(){try{var e=r.get("channels"),t=$.map(n.chans,function(e){if(e.ex&&o.get("extraChans")||!e.ex){return e}return undefined}),s=[];if(e!==null&&e!=[]){n.chans=$.merge($.map(e,function(e){if(e.id!=-1&&e.id.toString().substr(0,1)!="*"){var t=false;$.each(n.chans,function(n,i){if(i.id==e.id){s.push(e);t=true;e.chan=i.chan;return false}});if(!t){return undefined}}return e}),$.map(t,function(e){var n=false;$.each(s,function(t,s){if(s.id==e.id){n=true;e.chan=s.chan;return false}});if(n){return undefined}return e}));save()}}catch(i){}S.onchannelchange(n.chans)},init:function(){n.current=e(-1);n.loadSettings()},addChan:function(e,t){var s=true;if(t===undefined){t=-1}e=e.toLowerCase();$.each(n.chans,function(n,t){if(t.chan==e){s=n}});if(s===true){if(e[0]=="#"){h.internal('<span style="color:#C73232;">Join Error: Cannot join new channels starting with #.</span>');return-1}n.chans.push({chan:e,high:false,ex:false,id:t,order:-1});n.save();S.onchannelchange(n.chans);return n.chans.length-1}return s},getHandler:function(e,t){if(n.chans[e].id!=-1){if(typeof n.chans[e].id!="number"&&t){return base64.encode(n.chans[e].id)}return n.chans[e].id.toString()}if(t){return base64.encode(n.chans[e].chan)}return n.chans[e].chan},requestHandler:false,load:function(t,s){if(s===undefined){s=function(){}}if(n.chans[t]===undefined){s(false,{});return}c.stop(function(){if(n.requestHandler!==false){n.requestHandler.abort()}n.requestHandler=a.getJSON("Load.php?count=125&channel="+n.getHandler(t,true),function(i){o.set("curChan",t);n.current=e(t);if(n.current.load(i)){n.chans[t].high=false;n.save();c.joinChan(n.getHandler(t));c.start();p.load();m.read();s(true,i);return}s(false,{})})})},join:function(e){var t=true;e=e.trim();if(!e){return-1}if(e[0]!="@"&&e[0]!="#"){e="@"+e}return n.addChan(e)},joinPm:function(e,t,s){if(s===undefined){s=function(){}}var i=true,r=function(t,i){t=t.trim();if(t.substr(0,1)!="*"){t="*"+e}i=i.trim();if(i.substr(0,1)!="*"){i="*"+i}s(n.addChan(t,i))};if(t==""){if(e.substr(0,1)=="@"||e.substr(0,1)=="#"){h.internal('<span style="color:#C73232;">Query Error: Cannot query a channel. Use /join instead.</span>');s(-1);return}a.getJSON("misc.php?openpm="+base64.encode(e),function(e){if(e.channick){r(e.channick,e.chanid)}else{h.internal('<span style="color:#C73232;">Query Error: User not found.</span>');s(-1)}})}else{r(e,t)}},part:function(e){if(parseInt(e,10)==e){e=parseInt(e,10)}if(typeof e!="number"){if(e&&e[0]!="@"&&e[0]!="#"&&e[0]!="*"){e="@"+e}$.each(n.chans,function(n,t){if(t.chan==e){e=n;return false}})}if(typeof e!="number"||n.chans[e]===undefined){h.internal('<span style="color:#C73232;"> Part Error: can\'t part '+e+". (You are not in it.)</span>");return false}if(n.chans[e].chan[0]=="#"){h.internal('<span style="color:#C73232;"> Part Error: can\'t part '+n.chans[e].chan+". (IRC channel.)</span>");return false}var t=n.chans[e].chanId,s=false;if(n.current.is(e)){s=true}if(t==-1){t=n.chans[e]}c.partChan(n.getHandler(e));n.chans.splice(e,1);n.save();S.onchannelchange(n.chans);if(s){S.onchanneljoin(n.chans[e-1].chan)}return true},getList:function(){return n.chans},setChans:function(e){n.chans=e;if(n.current){n.save();S.onchannelchange(n.chans)}},getNames:function(){return $.map(n.chans,function(e){return e.chan})},highlight:function(e){$.each(n.chans,function(t,s){if(e==s.id||s.chan.toLowerCase()==e.toString().toLowerCase()){n.chans[t].high=true;return false}});n.save();S.onchannelchange(n.chans)}};return{init:n.init,load:n.load,join:n.join,joinPm:n.joinPm,part:n.part,getList:n.getList,getHandler:n.getHandler,current:function(){return n.current},setChans:n.setChans,getNames:n.getNames,highlight:n.highlight}}(),d=function(){var e={users:[],draw:function(){e.users.sort(function(e,n){var t=e.nick.toLowerCase(),s=n.nick.toLowerCase();return t==s?e==n?0:e<n?-1:1:t<s?-1:1});S.onuserchange(e.users)},exists:function(n){var t=false;$.each(e.users,function(e,n){if(n.nick.toLowerCase()==u.nick.toLowerCase()&&n.network==u.network){t=true;return false}});return t},add:function(n){if(f.current().handler!==""){var t=true;$.each(e.users,function(e,s){if(s.nick==n.nick&&s.network==n.network){t=false;return false}});if(t){e.users.push(n);e.draw()}}},remove:function(n){if(f.current().handler!==""){$.each(e.users,function(t,s){if(s.nick==n.nick&&s.network==n.network){e.users.splice(t,1);return false}});e.draw()}},setUsers:function(n){e.users=n;e.draw()},getNames:function(){return $.map(e.users,function(e){return e.nick})}};return{add:e.add,remove:e.remove,setUsers:e.setUsers,getNames:e.getNames}}(),g=function(){var n={parse:function(n){var t=n.split(" ")[0].toLowerCase(),s=n.substr(t.length+1).toLowerCase().trim();switch(t){case"j":case"join":if(i.isGuest()){h.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t join as guest</span>')}else{S.onchanneljoin(s)}return true;case"q":case"query":if(i.isGuest()){h.internal('<span style="color:#C73232;"><b>ERROR:</b> can\'t query as guest</span>')}else{S.onchanneljoin("*"+s)}return true;case"win":case"w":case"window":var r=f.getList()[parseInt(s,10)];if(r!==undefined){S.onchanneljoin(r.chan)}return true;case"p":case"part":if(s!==""){S.onchannelpart(s)}else{S.onchannelpart(f.current().name)}return true;case"help":h.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');h.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){h.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}};return{parse:n.parse}}(),h=function(){var e={sending:false,send:function(n,t,i){if(typeof n==="string"){t=n;n=undefined}if(n===undefined){n=function(){}}if(t===undefined){t=h.val()}if(!t){n();return}m.add(t);if(t!==""&&o.get("textDeco")){if(t[0]==">"){t="3"+t}t=t.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}if(i===undefined){i=f.current().handler}if(t[0]=="/"&&g.parse(t.substr(1))){n()}else{if(!e.sending){e.sending=true;c.send(t,i,function(t){if(t!==undefined&&t.lines!==undefined){$.map(t.lines,function(e){s(e)})}e.sending=false;n()})}}},internal:function(e){s({curLine:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:f.current().handler})},val:function(e){if(e===undefined){if(S.ongetval===false){if(t.is("input")){return t.val()}return t.text()}return S.ongetval()}if(S.onsetval===false){if(t.is("input")){t.val(e)}else{t.text(e)}}else{S.onsetval(e)}}};return{internal:e.internal,send:e.send,val:e.val}}(),p=function(){var e={tabWord:"",tabCount:0,isInTab:false,startPos:0,startChar:"",endPos:0,endChar:"",endPos0:0,tabAppendStr:"",searchArray:[],node:false,wysiwyg:false,getCurrentWord:function(){var n=!e.wysiwyg?t[0].value:(e.node=window.getSelection().anchorNode).nodeValue;if(e.isInTab){return e.tabWord}e.startPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.startChar=n.charAt(e.startPos);while(e.startChar!=" "&&--e.startPos>0){e.startChar=n.charAt(e.startPos)}if(e.startChar==" "){e.startPos++}e.endPos=!e.wysiwyg?t[0].selectionStart:window.getSelection().anchorOffset;e.endChar=n.charAt(e.endPos);while(e.endChar!=" "&&++e.endPos<=n.length){e.endChar=n.charAt(e.endPos)}e.endPos0=e.endPos;e.tabWord=n.substr(e.startPos,e.endPos-e.startPos).trim();return e.tabWord},getTabComplete:function(){var n=!e.wysiwyg?t[0].value:e.node.nodeValue,s;if(n===null){return}s=e.search(e.getCurrentWord(),e.tabCount);if(!e.isInTab){e.tabAppendStr=" ";if(e.startPos===0){e.tabAppendStr=": "}}if(s==e.getCurrentWord()){e.tabCount=0;s=e.search(e.getCurrentWord(),e.tabCount)}n=n.substr(0,e.startPos)+s+e.tabAppendStr+n.substr(e.endPos+1);if(!e.wysiwyg){t[0].value=n}else{window.getSelection().anchorNode.nodeValue=n;window.getSelection().getRangeAt(0).setEnd(e.node,e.startPos+s.length+e.tabAppendStr.length);window.getSelection().getRangeAt(0).setStart(e.node,e.startPos+s.length+e.tabAppendStr.length)}e.endPos=e.endPos0+s.length+e.tabAppendStr.length},search:function(n,t){var s=false;if(!t){t=0}$.each(e.searchArray,function(e,i){if(i.toLowerCase().indexOf(n.toLowerCase())===0&&t--<=0&&s===false){s=i}});if(s!==false){return s}return n},init:function(){e.wysiwyg=!t.is("input");t.keydown(function(n){if(n.keyCode==9){if(!n.ctrlKey){n.preventDefault();e.getTabComplete();e.isInTab=true;e.tabCount++;setTimeout(1,1)}}else{e.tabWord="";e.tabCount=0;e.isInTab=false}})},load:function(){e.searchArray=$.merge(d.getNames(),f.getNames())}};return{init:e.init,load:e.load}}(),m=function(){var e={messages:[],counter:0,current:"",init:function(){t.keydown(function(n){if(n.keyCode==38||n.keyCode==40){n.preventDefault();if(e.counter==e.messages.length){e.current=h.val()}if(e.messages.length!==0){if(n.keyCode==38){if(e.counter!==0){e.counter--}h.val(e.messages[e.counter])}else{if(e.counter!=e.messages.length){e.counter++}if(e.counter==e.messages.length){h.val(e.current)}else{h.val(e.messages[e.counter])}}}}})},add:function(n){e.messages.push(n);if(e.messages.length>20){e.messages.shift()}e.counter=e.messages.length;S.ls.set("oldMessages-"+S.channels.current().handlerB64,e.messages)},read:function(){e.messages=S.ls.get("oldMessages-"+S.channels.current().handlerB64);if(!e.messages){e.messages=[]}console.log(e.messages);e.counter=e.messages.length}};return{init:e.init,add:e.add,read:e.read}}(),w=function(){var e={text:"",started:false,start:function(){if(!o.get("statusBar")){e.started=true;return}if(!e.started){setInterval(function(){window.status=e.text;if(parent){try{parent.window.status=e.text}catch(n){}}},500);e.started=true}},set:function(n){e.text=n;if(!e.started){e.start()}}};return{set:e.set}}(),k=function(){var e={support_webkit:window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,support:function(){return typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"},show:function(n){var t;if(e.support_webkit){t=window.webkitNotifications.createNotification("omni.png","OmnomIRC Highlight",n);t.show()}else if(e.support()){t=new Notification("OmnomIRC Highlight",{icon:"omni.png",body:n});t.onshow=function(){setTimeout(t.close,3e4)}}},request:function(){if(e.support_webkit){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.show("Notifications Enabled!");S.options.set("browserNotifications",true);document.location.reload()}})}else if(e.support()){Notification.requestPermission(function(n){if(Notification.permission!==n){Notification.permission=n}if(n==="granted"){e.show("Notifications Enabled!");S.options.set("browserNotifications",true);document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},sound:false,make:function(n,t){var s=l.current();if(s){if(o.get("browserNotifications")){e.show(n)}if(o.get("ding")&&e.sound){e.sound.play()}}e.startFlash();S.onnotification(n,t,s)},doFlash:false,intervalHandler:false,originalTitle:"",target:top.postMessage?top:top.document.postMessage?top.document:undefined,startFlash:function(){if(e.doFlash){return}e.doFlash=true;if(top==window){var n=false;e.originalTitle=document.title;e.intervalHandler=setInterval(function(){document.title=(n?"[ @] ":"[@ ] ")+e.originalTitle;n=!n},500)}else{if(e.target!==undefined){e.target.postMessage("startFlash","*")}}},stopFlash:function(n){if(n===undefined){n=false}if(e.doFlash){if(top==window){if(e.intervalHandler){clearInterval(e.intervalHandler);e.intervalHandler=false;document.title=e.originalTitle}}else{if(e.target!==undefined){e.target.postMessage("stopFlash","*")}}e.doFlash=false;if(!n){S.ls.set("stopFlash",Math.random().toString(36)+(new Date).getTime().toString())}}},init:function(){$(window).on("storage",function(n){if(n.originalEvent.key==i.net()+"stopFlash"){e.stopFlash(true)}}).unload(function(){e.stopFlash(true)}).focus(function(){e.stopFlash()});if(!e.sound){e.sound=new Audio("beep.mp3")}}};return{request:e.request,make:e.make,init:e.init}}(),b=function(){var e={smileys_a:[],cacheServerNicks:{},spLinks:[],name:function(t,s,r){if(r===undefined){r=-1}t=t=="\0"?"":t;var l=encodeURIComponent(t);t=$("<span>").text(t).html();var u=[19,20,22,24,25,26,27,28,29],c=0,f=0,d=t,g=i.getNetwork(s),h=true;switch(o.get("colordNames")){case"1":while(t[f]){c+=t.charCodeAt(f++)}d=$("<span>").append($("<span>").addClass(n+"uName-"+u[c%9].toString()).html(t)).html();break;case"2":if(g!==undefined&&g.checkLogin!==undefined&&r!=-1){h=false;if(e.cacheServerNicks[s.toString()+":"+r.toString()]===undefined){a.getJSON(g.checkLogin+"?c="+r.toString(10)+"&n="+l,function(n){e.cacheServerNicks[s.toString()+":"+r.toString()]=n.nick},false,false)}d=e.cacheServerNicks[s.toString()+":"+r.toString()]}else{d=t}break;default:d=t;break}if(g!==undefined&&h){d=g.normal.split("NICKENCODE").join(l).split("NICK").join(d).split("USERID").join(r.toString(10))}if(g!==undefined){return'<span title="'+g.name+'">'+d+"</span>"}return'<span title="Unknown Network">'+d+"</span>"},smileys:function(n){if(!n){return""}if(/^[\w\s\d\.,!?]*$/.test(n)){return n}$.each(e.smileys_a,function(e,t){n=n.replace(RegExp(t.regex,"g"),t.replace)});return n},links:function(n){if(!n||n===null||n===undefined){return""}var t='[^\\s<"]';n=n.replace(RegExp("(|)","g"),"");$.map(e.spLinks,function(e){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");n=n.replace(RegExp("(^|[\\s>])((?:(?:f|ht)tps?://(?:www\\.)?)"+e+t+"*)","g"),"$1$2").replace(RegExp("(^|[\\s>])("+e+t+"*)","g"),"$1$2")});return n.replace(RegExp('(^|[^a-zA-Z0-9_"])((?:(?:f|ht)tps?://)'+t+"+)","g"),'$1<a target="_blank" href="$2">$2</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+t+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+t+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},colors:function(e){var t=[],s,i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},r,a;if(!e){return""}t=e.split(RegExp("([])"));e="<span>";for(r=0;r<t.length;r++){a=true;switch(t[r]){case"":s=t[r+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(s==t[r+1]){s=t[r+1].replace(/^([0-9]{1,2}).*/,"$1:");if(s!=t[r+1]){i.fg=s.split(":")[0];t[r+1]=t[r+1].substr(s.length-1)}else{i.fg="-1";i.bg="-1"}}else{i.fg=s.split(":")[0];i.bg=s.split(":")[1];if(s==t[r+1]){t[r+1]=""}else{t[r+1]=t[r+1].substr(s.length)}}break;case"":i.bold=!i.bold;break;case"":i.italic=!i.italic;break;case"":s=i.fg;i.fg=i.bg;i.bg=s;if(i.fg=="-1"){i.fg="0"}if(i.bg=="-1"){i.bg="1"}break;case"":i.underline=!i.underline;break;case"":i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:a=false}if(a){e+="</span>"+'<span class="'+n+"fg-"+i.fg+" "+n+"bg-"+i.bg+'" style="'+(i.bold?"font-weight:bold;":"")+(i.underline?"text-decoration:underline;":"")+(i.italic?"font-style:italic;":"")+'">'}else{e+=t[r]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},highlight:function(e){var n="";if(!o.get("highRed")){n+="background:none;padding:none;border:none;"}if(o.get("highBold")){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"},parse:function(n,t){if(t==undefined||!t){t=false}n=n=="\0"?"":n;n=$("<span>").text(n).html();if(o.get("smileys")&&t===false){n=e.smileys(n)}n=e.colors(n);n=e.links(n);return n},setSmileys:function(n){e.smileys_a=[];$.each(n,function(n,t){e.smileys_a.push({regex:t.regex,replace:t.replace.split("ADDSTUFF").join('data-code="'+t.code+'"').split("PIC").join(t.pic).split("ALT").join(t.alt)})});console.log(e.smileys_a)},setSpLinks:function(n){e.spLinks=n},parseTextDecorations:function(e){if(e!==""&&o.get("textDeco")){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e},addLine:function(n,t){if(n.type!="highlight"&&n.chan.toString().toLowerCase()!=f.current().handler.toLowerCase()&&n.name2!==i.getPmIdent()){return}var s=e.name(n.name,n.network,n.uid),r=e.parse(n.message),a="*",l=r;if(i.nick()!=""&&["message","action","pm","pmaction"].indexOf(n.type)>=0&&n.name.toLowerCase()!="*"&&r.toLowerCase().indexOf(i.nick().toLowerCase().substr(0,o.get("charsHigh")))>=0){l=r=b.highlight(r);if(!t&&C.isBlurred()){k.make("("+f.current().name+") <"+n.name+"> "+n.message,n.chan)}}switch(n.type){case"reload":if(!t){f.current().reload()}return;case"reload_userlist":if(!t){f.current().reloadUserlist()}return;case"relog":if(!t){i.fetch(undefined,true)}return;case"refresh":if(!t){location.reload(true)}return;case"join":l=[s," has joined "+f.current().name];if(!t){d.add({nick:n.name,network:n.network})}if(i.getNetwork(n.network).type==1&&!o.get("oircJoinPart")){return}break;case"part":l=[s," has left "+f.current().name+" (",r,")"];if(!t){d.remove({nick:n.name,network:n.network})}if(i.getNetwork(n.network).type==1&&!o.get("oircJoinPart")){return}break;case"quit":l=[s," has quit IRC (",r,")"];if(!t){d.remove({nick:n.name,network:n.network})}if(i.getNetwork(n.network).type==1&&!o.get("oircJoinPart")){return}break;case"kick":l=[s," has kicked ",b.name(n.name2,n.network)," from "+f.current().name+" (",r,")"];if(!t){d.remove({nick:n.name2,network:n.network})}break;case"message":a=s;break;case"action":l=[s," ",r];break;case"mode":if(typeof r=="string"){r=n.message.split(" ");
$.each(r,function(e,t){var s=$("<span>").html(t).text();if(s.indexOf("+")==-1&&s.indexOf("-")==-1){r[e]=b.name(t,n.network)}});r=r.join(" ")}l=[s," set "+f.current().name+" mode ",r];break;case"nick":l=[s," has changed nicks to ",b.name(n.name2,n.network)];if(!t){d.add({nick:n.name2,network:n.network});d.remove({nick:n.name,network:n.network})}break;case"topic":S.ontopicchange(b.parse(n.message,true));if(n.name===""&&n.network===0&&t){return}l=[s," has changed the topic to ",b.parse(n.message,true)];break;case"pm":if(n.chan==f.current().handler){a=s;n.type="message"}else{if(!t){if(n.name.toLowerCase()==i.nick().toLowerCase()){f.joinPm(n.chan,i.getWholePmIdent(n.uid,n.network));return}else{a=["(PM)",s];f.joinPm(n.name,i.getWholePmIdent(n.uid,n.network));k.make("(PM) <"+n.name+"> "+n.message,n.chan)}}else{return}}break;case"pmaction":if(n.chan==f.current().handler){l=[s," ",r];n.type="action"}else{if(!t){if(n.name.toLowerCase()==i.nick().toLowerCase()){f.joinPm(n.chan,i.getWholePmIdent(n.uid,n.network));return}else{l=["(PM)",s," ",r];f.joinPm(n.name,i.getWholePmIdent(n.uid,n.network));notofication.make("* (PM)"+n.name+" "+n.message,n.chan);n.type="pm"}}else{return}}break;case"highlight":if(n.name.toLowerCase()!="*"){k.make("("+n.chan+") <"+n.name+"> "+n.message,n.chan)}return;case"internal":l=n.message;break;case"server":break;default:return}S.onmessage(a,l,n,t)}};return{setSmileys:e.setSmileys,setSpLinks:e.setSpLinks,parse:e.parse,parseTextDecorations:e.parseTextDecorations,name:e.name,highlight:e.highlight,addLine:e.addLine}}(),v=function(){var e={$errors:false,$warnings:false,errors:[],warnings:[],$errorsPopup:false,$warningsPopup:false,getSinglePopupEntry:function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,n){return["<br>",$("<span>").text(n).html(),": ",$("<span>").text(e).html()]}))},makePopup:function(n,t,s){return $("<div>").addClass("errorPopup").addClass(n.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();s()}),"&nbsp;",$("<b>").text(n),$("<div>").addClass("errorPopupCont").append($.map(t,function(n){return e.getSinglePopupEntry(n)}))).appendTo("body")},init:function(n,t){if(n===undefined){n=$("#errors")}if(t===undefined){t=$("#warnings")}n.click(function(){if(!e.$errorsPopup){e.$errorsPopup=e.makePopup("Errors",e.errors,function(){e.$errorsPopup=false})}});t.click(function(){if(!e.$warningsPopup){e.$warningsPopup=e.makePopup("Warnings",e.warnings,function(){e.$warningsPopup=false})}});e.$errors=n;e.$warnings=t},addError:function(n,t){e.errors.push({time:(new Date).getTime(),file:n,content:t});e.$errors.css("display","").find(".count").text(e.errors.length);if(e.$errorsPopup){e.$errorsPopup.children("div").append(e.getSinglePopupEntry(e.errors[e.errors.length-1]))}},addWarning:function(n,t){e.warnings.push({time:(new Date).getTime(),file:n,content:t});e.$warnings.css("display","").find(".count").text(e.warnings.length);if(e.$warningsPopup){e.$warningsPopup.children("div").append(e.getSinglePopupEntry(e.warnings[e.warnings.length-1]))}}};return{addError:e.addError,addWarning:e.addWarning,init:e.init}}(),C=function(){var e={isBlurred:true,init:function(){$(window).blur(function(){e.isBlurred=true}).focus(function(){e.isBlurred=false})},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+S.settings.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+S.settings.net())}})}};return{init:e.init,changeLinks:e.changeLinks,isBlurred:function(){return e.isBlurred}}}(),y=function(){var e={isOpen:false,open:function(n){if(e.isOpen){return}e.isOpen=true;c.stop(n)},close:function(){if(!e.isOpen){return}e.isOpen=false;f.current().reload()},fetch:function(n,t,i){if(!e.isOpen){return}if(i===undefined){i=0}a.getJSON("Log.php?day="+n+"&offset="+parseInt(i,10)+"&channel="+f.current().handlerB64,function(r){if(!r.banned){$.map(r.lines,function(e){s(e,true)});if(r.lines.length>=1e3){e.fetch(n,t,i+1e3)}else if(t!==undefined){t(true)}}else{h.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');t(false)}})}};return{fetch:e.fetch,open:e.open,close:e.close}}(),S;this.OMNOMIRCSERVER=e;this.settings={loggedIn:i.loggedIn,fetch:i.fetch,net:i.net,getNetwork:i.getNetwork,getPmIdent:i.getPmIdent,getWholePmIdent:i.getWholePmIdent,nick:i.nick,guestLevel:i.guestLevel,identGuest:i.identGuest,logout:i.logout};this.ls={get:r.get,set:r.set};this.network={getJSON:a.getJSON,post:a.post};this.options={get:o.get,set:o.set,getAll:o.getAll};this.instant={current:l.current};this.channels={load:f.load,join:f.join,joinPm:f.joinPm,part:f.part,getList:f.getList,getHandler:f.getHandler,current:f.current,setChans:f.setChans,highlight:f.highlight};this.users={add:d.add,remove:d.remove,setUsers:d.setUsers};this.send={send:h.send,internal:h.internal,val:h.val};this.parser={parse:b.parse,name:b.name,highlight:b.highlight};this.error={addWarning:v.addWarning,addError:v.addError,init:v.init};this.page={changeLinks:C.changeLinks,isBlurred:C.isBlurred};this.logs={fetch:y.fetch,open:y.open,close:y.close};this.statusBar={set:w.set};this.initinput=function(e){if(e===undefined){e=$("#message")}t=e;p.init();m.init()};this.connect=function(e){C.init();k.init();i.fetch(function(){l.init();c.init();f.init();e()})};this.disconnect=function(){l.kill();c.kill()};this.setClassPrefix=function(e){n=e};this.onerror=function(){};this.onwarning=function(){};this.onmessage=function(){};this.onmessageraw=false;this.onuserchange=function(){};this.onchannelchange=function(){};this.onchanneljoin=function(){};this.onchannelpart=function(){};this.onsmileychange=function(){};this.onsetval=false;this.ongetval=false;this.ontopicchange=function(){};this.onnotification=function(){};S=this;if(this.setOptions!==undefined){this.options.setAll=o.setAll;this.setOptions();delete this.options.setAll}}