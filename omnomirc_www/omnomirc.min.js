/**
 * @license
 * OmnomIRC COPYRIGHT 2010,2011 Netham45
 *                    2012-2015 Sorunome
 *
 *  This file is part of OmnomIRC.
 *
 *  OmnomIRC is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  OmnomIRC is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with OmnomIRC.  If not, see <http://www.gnu.org/licenses/>.
 */
oirc=function(){var e="https://omnomirc.omnimaga.org",t=function(){var e="",a="",r="",s=4,c=0,l="",d="",p=[];return{fetch:function(s,g){if(g===undefined){g=false}i.getJSON("config.php?js"+(document.URL.split("network=")[1]!==undefined?"&network="+document.URL.split("network=")[1].split("&")[0].split("#")[0]:"")+(g?"&clonly":""),function(h){var m;if(!g){e=h.hostname;f.setChans(h.channels);parser.setSmileys(h.smileys);p=h.networks;d=h.network;o.setDefaults(h.defaults);o.setExtraChanMsg(h.extraChanMsg);u.set(h.websockets.use,h.websockets.host,h.websockets.port,h.websockets.ssl)}l=h.checkLoginUrl;m=n.get("OmnomIRCCL"+t.net());if(m===null||m==""||!m||g){i.getJSON(l+"&network="+d.toString()+"&jsoncallback=?",function(e){a=e.nick;r=e.signature;c=e.uid;n.set("OmnomIRCCL"+t.net(),JSON.stringify({nick:a,signature:r,uid:c}));if(s!==undefined){s()}},!g,false)}else{m=JSON.parse(m);a=m.nick;r=m.signature;c=m.uid;if(s!==undefined){s()}}},!g,false)},getUrlParams:function(){return"nick="+base64.encode(a)+"&signature="+base64.encode(r)+"&time="+(+new Date).toString()+"&id="+c+"&network="+d+(a!=""?"&noLoginErrors":"")},getIdentParams:function(){return{nick:a,signature:r,time:(+new Date).toString(),id:c,network:d}},networks:function(){return p},nick:function(){return a},net:function(){return d},loggedIn:function(){return r!==""}}}(),n=function(){var e=function(e){var t,n,i,a=document.cookie.split(";");for(t=0;t<a.length;t++){n=a[t].substr(0,a[t].indexOf("="));i=a[t].substr(a[t].indexOf("=")+1);n=n.replace(/^\s+|\s+$/g,"");if(n==e){return unescape(i)}}},t=function(e,t,n){var i=new Date,a=escape(t);i.setDate(i.getDate()+n);a+=n===null?"":"; expires="+i.toUTCString();document.cookie=e+"="+a},n=function(){try{localStorage.setItem("test",1);localStorage.removeItem("test");return true}catch(e){return false}};return{get:function(t){if(n()){return localStorage.getItem(t)}return e(t)},set:function(e,i){if(n()){localStorage.setItem(e,i)}else{t(e,i,30)}}}}(),i=function(){var e=[],n=[],a=false,o=false,r=false,s=function(e){try{var t=e.split("signature="),n=t[1].split("&");n[0]="---";t[1]=n.join("&");return t.join("signature=")}catch(i){if(e.indexOf("signature")!==-1){return"omited due to security reasons"}return e}},c=function(t,n){t=s(t);e.push({time:(new Date).getTime(),file:t,content:n});$("#errors").css("display","").find(".count").text(e.length)},u=function(e,t){e=s(e);n.push({time:(new Date).getTime(),file:e,content:t});$("#warnings").css("display","").find(".count").text(n.length)},l=function(i,s,l,d){if(i.relog!=2){if(i.errors!==undefined){$.map(i.errors,function(t){if(t.type!==undefined){c(d,t)}else{c(d,{type:"misc",message:t})}if(a){$(".errors > .errorPopupCont").append(f(e[e.length-1]))}})}if(i.warnings!==undefined){$.map(i.warnings,function(e){if(e.type!==undefined){u(d,e)}else{u(d,{type:"misc",message:e})}if(o){$(".warnings > .errorPopupCont").append(f(n[n.length-1]))}})}}if(i.relog!==undefined&&i.relog!=0){if(i.relog==1){t.fetch(undefined,true);s(i)}else if(i.relog==2){t.fetch(function(){l()},true)}else if(i.relog==3){if(r){s(i)}else{t.fetch(function(){l()},true)}}r=true}else{s(i)}},f=function(e){return $("<div>").css("border-bottom","1px solid black").append("Time: ",new Date(e.time).toLocaleTimeString(),"<br>File: ",$("<span>").text(e.file).html(),$.map(e.content,function(e,t){return["<br>",$("<span>").text(t).html(),": ",$("<span>").text(e).html()]}))},d=function(e,t,n){return $("<div>").addClass("errorPopup").addClass(e.toLowerCase()).append($("<a>").text("Close").click(function(e){e.preventDefault();$(this).parent().remove();n()}),"&nbsp;",$("<b>").text(e),$("<div>").addClass("errorPopupCont").append($.map(t,function(e){return f(e)}))).appendTo("body")};return{getJSON:function(e,n,a,o){if(a==undefined){a=true}if(o==undefined){o=true}var r=e+(o?"&"+t.getUrlParams():"");return $.ajax({url:r,dataType:"json",async:a}).done(function(t){l(t,n,function(){i.getJSON(e,n,a,o)},r)})},post:function(e,n,a,o,r){if(o==undefined){o=true}if(r==undefined){r=true}var s=e+(r?"&"+t.getUrlParams():"");return $.ajax({type:"POST",url:s,async:o,data:n}).done(function(t){l(t,a,function(){i.post(e,n,a,o,r)},s)})},init:function(){$("#errors > .icon").click(function(){if(!a){a=true;d("Errors",e,function(){a=false})}});$("#warnings > .icon").click(function(){if(!o){o=true;d("Warnings",n,function(){o=false})}})}}}(),a=function(){return{init:function(){$.getScript("admin.min.js")}}}(),o=function(){var e="",i=true,a="",r=[{disp:"Highlight Bold",alt:"highBold",id:1,defaultOption:"T"},{disp:"Highlight Red",alt:"highRed",id:2,defaultOption:"T"},{disp:"Colored Names",alt:"colordNames",id:3,defaultOption:"0",handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){o.set("colordNames",this.value)}).append($.map(["none","calc","server"],function(e,t){return $("<option>").attr(o.get("colordNames")==t?"selected":"false","selected").val(t).text(e)})))}},{alt:"curChan",id:4,hidden:true,defaultOption:"-"},{disp:"Show extra Channels",alt:"extraChans",id:9,defaultOption:"F",before:function(){if(s!==""){alert(s)}return true}},{disp:"Alternating Line Highlight",alt:"altLines",id:6,defaultOption:"T"},{disp:"Enable OmnomIRC",alt:"enable",id:5,defaultOption:"T"},{disp:"Ding on Highlight",alt:"ding",id:8,defaultOption:"F"},{disp:"Show Timestamps",alt:"times",id:10,defaultOption:"T"},{disp:"Show Updates in Browser Status Bar",alt:"statusBar",id:11,defaultOption:"T"},{disp:"Show Smileys",alt:"smileys",id:12,defaultOption:"T"},{disp:"Hide Userlist",alt:"hideUserlist",id:14,defaultOption:"F"},{disp:"Number chars for Highlighting",alt:"charsHigh",id:13,defaultOption:"3",handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<select>").change(function(){o.set(13,this.value)}).append($.map([0,1,2,3,4,5,6,7,8,9],function(e){return $("<option>").attr(o.get("charsHigh")==e?"selected":"false","selected").val(e).text(e+1)})))}},{disp:"Show Scrollbar",alt:"scrollBar",id:15,defaultOption:"T"},{disp:"Enable Scrollwheel",alt:"scrollWheel",id:16,defaultOption:"T"},{disp:"Browser Notifications",alt:"browserNotifications",id:7,defaultOption:"F",before:function(){c.request();return false}},{disp:"Show OmnomIRC join/part messages",alt:"oircJoinPart",id:17,defaultOption:"F"},{disp:"Use WYSIWYG editor (experimental)",alt:"wysiwyg",id:18,defaultOption:"F"},{disp:"Enable simple text decorations",alt:"textDeco",id:19,defaultOption:"F"},{disp:"Font Size",alt:"fontSize",id:20,defaultOption:String.fromCharCode(9+45),handler:function(){return $("<td>").attr("colspan",2).css("border-right","none").append($("<input>").attr({type:"number",step:1,min:1,max:42}).css("width","3em").val(o.get("fontSize").charCodeAt(0)-45).change(function(){o.set("fontSize",String.fromCharCode(parseInt(this.value,10)+45));$("body").css("font-size",this.value+"pt")}))}}],s="",u=function(e){var t=-1,n="";$.each(r,function(i,a){if(a.alt==e||a.id==e){t=a.id;n=a.defaultOption;return}});return[t,n]},l=[];return{setDefaults:function(t){e=t},set:function(e,a){var o=n.get("OmnomIRCSettings"+t.net());delete l[e];e=u(e)[0];delete l[e];if(e==-1){return}if(!o){n.set("OmnomIRCSettings"+t.net(),"----------------------------------------");o=n.get("OmnomIRCSettings"+t.net())}if(!o){return}o=o.substring(0,e-1)+a+o.substring(e);n.set("OmnomIRCSettings"+t.net(),o);i=true},get:function(o){var r=i?a=n.get("OmnomIRCSettings"+t.net()):a,s,c;i=false;if(l[o]!==undefined){return l[o]}optionsNum=u(o);c=optionsNum[1];optionsNum=optionsNum[0];if(optionsNum==-1){return}if(!r){s="-"}else{s=r.charAt(optionsNum-1)}if(s=="-"){s=e.charAt(optionsNum-1)!==""&&e.charAt(optionsNum-1)!="-"?e.charAt(optionsNum-1):c}l[o]=s;return s},setExtraChanMsg:function(e){s=e},getFullOptionsString:function(){var o=i?a=n.get("OmnomIRCSettings"+t.net()):a,r="";for(var s=0;o.charAt(s)!="";s++){r+=o.charAt(s)!="-"?o.charAt(s):e.charAt(s)!=""?e.charAt(s):"-"}return r},getHTML:function(){return $.merge($.map([false,true],function(e){return $("<table>").addClass("optionsTable").append($.map(r,function(t){if(t.hidden){return}return(e=!e)?$("<tr>").append($.merge([$("<td>").text(t.disp)],t.handler===undefined?[$("<td>").addClass("option "+(o.get(t.id,t.defaultOption)=="T"?"selected":"")).text("Yes").click(function(){if(o.get(t.id,t.defaultOption)=="F"){if(t.before!==undefined&&t.before()||t.before===undefined){o.set(t.id,"T");$(this).addClass("selected").next().removeClass("selected")}}}),$("<td>").addClass("option "+(o.get(t.id,t.defaultOption)=="F"?"selected":"")).text("No").click(function(){if(o.get(t.id,t.defaultOption)=="T"){o.set(t.id,"F");$(this).addClass("selected").prev().removeClass("selected")}})]:t.handler())):""}))}),$("<div>").append("&nbsp;",$("<a>").text("Reset Defaults").click(function(e){e.preventDefault();n.set("OmnomIRCSettings"+t.net(),"----------------------------------------");n.set("OmnomIRCChannels"+t.net(),"");n.set("OmnomIRCCL"+t.net(),"");document.location.reload()})))}}}(),r=function(){var e="",t=function(){n.set("OmnomBrowserTab",e);n.set("OmnomNewInstant","false")};return{init:function(){e=Math.random().toString(36)+(new Date).getTime().toString();n.set("OmnomBrowserTab",e);$(window).focus(function(){t()}).unload(function(){n.set("OmnomNewInstant","true")})},current:function(){if(n.get("OmnomNewInstant")=="true"){t()}return e==n.get("OmnomBrowserTab")}}}(),s=function(){var e=false,t=false,n=[];return{start:function(){if(e===false){n=[true,true,true,true,true,false,false,false];t=$("<div>").attr("id","indicator").css({position:"absolute",zIndex:44,margin:0,padding:0,top:0,right:0}).appendTo("body");e=setInterval(function(){t.empty().append($.map(n,function(e){return $("<div>").css({padding:0,margin:0,width:3,height:3,backgroundColor:e?"black":""})}));var e=n[0],i;for(i=1;i<=7;i++){n[i-1]=n[i]}n[7]=e},50)}},stop:function(){if(e!==false){clearInterval(e);e=false;t.remove()}}}}(),c=function(){var e=window.webkitNotifications!==undefined&&window.webkitNotifications!==null&&window.webkitNotifications,t=function(){if(e||typeof Notification!="undefined"&&Notification&&Notification.permission!="denied"){return true}return false},n=function(t){var n;if(e&&window.webkitNotifications.checkPermission()===0){n=window.webkitNotifications.createNotification("http://www.omnimaga.org/favicon.ico","OmnomIRC Highlight",t);n.show()}else if(typeof Notification!="undefined"&&Notification&&Notification.permission=="granted"){n=new Notification("OmnomIRC Highlight",{icon:"http://www.omnimaga.org/favicon.ico",body:t});n.onshow=function(){setTimeout(n.close,3e4)}}};return{request:function(){if(e){window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){n("Notifications Enabled!");o.set(7,"T");document.location.reload()}})}else if(typeof Notification!=="undefined"&&Notification&&Notification.permission!=="denied"){Notification.requestPermission(function(e){if(Notification.permission!==e){Notification.permission=e}if(e==="granted"){n("Notifications Enabled!");o.set(7,"T");document.location.reload()}})}else{alert("Your browser doesn't support notifications")}},make:function(e,t){if(r.current()){if(o.get("browserNotifications")=="T"){n(e)}if(o.get("ding")=="T"){$("#ding")[0].play()}if(t!=f.getCurrentName()){f.highlight(t,true)}}else{if(t!=f.getCurrentName()){f.highlight(t)}}}}}(),u=function(){var e=false,n=false,a=true,o=[],r=false,s=false,c="",f=0,d=true,g=true,h=function(){if(g){try{g=false;e.close()}catch(t){}i.getJSON("omnomirc.php?getcurline&noLoginErrors",function(e){p.reload();l.setCurLine(e.curline);a=false;l.start()})}},m=function(){u.send($.extend({action:"ident"},t.getIdentParams()))};return{init:function(){if(!("WebSocket"in window)||!s){a=false;return false}try{e=new WebSocket((d?"wss://":"ws://")+c+":"+f.toString(10))}catch(i){console.log(e);console.log((d?"wss://":"ws://")+c+":"+f.toString(10));console.log(i);h()}e.onopen=function(e){n=true;for(var t=0;t<o.length;t++){u.send(o[t])}};e.onmessage=function(n){try{var i=JSON.parse(n.data);console.log(i);if(r&&i.line!==undefined){if(!parser.addLine(i.line)){g=false;e.close()}}if(i.relog!==undefined&&i.relog!=0){t.fetch(function(){m()},true)}}catch(n){}};e.onclose=function(e){a=false;h()};e.onerror=function(t){e.close();a=false;h()};m();$(window).on("beforeunload",function(){e.close()});return true},set:function(e,t,n,i){s=e;c=t;f=n;d=i},send:function(t){if(n){e.send(JSON.stringify(t))}else{o.push(t)}},setChan:function(e){u.send({action:"chan",chan:e})},use:function(){return a},allowRecLines:function(){r=true},dissallowRecLines:function(){r=false}}}(),l=function(){var e=(new Date).getTime(),t=0,n=false,a=false,r=function(){if(f.getCurrent()===""||u.use()){return}a=i.getJSON("Update.php?high="+(parseInt(o.get("charsHigh"),10)+1).toString()+"&channel="+f.getCurrent(false,true)+"&lineNum="+t.toString(),function(t){var n=true;if(f.getCurrent()===""){return}a=false;e=(new Date).getTime();if(t.lines!==undefined){$.each(t.lines,function(e,t){return n=parser.addLine(t)})}if(t.banned===true){n=false}if(n){s()}}).fail(function(){a=false;if((new Date).getTime()>=e+3e5){r.internal('<span style="color:#C73232;">OmnomIRC has lost connection to server. Please refresh to reconnect.</span>')}else if(!n){e=(new Date).getTime()}else{s()}})},s=function(){if(f.getCurrent()!==""&&a===false&&!u.use()){setTimeout(function(){r()},w.isBlurred()?2500:200)}else{l.cancel()}};return{cancel:function(){if(n){n=false;try{a.abort()}catch(e){}}},start:function(){if(!(n||u.use())){n=true;s()}},setCurLine:function(e){t=e},getCurLine:function(){return t}}}(),f=function(){var e=[],a="",r="",c="",g=function(){n.set("OmnomIRCChannels"+t.net(),JSON.stringify(e))},m=function(){try{var i=JSON.parse(n.get("OmnomIRCChannels"+t.net())),a=$.map(e,function(e){if(e.ex&&o.get("extraChans")=="T"||!e.ex){return e}return undefined}),r=[];if(i!==null&&i!=[]){e=$.merge($.map(i,function(t){if(t.id!=-1){var n=false;$.each(e,function(e,i){if(i.id==t.id){r.push(t);n=true;t.chan=i.chan;return false}});if(!n){return undefined}}return t}),$.map(a,function(e){var t=false;$.each(r,function(n,i){if(i.id==e.id){t=true;e.chan=i.chan;return false}});if(t){return undefined}return e}));g()}}catch(s){}},w=function(){$("#ChanList").empty().append($.map(e,function(t,n){if(t.ex&&o.get("extraChans")=="T"||!t.ex){var i=0,r=0,s=false,c=0,u=false,l=0,d=function(e){l=$(e).width();u=false;$(e).css({position:"absolute","z-index":100,left:i-c}).after($("<div>").attr("id","topicDragPlaceHolder").css({display:"inline-block",width:l})).addClass("dragging").find("div").css("display","block").focus();s=false},p=function(e,t){e.preventDefault();r=e.clientX;c=r-$(t).position().left;s=true},h=function(e,t){i=e.clientX;if(s&&Math.abs(i-r)>=4){s=false;d(t);e.preventDefault()}else if($(t).hasClass("dragging")){var n=i-c;$(t).css("left",n);$ne=$("#topicDragPlaceHolder").next(".chanList");$pe=$("#topicDragPlaceHolder").prev(".chanList");if($ne.length>0&&$ne.position().left<n+l/2){$ne.after($("#topicDragPlaceHolder").remove())}else if($pe.length>0){if($pe.attr("id")==$(t).attr("id")){$pe=$pe.prev()}if($pe.length>0&&$pe.position().left>n){$pe.before($("#topicDragPlaceHolder").remove())}}}},m=function(t,n){if(s){s=false}else{$(n).find("div").css("display","none");$("#topicDragPlaceHolder").replaceWith(n);e=$.map($(".chanList"),function(e,t){if($(e).find("span").hasClass("curchan")){o.set(4,String.fromCharCode(t+45))}return $(e).data("json")});g();w()}};return $("<div>").data("json",t).attr("id","chan"+n.toString()).addClass("chanList"+(t.high?" highlightChan":"")).append($("<span>").addClass("chan "+(b(n)==a?" curchan":"")).append(t.chan.substr(0,1)!="#"?$("<span>").addClass("closeButton").css({width:9,"float":"left"}).mouseup(function(){if(u){f.part(n)}}).text("x"):"",$("<span>").text(t.chan)).mouseup(function(){if(u){f.join(n)}}),$("<div>").css({position:"fixed",width:"100%",height:"100%","z-index":101,top:0,left:0,display:"none"}).mousemove(function(e){h(e,$(this).parent())}).mouseup(function(e){m(e,$(this).parent())}).mouseout(function(e){m(e,$(this).parent())})).mousedown(function(e){u=true;p(e,this)}).mousemove(function(e){h(e,this)}).mouseout(function(e){if(s){d(this)}}).mouseup(function(e){m(e,this)})}}))},C=false,b=function(t,n){if(e[t].id!=-1){return e[t].id}if(n){return base64.encode(e[t].chan)}return e[t].chan};return{highlight:function(t,n){$.each(e,function(n,i){if(t==i.id||i.chan.toLowerCase()==t.toString().toLowerCase()){$("#chan"+n.toString()).addClass("highlightChan");e[n].high=true}});if(n!==undefined&&n){g()}},openChan:function(t){var n=true;t=t.trim();if(t.substr(0,1)!="@"&&t.substr(0,1)!="#"){t="@"+t}t=t.toLowerCase();$.each(e,function(e,i){if(i.chan==t){n=e}});if(n===true){if(t.substr(0,1)=="#"){k.internal('<span style="color:#C73232;"> Join Error: Cannot join new channels starting with #.</span>');return}e.push({chan:t,high:false,ex:false,id:-1,order:-1});g();w();f.join(e.length-1)}else{f.join(n)}d.load()},openPm:function(t,n){var i=true;if(n===undefined){n=false}t=t.trim();if(t.substr(0,1)=="@"||t.substr(0,1)=="#"){k.internal('<span style="color:#C73232;"> Query Error: Cannot query a channel. Use /join instead.</span>');return}t=t.toLowerCase();if(t.substr(0,1)!="*"){t="*"+t}$.each(e,function(e,n){if(n.chan==t){i=e}});if(i===true){e.push({chan:t,high:!n,ex:false,id:-1,order:-1});g();w();if(n){f.join(e.length-1)}}else{e[i].high=!n;if(n){f.join(i)}}d.load()},part:function(t){var n=false;if(t===undefined){$.each(e,function(e,n){if(n.chan==a||n.id==a){t=e}})}if(isNaN(parseInt(t,10))){$.each(e,function(e,n){if(n.chan==t){t=e}})}if(isNaN(parseInt(t,10))||t===undefined){k.internal('<span style="color:#C73232;"> Part Error: I cannot part '+t+". (You are not in it.)</span>");return}t=parseInt(t,10);if(e[t].chan.substr(0,1)=="#"){k.internal('<span style="color:#C73232;"> Part Error: I cannot part '+e[t].chan+". (IRC channel.)</span>");return}if(b(t)==a){n=true}e.splice(t,1);g();w();if(n){f.join(t-1)}},join:function(n,f){if(e[n]!==undefined){s.start();l.cancel();u.dissallowRecLines();$("#message").attr("disabled","true");$("#MessageBox").empty();$(".chan").removeClass("curchan");if(C!==false){C.abort()}C=i.getJSON("Load.php?count=125&channel="+b(n,true),function(i){if(i.lines===undefined){if(i.message){k.internal(i.message)}else{k.internal('<span style="color:#C73232;"><b>ERROR:</b> couldn\'t join channel</span>')}s.stop();return}a=b(n);r=b(n,true);c=e[n].chan;v.read();o.set("curChan",String.fromCharCode(n+45));if(!i.banned){if(i.admin){$("#adminLink").css("display","")}else{$("#adminLink").css("display","none")}if(i.ignores!==undefined){parser.setIgnoreList(i.ignores)}p.setUsers(i.users);p.draw();$.each(i.lines,function(e,t){parser.addLine(t)});h.down();C=false;u.setChan(b(n));u.allowRecLines();l.start()}else{k.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>');C=false}$("#chan"+n.toString()).removeClass("highlightChan").find(".chan").addClass("curchan");e[n].high=false;g();d.load();if(f!==undefined){f()}if(t.loggedIn()){$("#message").removeAttr("disabled")}s.stop()})}},reloadUserlist:function(t){if(e[t]!==undefined){i.getJSON("Load.php?userlist&channel="+b(t,true),function(e){if(!e.banned){p.setUsers(e.users);p.draw()}else{k.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</span>')}})}},getCurrent:function(e,t){if(C===false||e){return t?r:a}return""},getCurrentName:function(e){if(C===false||e){return c}return""},getNames:function(){return $.map(e,function(e){return e.chan})},init:function(){m();w()},setChans:function(t){e=t},getChans:function(){return e}}}(),d=function(){var e="",t=0,n=false,i=0,a="",o=0,r="",s=0,c=" ",u=[],l;getCurrentWord=function(){var t=!m.support()?$("#message")[0].value:(l=window.getSelection().anchorNode).nodeValue;if(n){return e}i=!m.support()?$("#message")[0].selectionStart:window.getSelection().anchorOffset;a=t.charAt(i);while(a!=" "&&--i>0){a=t.charAt(i)}if(a==" "){i++}o=!m.support()?$("#message")[0].selectionStart:window.getSelection().anchorOffset;r=t.charAt(o);while(r!=" "&&++o<=t.length){r=t.charAt(o)}s=o;e=t.substr(i,o-i).trim();return e},getTabComplete=function(){var e=!m.support()?$("#message")[0].value:l.nodeValue,a;if(e===null){return}a=search(getCurrentWord(),t);if(!n){c=" ";if(i===0){c=": "}}if(a==getCurrentWord()){t=0;a=search(getCurrentWord(),t)}e=e.substr(0,i)+a+c+e.substr(o+1);if(!m.support()){$("#message")[0].value=e}else{window.getSelection().anchorNode.nodeValue=e;window.getSelection().getRangeAt(0).setEnd(l,i+a.length+c.length);window.getSelection().getRangeAt(0).setStart(l,i+a.length+c.length)}o=s+a.length+c.length},search=function(e,t){var n=false;if(!t){t=0}$.each(u,function(i,a){if(a.toLowerCase().indexOf(e.toLowerCase())===0&&t--<=0&&n===false){n=a}});if(n!==false){return n}return e};return{init:function(){$("#message").keydown(function(i){if(i.keyCode==9){if(!i.ctrlKey){i.preventDefault();getTabComplete();n=true;t++;setTimeout(1,1)}}else{e="";t=0;n=false}})},load:function(){u=$.merge(p.getNames(),f.getNames())}}}(),p=function(){var e=[],n=function(t){var n=false;$.each(e,function(e,i){if(i.nick.toLowerCase()==t.nick.toLowerCase()&&i.network==t.network){n=true;return false}});return n};return{add:function(t){if(f.getCurrent()!==""){e.push(t);p.draw()}},remove:function(t){if(f.getCurrent()!==""){$.each(e,function(n,i){if(i.nick==t.nick&&i.network==t.network){e.splice(n,1);return false}});p.draw()}},draw:function(){e.sort(function(e,t){var n=e.nick.toLowerCase(),i=t.nick.toLowerCase();return n==i?e==t?0:e<t?-1:1:n<i?-1:1});$("#UserList").empty().append($.map(e,function(e){var n,a=encodeURIComponent(e.nick),o=$("<span>").text(e.nick).html();return $("<span>").attr("title",t.networks()[e.network]!==undefined?t.networks()[e.network].name:"Unknown Network").append(t.networks()[e.network]!==undefined?t.networks()[e.network].userlist.split("NICKENCODE").join(a).split("NICK").join(o):o,"<br>").mouseover(function(){n=i.getJSON("Load.php?userinfo&name="+base64.encode(e.nick)+"&chan="+f.getCurrent(false,true)+"&online="+e.network.toString(),function(e){if(e.last){$("#lastSeenCont").text("Last Seen: "+new Date(e.last*1e3).toLocaleString())}else{$("#lastSeenCont").text("Last Seen: never")}$("#lastSeenCont").css("display","block")},undefined,false)}).mouseout(function(){try{n.abort()}catch(e){}$("#lastSeenCont").css("display","none")})}),"<br><br>")},setUsers:function(t){e=t},getNames:function(){return $.map(e,function(e){return e.nick})},reload:function(){var e=false;$.each(f.getChans(),function(t,n){if(n.chan==f.getCurrent()||n.id==f.getCurrent()){e=t;return false}});if(e!==false){f.reloadUserlist(e)}}}}(),g=function(){var e="";return{set:function(t){$("#topic").empty().append(t);e=t}}}(),h=function(){var e=false,t="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,n=0,i=false,a=false,r=function(e,t){var n=-1;e.bind("touchstart",function(e){if($(e.target).is("a")){return}i.css("transition","none");e.preventDefault();n=e.originalEvent.touches[0].clientY}).bind("touchmove",function(e){if($(e.target).is("a")){return}e.preventDefault();if(n==-1){return}var i=e.originalEvent.changedTouches[0].clientY;t(i-n);n=i}).bind("touchend touchcancel touchleave",function(e){if($(e.target).is("a")){return}i.css("transition","");e.preventDefault();n=-1})},s=function(){var e=function(e,n,i){var a;$(e).mousedown(function(){a=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).mouseup(function(){try{clearInterval(a)}catch(e){}}).mouseout(function(){try{clearInterval(a)}catch(e){}});if(t){$(e).bind("touchstart",function(){a=setInterval(function(){document.getElementById(n).scrollLeft+=i},50)}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(a)}catch(e){}})}};e("#arrowLeftChan","ChanListCont",-9);e("#arrowRightChan","ChanListCont",9);e("#arrowLeftTopic","topicCont",-9);e("#arrowRightTopic","topicCont",9)},c=function(t){var n=-parseInt(i[0].style.top,10),r=i.height()-a.height(),s=Math.min(r,Math.max(0,n-t));e=false;i.css("top",-s);if(s==r){e=true}if(o.get("scrollBar")=="T"){l()}},u=function(){a.bind("DOMMouseScroll mousewheel",function(e){var t=i[0].style.top;c(/Firefox/i.test(navigator.userAgent)?e.originalEvent.detail*-20:e.originalEvent.wheelDelta/2);e.preventDefault();e.stopPropagation();e.cancelBubble=true});if(t){r(a,function(e){c(e)})}},l=function(){if($("#scrollBar").length!==0){if(i.height()<=a.height()){$("#scrollBar").css("top",n)}else{$("#scrollBar").css("top",parseInt(i[0].style.top,10)/(a.height()-i.height())*($("body")[0].offsetHeight-$("#scrollBar")[0].offsetHeight-n)+n)}}},f=function(){var e=function(e,t){$(t).css("top",Math.min(0,Math.max((/Opera/i.test(navigator.userAgent)?-30:0)+document.getElementById("UserListInnerCont").clientHeight-t.scrollHeight,e+parseInt($("#UserList").css("top"),10))))};$("#UserList").css("top",0).bind("DOMMouseScroll mousewheel",function(t){if(t.preventDefault){t.preventDefault()}t=t.originalEvent;e(/Firefox/i.test(navigator.userAgent)?t.detail*-20:t.wheelDelta/2,this)});if(t){r($("#UserList"),function(t){e(t,this)})}},d=function(){var o=function(t){var o=0;if(c.data("isClicked")){o=parseInt(c.css("top"),10)+(t-c.data("prevY"));i.css("top",-((o-n)/($("body")[0].offsetHeight-c[0].offsetHeight-n))*(i.height()-a.height()));e=false;if(o<n){o=n;i.css("top",0)}if(o>$("body")[0].offsetHeight-c[0].offsetHeight){o=$("body")[0].offsetHeight-c[0].offsetHeight;i.css("top",a.height()-i.height());e=true}c.css("top",o)}c.data("prevY",t)},r=function(){c.data("isClicked",true);$("#scrollArea").css("display","block");i.css("transition","none")},s=function(){c.data("isClicked",false);$("#scrollArea").css("display","none");i.css("transition","")},c=$("<div>").attr("id","scrollBar").data({prevY:0,isClicked:false}).appendTo("body").mousemove(function(e){o(e.clientY)}).mousedown(function(){r()}).mouseup(function(){s()}),u;c.css("top",$("body")[0].offsetHeight-c[0].offsetHeight);u=$("<div>").attr("id","scrollArea").css({display:"none",width:"100%",height:"100%",position:"absolute",cursor:"move",left:0,top:0,zIndex:100}).mousemove(function(e){o(e.clientY)}).mouseup(function(){s()}).mouseout(function(){s()});if(t){u.bind("touchend touchcancel touchleave",function(e){s()}).bind("touchmove",function(e){e.preventDefault();o(e.originalEvent.changedTouches[0].clientY)});c.bind("touchstart",function(e){e.preventDefault();r()}).bind("touchmove",function(e){e.preventDefault();o(e.originalEvent.changedTouches[0].clientY)}).bind("touchend touchcancel touchleave",function(e){e.preventDefault();s(e)})}u.appendTo("body");$("<div>").attr("id","scrollBarLine").appendTo("body");$(window).trigger("resize")},p=function(){var e,n,a=function(){e=setInterval(function(){c(9)},50)},o=function(){n=setInterval(function(){c(-9)},50)},r;r=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",top:0,position:"absolute",fontWeight:"bolder",marginTop:"10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9650;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",top:0,position:"absolute",marginTop:"10pt",marginLeft:"-10pt"}).mousedown(function(){i.css("transition","none");a()}).mouseout(function(){i.css("transition","");try{clearInterval(e)}catch(t){}}).mouseup(function(){i.css("transition","");try{clearInterval(e)}catch(t){}}));if(t){r.bind("touchstart",function(){a()}).bind("touchend touchcancel touchleave",function(t){try{clearInterval(e)}catch(t){}})}r.appendTo("body");r=$("<span>").addClass("arrowButtonHoriz3").append($("<div>").css({fontSize:"12pt",width:12,height:"12pt",bottom:"6pt",position:"absolute",fontWeight:"bolder",marginTop:"-10pt",marginLeft:"-10pt"}).addClass("arrowButtonHoriz2").html("&#9660;"),$("<div>").css({fontSize:"12pt",width:12,height:"9pt",bottom:"9pt",position:"absolute",marginTop:"-10pt",marginLeft:"-10pt"}).mousedown(function(){i.css("transition","none");o()}).mouseout(function(){i.css("transition","");try{clearInterval(n)}catch(e){}}).mouseup(function(){i.css("transition","");try{clearInterval(n)}catch(e){}}));if(t){r.bind("touchstart",function(){o()}).bind("touchend touchcancel touchleave",function(e){try{clearInterval(n)}catch(e){}})}r.appendTo("body")};return{down:function(){i.css("top",a.height()-i.height());l();e=true},up:function(){i.css("top",0);l();e=false},slide:function(){if(e){h.down()}},init:function(){i=$("#MessageBox");a=$("#mBoxCont");s();n=$("#header").height()-2;if(o.get("scrollBar")=="T"){d()}else{p()}if(o.get("scrollWheel")=="T"){u()}f();$(document).add(window).add("body").add("html").scroll(function(e){e.preventDefault()})},reCalcBar:l}}(),m=function(){var e,t=false,n=function(){$("#textDecoForm").css("display","none");t=false};return{init:function(){$("#message").mouseup(function(n){e=window.getSelection();if(e.isCollapsed){return}n.preventDefault();$("#textDecoForm").css({display:"block",left:Math.max(n.pageX-52,0)});t=true});$(document).mousedown(function(e){if(!$(e.target).closest("#textDecoForm").length&&t){n()}});$("#textDecoFormBold").click(function(){e.getRangeAt(0).surroundContents($("<b>")[0])});$("#textDecoFormItalic").click(function(){e.getRangeAt(0).surroundContents($("<i>")[0])});$("#textDecoFormUnderline").click(function(){e.getRangeAt(0).surroundContents($("<u>")[0])})},getMsg:function(){var e=$("#message").html();e=e.split("<b>").join("").split("</b>").join("");e=e.split("<i>").join("").split("</i>").join("");e=e.split("<u>").join("").split("</u>").join("");e=e.split("&nbsp;").join(" ");e=$("<span>").html(e).text();return e},support:function(){return"contentEditable"in document.documentElement&&o.get("wysiwyg")=="T"}}}(),w=function(){var e=function(){if(o.get("smileys")=="T"){$("#smileyMenuButton").css("cursor","pointer").click(function(){if($("#smileyselect").css("display")=="block"){$("#smileyselect").css("display","none");$(this).attr("src","smileys/smiley.gif")}else{$("#smileyselect").css("display","block");$(this).attr("src","smileys/tongue.gif")}})}else{$("#smileyMenuButton").attr("src","smileys/smiley_grey.png")}$("#smileyselect").append($.map(parser.getSmileys(),function(e){return[e.inMenu?$("<img>").attr({src:e.pic,alt:e.alt,title:e.title}).click(function(){if(!m.support()){replaceText(" "+e.code,$("#message")[0])}else{var t=window.getSelection().getRangeAt(0);t.deleteContents();t.insertNode(document.createTextNode(" "+e.code))}}):""," "]}))},n=90,i=false,a=true,c=function(){$("#toggleButton").click(function(e){e.preventDefault();o.set(5,!(o.get("enable")=="T")?"T":"F");document.location.reload()})},l=false,p=function(e){var t=window.innerHeight,o=window.innerWidth,r=$("#header").outerHeight(),s=$("#footer").outerHeight(),c=Number(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)px/)[1]);if(e){$("#scrollBarLine").css("top",parseInt($("#header").outerHeight(),10));$("#mBoxCont").css("height",t-s-r-.2*c);$("html,body").height(t);$("#message").css("width",o*(i?1:.91)-12*c)}if(a){var u=o/100*n;if(e){$("#mBoxCont").css("width",u-1.9*c)}$("#scrollBarLine").css("left",u-1.4*c);if(e){$("#scrollBarLine").css("height",t-r-.1*c)}$("#scrollBar").css("left",u-1.5*c);h.reCalcBar()}h.down()},g=function(){var e=navigator.userAgent,t=e.indexOf("Mozilla/5.0")>-1&&e.indexOf("Android ")>-1&&e.indexOf("AppleWebKit")>-1&&!(e.indexOf("Chrome")>-1),s=e.match(/(iPod|iPhone|iPad)/i)&&e.match(/AppleWebKit/i),u=e.match(/AppleWebKit/i)&&e.match(/Android/i);$("body").css("font-size",(o.get("fontSize").charCodeAt(0)-45).toString(10)+"pt");i=o.get("hideUserlist")=="T";a=o.get("scrollBar")=="T";w.changeLinks();if(!m.support()){$("#message").replaceWith($("<input>").attr({type:"text",id:"message",accesskey:"i",maxlen:"256",autocomplete:"off"}))}else{$("#message").keydown(function(e){if(e.keyCode==13){e.preventDefault();$("#sendMessage").trigger("submit")}});m.init()}if(i){n=99;$("<style>").append("#mBoxCont{width:99%;}",".arrowButtonHoriz2,.arrowButtonHoriz3 > div:nth-child(2){left:98%;left:calc(99% - 5px);left:-webkit-calc(99% - 5px);}","#UserListContainer{left:99%;transition: left 0.5s 1s;-webkit-transition: left 0.5s 1s;-o-transition-property: left;-o-transition-duration: 0.5d;-o-transition-delay: ls;}","#icons{right:95px;}").appendTo("head");
}h.init();d.init();r.init();y.init();c();if(s){p(true)}$(window).resize(function(){p(!s)}).trigger("resize").blur(function(){l=true}).focus(function(){l=false});$("#aboutButton").click(function(e){e.preventDefault();$("#about").toggle()})};return{load:function(){s.start();t.fetch(function(){if(o.get("enable")=="T"){g();e();k.init();v.init();f.init();u.init();f.join(o.get("curChan").charCodeAt(0)-45)}else{c();$("#mBoxCont").empty().append("<br>",$("<a>").css("font-size","20pt").text("OmnomIRC is disabled. Click here to enable.").click(function(e){e.preventDefault();o.set(5,"T");window.location.reload()}));$("#footer,#header").css("display","none");s.stop()}})},isBlurred:function(){return l},changeLinks:function(){$('#adminLink a,a[href="."],a[href="?options"],a[href="index.php"]').each(function(){if($(this).attr("href").split("?")[1]!==undefined){$(this).attr("href",$(this).attr("href")+"&network="+t.net())}else{$(this).attr("href",$(this).attr("href")+"?network="+t.net())}})}}}(),C=function(){var e="",t=false,n=function(){if(o.get("statusBar")!="T"){return}if(!t){setInterval(function(){window.status=e;if(parent){try{parent.window.status=e}catch(t){}}},500);t=true}};return{set:function(i){e=i;if(!t){n()}}}}(),b=function(){return{parse:function(t){var n=t.split(" ")[0].toLowerCase(),i=t.substr(n.length+1).toLowerCase().trim();switch(n){case"j":case"join":f.openChan(i);return true;case"q":case"query":f.openPm(i,true);return true;case"win":case"w":case"window":if(parseInt(i,10)<f.getChans().length&&parseInt(i,10)>=0){f.join(parseInt(i,10))}return true;case"p":case"part":f.part(i!==""?i:undefined);return true;case"help":k.internal('<span style="color:#2A8C2A;">Commands: me, ignore, unignore, ignorelist, join, part, query, msg, window</span>');k.internal('<span style="color:#2A8C2A;">For full help go here: <a href="http://ourl.ca/19926" target="_top">http://ourl.ca/19926</a></span>');return true;case"ponies":$.getScript("https://juju2143.ca/mousefly.js",function(){Derpy()});return true;case"minty":$.getJSON(e+"/minty.php").done(function(e){k.internal('<span style="font-size:5px;line-height:0;font-family:monospace;">'+e.minty+"</span>")});return true;default:return false}}}}(),v=function(){var e=[],t=0,i="",a=function(e){if(!m.support()){$("#message").val(e)}else{$("#message").html(e)}},o=function(){if(!m.support()){return $("#message").val()}return $("#message").html()};return{init:function(){$("#message").keydown(function(n){if(n.keyCode==38||n.keyCode==40){n.preventDefault();if(t==e.length){i=o()}if(e.length!==0){if(n.keyCode==38){if(t!==0){t--}a(e[t])}else{if(t!=e.length){t++}if(t==e.length){a(i)}else{a(e[t])}}}}})},add:function(i){e.push(i);if(e.length>20){e.shift()}t=e.length;n.set("oldMessages-"+f.getCurrent(true,true),e.join("\n"))},read:function(){var i=n.get("oldMessages-"+f.getCurrent(true,true));if(i){e=i.split("\n")}else{e=[]}t=e.length}}}(),k=function(){var e=false,n=function(t){if(t[0]=="/"&&b.parse(t.substr(1))){if(!m.support()){$("#message").val("")}else{$("#message").html("")}}else{if(!e){if(u.use()){u.send({action:"message",message:t});if(!m.support()){$("#message").val("")}else{$("#message").html("")}}else{e=true;l.cancel();i.getJSON("message.php?message="+base64.encode(t)+"&channel="+f.getCurrent(false,true),function(){if(!m.support()){$("#message").val("")}else{$("#message").html("")}l.start();e=false})}}}};return{internal:function(e){parser.addLine({curLine:0,type:"internal",time:Math.floor((new Date).getTime()/1e3),name:"",message:e,name2:"",chan:f.getCurrent()})},init:function(){$("#sendMessage").submit(function(e){e.preventDefault();if(t.loggedIn()){var i="";if(!m.support()){i=$("#message").val();v.add(i)}else{v.add($("#message").html());i=m.getMsg()}console.log(i);i=parser.parseTextDecorations(i);if(!$("#message").attr("disabled")&&i!==""){n(i);$("#message").focus()}}});if(!t.loggedIn()){$("#message").val("You need to login if you want to chat!")}}}}(),y=function(){var e=false,t=0,n=0,a=0,o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=function(){return base64.encode(t.toString(10)+"-"+n.toString(10)+"-"+a.toString(10))},c=function(){$("#logDate").val(o[n-1]+" "+a.toString(10)+" "+t.toString(10))},d=function(){var e=new Date(t,n,a),i=["Sun","Mon","Tue","Wen","Thu","Fri","Sat"],r=new Date(t,n,0).getDate(),s=new Date(t,n-1,1).getDay(),u=0;if(a>r){a=r}c();$("#logDatePicker").empty().append($("<a>").text("<").click(function(e){e.preventDefault();e.stopPropagation();t--;d()})," ",t.toString(10)," ",$("<a>").text(">").click(function(e){e.preventDefault();e.stopPropagation();t++;d()}),"<br>",$("<a>").text("<").click(function(e){e.preventDefault();e.stopPropagation();n--;if(n<1){n=12;t--}d()})," ",o[n-1]," ",$("<a>").text(">").click(function(e){e.preventDefault();e.stopPropagation();n++;if(n>12){n=1;t++}d()}),"<br>",$("<table>").append($("<tr>").append($.map(i,function(e){return $("<th>").text(e)})),$.map([0,1,2,3,4,5],function(){if(u>=r){return}return $("<tr>").append($.map([0,1,2,3,4,5,6],function(e){if(u==0&&e!=s||u>=r){return $("<td>").text(" ")}u++;return $("<td>").text(u).addClass("logDatePickerDay").addClass(u==a?"current":"").data("day",u).click(function(){$(".logDatePickerDay.current").removeClass("current");a=$(this).addClass("current").data("day");c()})}))})));$("#logDatePicker").css("display","block")},g=function(){var i=new Date;s.start();l.cancel();u.dissallowRecLines();$("#message").attr("disabled","true");p.setUsers([]);p.draw();$("#chattingHeader").css("display","none");$("#logDatePicker").css("display","none");$("#logsHeader").css("display","block");$("#logChanIndicator").text(f.getCurrentName());t=parseInt(i.getFullYear(),10);n=parseInt(i.getMonth()+1,10);a=parseInt(i.getDate(),10);c();e=true;C()},m=function(){var t;u.allowRecLines();$("#chattingHeader").css("display","block");$("#logsHeader").css("display","none");$.each(f.getChans(),function(e,n){if(n.chan==f.getCurrent()||n.id==f.getCurrent()){t=e;return false}});f.join(t);e=false},w=function(e){i.getJSON("Log.php?day="+r()+"&offset="+parseInt(e,10)+"&channel="+f.getCurrent(false,true),function(t){if(!t.banned){if(t.lines.length>=1e3){w(e+1e3)}$.each(t.lines,function(e,t){parser.addLine(t,true)});h.up();if(t.lines.length<1e3){s.stop()}}else{k.internal('<span style="color:#C73232;"><b>ERROR:</b> banned</banned>')}})},C=function(){s.start();$("#MessageBox").empty();w(0)},b=function(){if(e){m()}else{g()}};return{init:function(){$("#logCloseButton").click(function(e){e.preventDefault();m()});$("#logGoButton").click(function(e){e.preventDefault();C()});$("#logsButton").click(function(e){e.preventDefault();b()});$("#logDate").click(function(e){e.preventDefault();$(this).focusout();if($("#logDatePicker").css("display")!="block"){d();e.stopPropagation()}});$(document).click(function(t){if(e){var n=$("#logDatePicker");if(!n.is(t.target)&&n.has(t.target).length===0){n.css("display","none")}}})}}}();parser=function(){var e=[],n=200,a=0,r=[],s={},u=function(e,n,a){if(a===undefined){a=-1}e=e=="\x00"?"":e;var r=encodeURIComponent(e);e=$("<span>").text(e).html();var c=[19,20,22,24,25,26,27,28,29],u=0,l=0,f=e,d=t.networks()[n],p=true;switch(o.get("colordNames")){case"1":while(e[l]){u+=e.charCodeAt(l++)}f=$("<span>").append($("<span>").addClass("uName-"+c[u%=9].toString()).html(e)).html();break;case"2":if(d!==undefined&&d.checkLogin!==undefined){p=false;if(s[n.toString()+":"+a.toString()]===undefined){i.getJSON(d.checkLogin+"?c="+a.toString(10)+"&n="+r,function(e){s[n.toString()+":"+a.toString()]=e.nick},false,false)}f=s[n.toString()+":"+a.toString()]}else{f=e}break;default:f=e;break}if(d!==undefined&&p){f=d.normal.split("NICKENCODE").join(r).split("NICK").join(f).split("USERID").join(a.toString(10))}if(d!==undefined){return'<span title="'+d.name+'">'+f+"</span>"}return'<span title="Unknown Network">'+f+"</span>"},d=function(t){var n="";if(!t){return""}$.each(e,function(e,i){t=t.replace(RegExp(i.regex,"g"),i.replace.split("ADDSTUFF").join(n).split("PIC").join(i.pic).split("ALT").join(i.alt))});return t},m=function(e){if(!e||e===null||e===undefined){return""}var t=["ourl.ca","omnimaga.org","www.omnimaga.org"];var n='[^\\s"]';e=e.replace(RegExp("(|)","g"),"");$.map(t,function(t){t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");e=e.replace(RegExp("(^|\\s)(((f|ht)(tp|tps)://)"+t+n+"*)","g"),"$1$2").replace(RegExp("(^|\\s)("+t+n+"*)","g"),"$1$2")});return e.replace(RegExp("(^|[^a-zA-Z0-9_]|\\d{1,2}(|,\\d{1,2}))(((f|ht)(tp|tps)://)"+n+"+)","g"),'$1<a target="_blank" href="$3">$3</a>').replace(RegExp("(^|[^a-zA-Z0-9_/])(www\\."+n+"+)","g"),'$1<a target="_blank" href="http://$2">$2</a>').replace(RegExp("(^|.)("+n+"+)","g"),'$1<a target="_top" href="$2">$2</a>').replace(RegExp("(^|.)("+n+"+)","g"),'$1<a target="_top" href="http://$2">$2</a>')},w=function(e){var t=[],n,i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false},a,o;if(!e){return""}t=e.split(RegExp("([])"));e="<span>";for(a=0;a<t.length;a++){o=true;switch(t[a]){case"":n=t[a+1].replace(/^([0-9]{1,2}),([0-9]{1,2})(.*)/,"$1:$2");if(n==t[a+1]){n=t[a+1].replace(/^([0-9]{1,2}).*/,"$1:");if(n!=t[a+1]){i.fg=n.split(":")[0];t[a+1]=t[a+1].substr(n.length-1)}}else{i.fg=n.split(":")[0];i.bg=n.split(":")[1];if(n==t[a+1]){t[a+1]=""}else{t[a+1]=t[a+1].substr(n.length)}}break;case"":i.bold=!i.bold;break;case"":i.italic=!i.italic;break;case"":n=i.fg;i.fg=i.bg;i.bg=n;if(i.fg=="-1"){i.fg="0"}if(i.bg=="-1"){i.bg="1"}break;case"":i.underline=!i.underline;break;case"":i={fg:"-1",bg:"-1",underline:false,bold:false,italic:false};break;default:o=false}if(o){e+="</span>"+'<span class="fg-'+i.fg+" bg-"+i.bg+'" style="'+(i.bold?"font-weight:bold;":"")+(i.underline?"text-decoration:underline;":"")+(i.italic?"font-style:italic;":"")+'">'}else{e+=t[a]}}e+="</span>";e=e.replace(/(\x03|\x02|\x1F|\x09|\x0F)/g,"");return e},b=function(e){if(e.toLowerCase().indexOf(t.nick().toLowerCase().substr(0,parseInt(o.get("charsHigh"),10)+1))>=0&&t.nick()!=""){var n="";if(o.get("highRed")!="T"){n+="background:none;padding:none;border:none;"}if(o.get("highBold")=="T"){n+="font-weight:bold;"}return'<span class="highlight" style="'+n+'">'+e+"</span>"}return e},v=function(e,t){if(t==undefined||!t){t=false}e=e=="\x00"?"":e;e=$("<span>").text(e).html();e=m(e);if(o.get("smileys")=="T"&&t===false){e=d(e)}e=w(e);return e},k=false;return{addLine:function(e,i){if(e.curLine>l.getCurLine()){l.setCurLine(e.curLine)}if(e.name===null||e.name===undefined||e.type===null||r.indexOf(e.name.toLowerCase())>-1||e.chan!=f.getCurrent(true)&&"*"+e.chan!=f.getCurrent(true)&&e.chan[0]!="*"&&e.chan.toLowerCase()!=t.nick().toLowerCase()){return true}var s=$("#MessageBox"),d=u(e.name,e.network,e.uid),m=v(e.message),w="*",y=m,S=true,x="";if(e.network==-1){S=false}if(["message","action","pm","pmaction"].indexOf(e.type)>=0&&e.name.toLowerCase()!="*"){y=m=b(m,e);c.make("("+f.getCurrentName()+") <"+e.name+"> "+e.message,e.chan)}switch(e.type){case"reload":S=false;if(i!==true&&f.getCurrent()!==""){var L;$.each(f.getChans(),function(e,t){if(t.chan==f.getCurrent()||t.id==f.getCurrent()){L=e;return false}});f.join(L);return false}break;case"reload_userlist":S=false;if(i!==true&&f.getCurrent()!==""){p.reload();return true}case"relog":S=false;if(i!==true&&f.getCurrent()!==""){t.fetch(undefined,true)}break;case"refresh":S=false;if(i!==true&&f.getCurrent()!==""){location.reload(true)}break;case"join":y=[d," has joined "+f.getCurrentName()];if(i!==true){p.add({nick:e.name,network:e.network})}if(S&&t.networks()[e.network].type==1&&o.get("oircJoinPart")=="F"){S=false}break;case"part":y=[d," has left "+f.getCurrentName()+" (",m,")"];if(i!==true){p.remove({nick:e.name,network:e.network})}if(S&&t.networks()[e.network].type==1&&o.get("oircJoinPart")=="F"){S=false}break;case"quit":y=[d," has quit IRC (",m,")"];if(i!==true){p.remove({nick:e.name,network:e.network})}if(S&&t.networks()[e.network].type==1&&o.get("oircJoinPart")=="F"){S=false}break;case"kick":y=[d," has kicked ",u(e.name2,e.network)," from "+f.getCurrentName()+" (",m,")"];if(i!==true){p.remove({nick:e.name2,network:e.network})}break;case"message":w=d;break;case"action":y=[d," ",m];break;case"mode":if(typeof m=="string"){m=e.message.split(" ");$.each(m,function(t,n){var i=$("<span>").html(n).text();if(i.indexOf("+")==-1&&i.indexOf("-")==-1){m[t]=u(n,e.network)}});m=m.join(" ")}y=[d," set "+f.getCurrentName()+" mode ",m];break;case"nick":y=[d," has changed nicks to ",u(e.name2,e.network)];if(i!==true){p.add({nick:e.name2,network:e.network});p.remove({nick:e.name,network:e.network})}break;case"topic":g.set(v(e.message,true));y=[d," has changed the topic to ",v(e.message,true)];break;case"pm":if(f.getCurrentName(true).toLowerCase()=="*"+e.name.toLowerCase()||f.getCurrentName(true).toLowerCase()=="*"+e.chan.toLowerCase()){w=d;e.type="message"}else{if(f.getCurrent()!==""&&i!==true){if(e.name.toLowerCase()==t.nick().toLowerCase()){S=false;f.openPm(e.chan)}else{w=["(PM)",d];f.openPm(e.name);c.make("(PM) <"+e.name+"> "+e.message,e.chan)}}else{S=false}}break;case"pmaction":if(f.getCurrentName(true).toLowerCase()=="*"+e.name.toLowerCase()||f.getCurrentName(true).toLowerCase()=="*"+e.chan.toLowerCase()){y=[d," ",m];e.type="action"}else{if(f.getCurrent()!==""&&i!==true){if(e.name.toLowerCase()==t.nick().toLowerCase()){S=false;f.openPm(e.chan)}else{y=["(PM)",d," ",m];f.openPm(e.name);c.make("* (PM)"+e.name+" "+e.message,e.chan);e.type="pm"}}else{S=false}}break;case"highlight":if(e.name.toLowerCase()!="new"){c.make("("+e.chan+") <"+e.name+"> "+e.message,e.chan)}S=false;break;case"internal":y=e.message;break;case"server":break;default:S=false}if(S){if(s.find("tr").length>n&&i!==true){s.find("tr:first").remove()}if(w=="*"){x="* "}else{x="<"+e.name+"> "}if(o.get("times")=="T"){x="["+new Date(e.time*1e3).toLocaleTimeString()+"] "+x}x+=$("<span>").append(y).text();C.set(x);var N=$("<tr>").addClass(o.get("altLines")=="T"&&(k=!k)?"lineHigh":"").addClass(new Date(a).getDay()!=new Date(e.time*1e3).getDay()?"seperator":"").append(o.get("times")=="T"?$("<td>").addClass("irc-date").append("["+new Date(e.time*1e3).toLocaleTimeString()+"]"):"",$("<td>").addClass("name").append(w),$("<td>").addClass(e.type).append(y));N.find("img").load(function(e){h.slide()});s.append(N);h.slide();a=e.time*1e3}return true},setSmileys:function(t){e=t},getSmileys:function(){return e},setIgnoreList:function(e){r=e},parseTextDecorations:function(e){if(e!==""&&o.get("textDeco")=="T"){if(e[0]==">"){e="3"+e}e=e.replace(/((^|\s)\*[^\*]+\*($|\s))/g,"$1").replace(/((^|\s)\/[^\/]+\/($|\s))/g,"$1").replace(/((^|\s)_[^_]+_($|\s))/g,"$1")}return e}}}();$(function(){i.init();switch($("body").attr("page")){case"options":t.fetch(function(){w.changeLinks();$("#options").height($(window).height()-75);$(window).resize(function(){if(!(navigator.userAgent.match(/(iPod|iPhone|iPad)/i)&&navigator.userAgent.match(/AppleWebKit/i))){$("#options").height($(window).height()-75)}});$("body").css("font-size",(o.get("fontSize").charCodeAt(0)-45).toString(10)+"pt");$("#options").append(o.getHTML())});break;case"admin":a.init();break;default:w.load()}});return{OMNOMIRCSERVER:e,page:{changeLinks:function(){w.changeLinks()}},settings:{fetch:function(e){t.fetch(e)}},indicator:{start:function(){s.start()},stop:function(){s.stop()}},network:{getJSON:function(e,t,n,a){i.getJSON(e,t,n,a)},post:function(e,t,n,a,o){i.post(e,t,n,a,o)}},options:{getFullOptionsString:function(){return o.getFullOptionsString()}}}}();